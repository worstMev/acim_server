(this.webpackJsonpacim_client=this.webpackJsonpacim_client||[]).push([[0],{180:function(e,t,n){},182:function(e,t,n){},183:function(e,t,n){},188:function(e,t){},190:function(e,t){},201:function(e,t){},203:function(e,t){},230:function(e,t){},232:function(e,t){},233:function(e,t){},238:function(e,t){},240:function(e,t){},259:function(e,t){},271:function(e,t){},274:function(e,t){},318:function(e,t,n){},323:function(e,t,n){},349:function(e,t,n){},350:function(e,t,n){},351:function(e,t,n){},352:function(e,t,n){},353:function(e,t,n){},354:function(e,t,n){},355:function(e,t,n){},356:function(e,t,n){},357:function(e,t,n){},358:function(e,t,n){},359:function(e,t,n){},360:function(e,t,n){},361:function(e,t,n){},362:function(e,t,n){},363:function(e,t,n){},364:function(e,t,n){},365:function(e,t,n){},366:function(e,t,n){},367:function(e,t,n){},368:function(e,t,n){},369:function(e,t,n){},370:function(e,t,n){},371:function(e,t,n){},372:function(e,t,n){},373:function(e,t,n){},374:function(e,t,n){},375:function(e,t,n){},376:function(e,t,n){},377:function(e,t,n){},378:function(e,t,n){"use strict";n.r(t);var s=n(1),o=n.n(s),i=n(171),r=n.n(i),a=(n(180),n(2)),c=n(12),l=n.n(c),u=n(19),p=n(3),d=n(4),m=n(6),h=n(5),b=(n(182),n(183),n(172)),j=n.n(b),f={text:"technicien de maintenance",code:"TECH_MAIN"},v={text:"utilisateur",code:"USER"};function g(e,t){return _.apply(this,arguments)}function _(){return(_=Object(u.a)(l.a.mark((function e(t,n){var s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.a.HmacMD5(t,n);case 2:return s=e.sent,o="\\x"+s,e.abrupt("return",o);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var O=n(173),y=n.n(O),x="http://localhost:3500/ajax/acim";function k(e,t){return N.apply(this,arguments)}function N(){return(N=Object(u.a)(l.a.mark((function e(t,n){var s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=y.a.create({baseURL:x}),e.prev=1,e.next=4,s.post(t,n);case 4:return o=e.sent,e.abrupt("return",o);case 8:e.prev=8,e.t0=e.catch(1),console.log("error to fetch data from ".concat(x).concat(t)),console.log(e.t0);case 12:case"end":return e.stop()}}),e,null,[[1,8]])})))).apply(this,arguments)}function w(e){return S.apply(this,arguments)}function S(){return(S=Object(u.a)(l.a.mark((function e(t){var n,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"/authenticate/username",n={username:t},e.prev=2,e.next=5,k("/authenticate/username",n);case 5:return s=e.sent,console.log(" username  :"+t+" is valid "+s.data.usernameIsValid),e.abrupt("return",{usernameIsValid:s.data.usernameIsValid});case 10:e.prev=10,e.t0=e.catch(2),console.log("error in authenticateUsername"),console.log(e.t0);case 14:case"end":return e.stop()}}),e,null,[[2,10]])})))).apply(this,arguments)}function D(e,t){return T.apply(this,arguments)}function T(){return(T=Object(u.a)(l.a.mark((function e(t,n){var s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"/authenticate",s={username:t,password:n},e.prev=2,e.next=5,k("/authenticate",s);case 5:return o=e.sent,console.log(" authentication success for "+t+" "+o.data.found),e.abrupt("return",{isAuthenticated:o.data.found,username:o.data.row.username,num_user:o.data.row.num_user,type_user:o.data.row.type_user});case 10:e.prev=10,e.t0=e.catch(2),console.log("error in authenticate"),console.log(e.t0);case 14:case"end":return e.stop()}}),e,null,[[2,10]])})))).apply(this,arguments)}var L=n(0),C=function(e){Object(m.a)(n,e);var t=Object(h.a)(n);function n(e){var s;return Object(p.a)(this,n),(s=t.call(this,e)).changeSubmittedUsername=function(e){s.setState({submittedUsername:e.target.value})},s.changeSubmittedPassword=function(e){s.setState({submittedPassword:e.target.value})},s.checkCredentials=function(){var e=Object(u.a)(l.a.mark((function e(t){var n,o,i,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),s.state.usernameIsValid){e.next=9;break}return e.next=4,w(s.state.submittedUsername);case 4:n=e.sent,console.log(n),s.setState({usernameIsValid:n.usernameIsValid}),e.next=30;break;case 9:return console.log("authenticate username/password"),e.prev=10,e.next=13,D(s.state.submittedUsername,s.state.submittedPassword);case 13:if(o=e.sent,console.log(o),!o.isAuthenticated){e.next=25;break}return s.props.setCredentials({logged:!0,num_user:o.num_user,username:o.username,type_user:o.type_user}),e.next=19,g(v.code,o.username);case 19:return i=e.sent,e.next=22,g(f.code,o.username);case 22:r=e.sent,o.type_user===i&&s.props.history.push("/notify"),o.type_user===r&&s.props.history.push("/acim");case 25:e.next=30;break;case 27:e.prev=27,e.t0=e.catch(10),console.log("error in checkCrendentials",e.t0);case 30:case"end":return e.stop()}}),e,null,[[10,27]])})));return function(t){return e.apply(this,arguments)}}(),s.state={usernameIsValid:!1,submittedUsername:"",submittedPassword:""},s}return Object(d.a)(n,[{key:"render",value:function(){return Object(L.jsxs)("div",{className:"login",children:[Object(L.jsx)("div",{children:Object(L.jsx)("img",{src:"./base_logo_sans_texte.png",alt:"mptdn|acim",id:"logo"})}),Object(L.jsxs)("form",{className:"login_form",onSubmit:this.checkCredentials,children:[this.state.usernameIsValid?Object(L.jsx)("input",{type:"password",placeholder:"mot de passe",value:this.state.submittedPassword,onChange:this.changeSubmittedPassword,autoFocus:!0}):Object(L.jsx)("input",{type:"text",placeholder:"utilisateur",value:this.state.submittedUsername,onChange:this.changeSubmittedUsername,autoFocus:!0}),Object(L.jsxs)("button",{className:"my-button login-button",onClick:this.checkCredentials,children:[" ",">"," "]})]})]})}}]),n}(o.a.Component),M=n(10),I=(n(318),function(e){Object(m.a)(n,e);var t=Object(h.a)(n);function n(){return Object(p.a)(this,n),t.apply(this,arguments)}return Object(d.a)(n,[{key:"render",value:function(){return Object(L.jsxs)("div",{id:"layout",children:[Object(L.jsx)("main",{children:this.props.children}),Object(L.jsxs)("footer",{children:[Object(L.jsx)(M.b,{to:"/",children:"home"}),Object(L.jsx)(M.b,{to:"/info",children:"info"}),Object(L.jsx)(M.b,{to:"/acim",children:"acim"}),Object(L.jsx)(M.b,{to:"/notify",children:"notify"})]})]})}}]),n}(o.a.Component)),U=(n(323),n(11)),P=n(175),A=Object(P.io)("http://localhost:3500",{autoConnect:!1});A.onAny((function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),s=1;s<t;s++)n[s-1]=arguments[s];console.log("-- ".concat(e," "),n)}));var R={socket:A,connect:function(e,t,n){console.log(e,t,n),console.log(A),A.auth={username:e,type_user:t,num_user:n},A.connect()},disconnect:function(){console.log("my socket disconnect "),A.offAny(),A.disconnect()}},F=(n(349),n(32)),H=(n(350),n(351),n(352),function(e){Object(m.a)(n,e);var t=Object(h.a)(n);function n(e){var s;return Object(p.a)(this,n),(s=t.call(this,e)).flipFold=function(){var e=!s.state.folded;s.setState({folded:e})},s.state={folded:s.props.folded},s}return Object(d.a)(n,[{key:"render",value:function(){var e,t=this.props,n=t.children,s=t.title,o=t.titleStyle,i=this.state.folded;return e=i?Object(a.a)(Object(a.a)({},e),{},{maxHeight:"50px",minHeight:"50px"}):Object(a.a)(Object(a.a)({},e),{},{maxHeight:"500px"}),Object(L.jsxs)("div",{className:"foldableDiv",style:e,children:[Object(L.jsxs)("div",{className:"foldableDiv-title",style:o,onClick:this.flipFold,children:[Object(L.jsxs)("p",{children:[" ",s," "]}),Object(L.jsxs)("button",{onClick:this.flipFold,children:[i?"v":"^"," "]})]}),Object(L.jsx)("div",{className:"foldableDiv-children",children:n})]})}}]),n}(s.Component)),q=function(e){Object(m.a)(n,e);var t=Object(h.a)(n);function n(e){var s;return Object(p.a)(this,n),(s=t.call(this,e)).showDetails=function(){s.setState({detailsAreShown:!s.state.detailsAreShown})},s.goToIntervention=function(e){s.props.showSub(e)},s.state={detailsAreShown:!1},s}return Object(d.a)(n,[{key:"render",value:function(){var e,t,s,o=this,i=(this.props.isChild,this.props.intervention),r=i.date_programme,c=i.num_intervention,l=i.libelle_lieu,u=i.motif,p=i.intervention_type,d=i.libelle_intervention_type,m=i.tech_main_username,h=i.numero,b=i.done,j=i.probleme_resolu,f=i.libelle_probleme_tech_type,v=i.code_intervention_type,g=i.children,_=g&&g.length>0,O={display:"none"};return this.state.detailsAreShown&&(O={height:"80%"},e={height:"15%"},t={height:"fit-content"}),this.props.selected&&(t=Object(a.a)(Object(a.a)({},t),{},{background:"rgb(169, 200, 247)"})),t=b?Object(a.a)(Object(a.a)({},t),{},{borderLeft:"5px solid green",borderTop:"1px solid green",borderBottom:"1px solid green",borderRight:"1px solid green"}):Object(a.a)(Object(a.a)({},t),{},{borderLeft:"5px solid red"}),t=Object(a.a)(Object(a.a)({},t),{},{borderRadius:"0 5px 5px 0"}),g&&(s=g.map((function(e,t){return Object(L.jsx)(n,{intervention:e,showSub:o.props.showSub},e.num_intervention)}))),Object(L.jsxs)("div",{className:"toDo",style:t,children:[Object(L.jsxs)("div",{className:"toDo-sum",style:e,children:[Object(L.jsxs)("p",{children:[" #",h," ",Object(L.jsx)("br",{})," ",v," ",Object(L.jsx)("br",{})," ",c.substring(0,8)]}),Object(L.jsxs)("p",{children:[" ",new Date(r).toLocaleString("fr-FR")," "]}),Object(L.jsxs)("p",{children:[" ",l," "]}),Object(L.jsxs)("p",{id:"tache_description",children:[" ",p||d," "]}),Object(L.jsxs)("p",{id:"tech_main_username",children:[" ",m," "]}),Object(L.jsxs)("p",{children:[" Effectue : ",b?"OUI":"NON"," et ",j?"RESOLU":"NON-RESOLU"," "]}),Object(L.jsx)("button",{onClick:this.showDetails,children:" Details "})]}),Object(L.jsxs)("div",{className:"toDo-details",style:O,children:[Object(L.jsxs)("p",{children:[" Type : ",d,"  "]}),Object(L.jsxs)("p",{children:[" Motif : ",u," "]}),Object(L.jsxs)("p",{children:[" Lieu : ",l," "]}),Object(L.jsxs)("p",{children:[" Cr\xe8\xe8e par : ",m," "]}),Object(L.jsxs)("p",{children:[" ID intervention : ",c," "]}),Object(L.jsxs)("p",{children:[" Probleme constat\xe9 : ",f," "]}),_&&Object(L.jsx)(H,{title:"Suite ... ",folded:!0,children:Object(L.jsx)("div",{className:"childList",children:s})}),Object(L.jsx)("button",{onClick:function(){return o.goToIntervention(c)},children:this.props.selected?"Fermer":"Ouvrir"})]})]})}}]),n}(o.a.Component),W=function(e){Object(m.a)(n,e);var t=Object(h.a)(n);function n(e){var s;return Object(p.a)(this,n),(s=t.call(this,e)).componentDidMount=function(){console.log("ToDoList did mount"),s.props.socket.emit("get undone intervention",s.props.num_tech_main),s.props.socket.on("list undone intervention",(function(e){console.log("list undone intervention",e);var t,n=e.map((function(e,t){return{num_intervention:e.num_intervention,num_intervention_pere:e.num_intervention_pere,date_programme:e.date_programme,libelle_lieu:e.libelle,libelle_intervention_type:e.libelle_intervention_type,tech_main_username:e.username,motif:e.motif,numero:t+1,done:e.done,libelle_probleme_tech_type:e.libelle_probleme_tech_type,code_intervention_type:e.code_intervention_type}})),o=Object(F.a)(n);try{var i=function(){var e=t.value;e.children=n.filter((function(t){return t.num_intervention_pere===e.num_intervention}))};for(o.s();!(t=o.n()).done;)i()}catch(u){o.e(u)}finally{o.f()}console.log("new list intervention undone",n),s.props.setNbInterventionUndone&&s.props.setNbInterventionUndone(n.length);var r=new Date((new Date).setHours(23,59,59)).getTime(),a=n.filter((function(e){return new Date(e.date_programme).getTime()<=(new Date).getTime()})),c=n.filter((function(e){var t=new Date(e.date_programme).getTime();return t>new Date((new Date).setHours(0,0,0)).getTime()&&t<=r})),l=n.filter((function(e){return new Date(e.date_programme).getTime()>r}));console.log("newListToday",c),s.setState({interventionListUndone:n,interventionListUndoneLate:a,interventionListUndoneToday:c,interventionListUndoneFuture:l})})),s.props.socket.on("new intervention",(function(){console.log("new intervention todolist"),s.props.socket.emit("get undone intervention")})),s.props.socket.on("ended intervention",(function(){console.log("ended intervention todolist"),s.props.socket.emit("get undone intervention")}))},s.clickOnToDoList=function(){},s.componentWillUnmount=function(){console.log("ToDoList will unmount"),s.props.socket.off("list undone intervention")},s.displayToDo=function(e){return e.map((function(e){return Object(L.jsx)(q,{showSub:s.props.showSub,intervention:e},e.num_intervention)}))},s.state={interventionListUndone:[],interventionListUndoneLate:[],interventionListUndoneToday:[],interventionListUndoneFuture:[]},s}return Object(d.a)(n,[{key:"componentDidUpdate",value:function(){console.log("update toDoList")}},{key:"render",value:function(){var e=this.state,t=e.interventionListUndoneLate,n=e.interventionListUndoneToday,s=e.interventionListUndone,o=e.interventionListUndoneFuture,i="En retard : ".concat(t.length),r="Aujourd'hui : ".concat(n.length),a="A venir : ".concat(o.length),c="Toutes : ".concat(s.length);return Object(L.jsxs)("div",{id:"toDoList",onClick:this.clickOnToDoList,children:[Object(L.jsxs)("p",{children:[" ",this.props.topText||"Liste des taches a faire :"," "]}),Object(L.jsxs)("div",{className:"scroll_list",children:[Object(L.jsx)(H,{title:i,titleStyle:{color:"red"},folded:!0,children:Object(L.jsx)("div",{className:"scroll_list",children:this.displayToDo(this.state.interventionListUndoneLate)})}),Object(L.jsx)(H,{title:r,children:Object(L.jsx)("div",{className:"scroll_list",children:this.displayToDo(this.state.interventionListUndoneToday)})}),Object(L.jsx)(H,{title:a,folded:!0,children:Object(L.jsx)("div",{className:"scroll_list",children:this.displayToDo(this.state.interventionListUndoneFuture)})}),Object(L.jsx)(H,{title:c,folded:!0,children:Object(L.jsx)("div",{className:"scroll_list",children:this.displayToDo(this.state.interventionListUndone)})})]})]})}}]),n}(o.a.Component),E=(n(353),n(354),{code:"MAX",libelle:"tres urgent"}),V={code:"MID",libelle:"moyennement urgent"},Z={code:"MIN",libelle:"pas urgent"},B=function(e){Object(m.a)(n,e);var t=Object(h.a)(n);function n(e){var s;return Object(p.a)(this,n),(s=t.call(this,e)).showDetails=function(){s.state.commandAreShown||s.setState({detailsAreShown:!s.state.detailsAreShown})},s.showCommand=function(){s.setState({commandAreShown:!s.state.commandAreShown,detailsAreShown:!s.state.commandAreShown})},s.do=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=s.props.notif.num_notification,n=s.props.num_user;console.log("do the notif #".concat(t," ").concat(e," by ").concat(n)),s.props.socket.emit("tech_main do",{num_notification:t,num_app_user_tech_main:n,delai:e})},s.state={detailsAreShown:!1,commandAreShown:!1},s}return Object(d.a)(n,[{key:"render",value:function(){var e,t,n,s,o=this;switch(this.props.notif.statut_code){case E.code:e={borderLeft:"3px solid red"},n={color:"red",fontWeight:"bold"};break;case V.code:e={borderLeft:"3px solid yellow"},n={color:"yellow",fontWeight:"bold"};break;case Z.code:e={borderLeft:"3px solid blue"},n={color:"blue"}}return(this.state.detailsAreShown||this.state.commandAreShown)&&(s={height:"80%"},t={height:"15%"},e=Object(a.a)(Object(a.a)({},e),{},{height:"300px"})),Object(L.jsxs)("div",{className:"notif",style:e,children:[Object(L.jsxs)("div",{className:"notif-sum",style:t,children:[Object(L.jsxs)("div",{className:"probleme_type",children:[Object(L.jsxs)("p",{children:[" ",this.props.notif.probleme_type," "]}),Object(L.jsxs)("p",{children:[" ",this.props.notif.code," "]})]}),Object(L.jsxs)("div",{className:"probleme_statut",style:n,children:[Object(L.jsxs)("p",{children:[" ",this.props.notif.statut_libelle," "]}),Object(L.jsxs)("p",{children:[" ",this.props.notif.lieu," "]})]}),Object(L.jsxs)("div",{className:"date_envoie",children:[Object(L.jsx)("p",{children:" Date d'envoie : "}),Object(L.jsxs)("p",{children:[" ",this.props.notif.date_envoie," "]})]}),Object(L.jsx)("button",{onClick:this.showDetails,children:" Details "}),Object(L.jsx)("button",{onClick:this.showCommand,children:" repondre "})]}),this.state.detailsAreShown&&Object(L.jsxs)("div",{className:"notif-details",style:s,children:[Object(L.jsxs)("p",{children:[" Remarque : ",this.props.notif.remarque||"-"," "]}),Object(L.jsxs)("p",{children:[" Envoyee par : ",this.props.notif.sender_username||"-"," "]}),Object(L.jsx)("p",{children:" Details 1 "})]}),this.state.commandAreShown&&Object(L.jsxs)("div",{className:"notif-command",children:[Object(L.jsx)("button",{onClick:function(){return o.do()},children:"prendre en charge"}),Object(L.jsx)("button",{children:"faire patienter"}),Object(L.jsx)("button",{children:"ouvrir message"})]})]})}}]),n}(o.a.Component),Y=function(e){Object(m.a)(n,e);var t=Object(h.a)(n);function n(e){var s;return Object(p.a)(this,n),(s=t.call(this,e)).displayNotif=function(e){return e.map((function(e){return Object(L.jsx)(B,{notif:e,num_user:s.props.session.num_user,socket:s.props.socket},e.num_notification)}))},s.onClickOnNotifsList=function(){s.props.nbNewNotificationToZero()},s.componentDidMount=function(){s.props.nbNewNotificationToZero(),s.props.socket.emit("get notifs list unanswered"),s.props.socket.on("unanswered notifs list",(function(e){var t=e.map((function(e){return{num_notification:e.num_notification,sender_username:e.user_sender_username,probleme_type:e.probleme_type,probleme_code:e.code,statut_code:e.statut,statut_libelle:e.statut_libelle,lieu:e.lieu,remarque:e.remarque,date_envoie:new Date(e.date_envoie).toLocaleString("fr-FR")}}));s.props.setNbNewNotif&&s.props.setNbNewNotif(t.length),s.setState({unansweredNotifsList:t})})),s.props.socket.on("new notif",(function(e){s.props.socket.emit("get notifs list unanswered")})),s.props.socket.on("update notifs list unanswered",(function(){console.log("update notifs list unanswerd"),setTimeout((function(){s.props.socket.emit("get notifs list unanswered")}),2e3)}))},s.componentWillUnmount=function(){console.log("UNMOUNT notifsList"),s.props.socket.off("unanswered notifs list"),s.props.socket.off("update notifs list unanswered")},s.state={unansweredNotifsList:[]},s}return Object(d.a)(n,[{key:"render",value:function(){return Object(L.jsxs)("div",{id:"notifsList",onClick:this.onClickOnNotifsList,children:[Object(L.jsxs)("p",{children:[" Notifications recues ",this.props.session.username," "]}),Object(L.jsx)("div",{id:"scroll_list-notifsList",children:this.displayNotif(this.state.unansweredNotifsList)})]})}}]),n}(o.a.Component),z=n(31),J=(n(355),n(356),function(e){Object(m.a)(n,e);var t=Object(h.a)(n);function n(){return Object(p.a)(this,n),t.apply(this,arguments)}return Object(d.a)(n,[{key:"render",value:function(){var e=this,t=(this.props.array||[]).map((function(e){return Object(L.jsx)("option",{value:e,children:e},e)}));return this.props.objArray&&(t=this.props.objArray.map((function(e){return Object(L.jsx)("option",{value:e.value,children:e.libelle},e.key)}))),Object(L.jsx)("div",{className:"dropDown",children:Object(L.jsx)("select",{defaultValue:this.props.selectedValue,value:this.props.value,onChange:function(t){return e.props.onChange(t)},children:t})})}}]),n}(o.a.Component)),X=n(46),K=(n(357),n(358),n(359),n(360),function(e){Object(m.a)(n,e);var t=Object(h.a)(n);function n(){return Object(p.a)(this,n),t.apply(this,arguments)}return Object(d.a)(n,[{key:"render",value:function(){var e=this,t=(this.props.array||[]).map((function(e){return Object(L.jsx)("option",{value:e,children:e},e)}));return this.props.objArray&&(t=this.props.objArray.map((function(e){return Object(L.jsx)("option",{value:e.value,children:e.libelle},e.key)}))),Object(L.jsx)("div",{className:"dropDown",children:Object(L.jsx)("select",{defaultValue:this.props.selectedValue,value:this.props.value,onChange:function(t){return e.props.onChange(t)},children:t})})}}]),n}(o.a.Component)),G=function(e){Object(m.a)(n,e);var t=Object(h.a)(n);function n(e){var s;return Object(p.a)(this,n),(s=t.call(this,e)).updateMaterielType=function(e){console.log("updateMaterielType",e.target.value),console.log("this.materiel",s.materiels);var t={num:s.materiels[e.target.value][0].value,type:e.target.value,config:s.state.config};s.props.changeList(t),s.setState({selectedMaterielType:e.target.value,materielList:s.materiels[e.target.value]})},s.updateMateriel=function(e){console.log("updateMateriel",e.target.value);var t={num:e.target.value,type:s.state.selectedMaterielType,config:s.state.config};s.props.changeList(t)},s.updateConfig=function(e){var t={num:s.props.selectedNumMateriel,type:s.state.selectedMaterielType,config:e.target.value};s.props.changeList(t),s.setState({config:e.target.value})},s.state={materielTypes:[],selectedMaterielType:s.props.selectedMaterielType||"",materielList:[],config:""},s.materiels=null,s}return Object(d.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.props.socket.emit("get materiel list"),this.props.socket.on("materiel list -materielSelector",(function(t,n){var s;console.log("materiels",t);var o,i=Object(F.a)(n);try{var r=function(){var e=o.value;s=Object(a.a)(Object(a.a)({},s),{},Object(z.a)({},e.libelle_materiel_type,t.filter((function(t){return t.num_materiel_type===e.num_materiel_type})).map((function(e){return{key:e.num_materiel,value:e.num_materiel,libelle:e.libelle_materiel}}))))};for(i.s();!(o=i.n()).done;)r()}catch(l){i.e(l)}finally{i.f()}(n=n.map((function(e){return e.libelle_materiel_type}))).unshift("nd"),console.log("materielsList",s,n),e.materiels=s;var c=e.state.selectedMaterielType;e.setState({materielTypes:n,materielList:s[c]})}))}},{key:"componentWillUnmount",value:function(){console.log("materielSelector unmount"),this.props.socket.off("materiel list -materielSelector")}},{key:"render",value:function(){var e=this.state,t=e.materielTypes,n=e.materielList,s=e.config,o=this.props,i=o.selectedNumMateriel,r=o.selectedMaterielType,a=this.props.title;return Object(L.jsx)("div",{className:"materielSelector",children:Object(L.jsxs)(H,{title:a||"Materiel",children:[Object(L.jsxs)("div",{className:"sub-category-option",children:[Object(L.jsx)("label",{children:" Type materiel:"}),Object(L.jsx)(K,{value:r,array:t,onChange:this.updateMaterielType})]}),Object(L.jsxs)("div",{className:"sub-category-option",children:[Object(L.jsx)("label",{children:" Materiel:"}),Object(L.jsx)(K,{value:i,objArray:n,onChange:this.updateMateriel})]}),Object(L.jsx)("div",{className:"sub-category-option",children:Object(L.jsxs)("label",{children:[" Note:",Object(L.jsx)("textarea",{value:s,onChange:this.updateConfig,children:" "})]})})]})})}}]),n}(s.Component);function Q(e){var t=e.listMateriel,n=e.maxListMaterielLength?e.maxListMaterielLength:77,s=e.title?e.title:"Selectionner le(s) materiel(s)",o=!!e.folded&&e.folded;function i(s){console.log("changeListMaterielLength",s),s=(s=s<0?0:s)>n?n:s;var o=t.slice();if(s>o.length){var i=s-o.length;console.log("dLength",i);for(var r=0;r<i;r++)o.push({num:"nd",type:"nd"})}else s<o.length&&(o.length=s);e.setListMateriel(o)}console.log("listMateriel before render",t);var r=t.map((function(n,s){return Object(L.jsx)(G,{title:"Materiel #".concat(s+1),socket:e.socket,changeList:function(n){return function(n,s){console.log("changeListMateriel");var o=t.slice();o[s]=n,e.setListMateriel(o)}(n,s)},selectedNumMateriel:n.num,selectedMaterielType:n.type},s)}));return Object(L.jsx)("div",{className:"multiMaterielSelector",children:Object(L.jsxs)(H,{title:s,folded:o,children:[Object(L.jsxs)("p",{children:[" Nombres : ",t.length]}),Object(L.jsx)("div",{className:"scroll_list",children:r}),n>1&&Object(L.jsxs)(L.Fragment,{children:[Object(L.jsx)("button",{onClick:function(){return i(t.length+1)},children:" + "}),Object(L.jsx)("button",{onClick:function(){return i(t.length-1)},children:" - "})]})]})})}function $(e){var t,n,o,i=new Date((new Date).setDate((new Date).getDate()+1)),r=Object(s.useState)([{num:"nd",type:"nd"}]),c=Object(X.a)(r,2),l=c[0],u=c[1],p=Object(s.useState)(new Date),d=Object(X.a)(p,2),m=d[0],h=d[1],b=Object(s.useState)(i),j=Object(X.a)(b,2),f=j[0],v=j[1],g=e.num_decharge,_="Effectuer un decharge";return g?(_="ID decharge : ".concat(g),t=Object(a.a)(Object(a.a)({},t),{},{background:"#53d35342"}),n=Object(L.jsx)("button",{onClick:function(){return e.downloadDecharge(g)},children:" Telecharger "}),o=!0):n=Object(L.jsx)("button",{onClick:function(){var t=l.filter((function(e){return"nd"!==e.num&&"nd"!==e.type}));if(console.log("materielsValide",t),t.length&&m.getTime()<=f.getTime()&&!g){console.log("createDecharge",m,f,t);var n={debut:m,fin:f};e.socket.emit("create decharge",n,t)}else console.log("pas de materiels valide OU date invalide, InterventionDecharge")},children:" Creer "}),console.log("render InterventionDecharge"),Object(L.jsx)("div",{className:"interventionDecharge",style:t,children:Object(L.jsx)(H,{title:_,folded:!0,children:Object(L.jsxs)("div",{className:"decharge-form",children:[Object(L.jsxs)("label",{children:[" Debut :",Object(L.jsx)("input",{type:"date",value:ee(m),onChange:function(e){console.log("updateDateDebut",e.target.value),h(new Date(e.target.value))},disabled:o})]}),Object(L.jsxs)("label",{children:[" Fin :",Object(L.jsx)("input",{type:"date",value:ee(f),onChange:function(e){return v(new Date(e.target.value))},disabled:o})]}),Object(L.jsx)(Q,{socket:e.socket,listMateriel:l,setListMateriel:u}),n]})})})}function ee(e){var t="".concat(e.getDate()),n="".concat(e.getMonth()+1),s=e.getFullYear();return n=n.length<2?"0"+n:n,t=t.length<2?"0"+t:t,"".concat(s,"-").concat(n,"-").concat(t)}var te=function(e){Object(m.a)(n,e);var t=Object(h.a)(n);function n(e){var s;Object(p.a)(this,n),(s=t.call(this,e)).updateTypeIntervention=function(e){console.log("update type intervention",e.target.value);var t=e.target.value;s.setState({selectedNumInterventionType:t})},s.updateDateProgramme=function(e){console.log("updateDateProgramme ",new Date(e.target.value));var t=new Date(e.target.value);s.setState({dateProgramme:t,dateProgrammeDisplay:e.target.value})},s.updateLieu=function(e,t){console.log("update lieu",e.target.value),console.log(t);var n=e.target.value;s.setState({selectedNumLieu:n})},s.updateMaterielType=function(e){console.log("updateMaterielType",e.target.value),console.log("this.materiel",s.materiels),s.setState({selectedMaterielType:e.target.value,materielList:s.materiels[e.target.value]})},s.updateMateriel=function(e){console.log("updateMateriel",e.target.value),s.setState({selectedNumMateriel:e.target.value})},s.updateMotif=function(e){console.log("update motif",e.target.value),s.setState({motif:e.target.value})},s.updateProbleme=function(e,t){console.log("update probleme",e.target.value),console.log(s.problemeTechTypes);var n,o,i=s.problemeTechTypes[e.target.value],r=t||s.state.selectedNumLieu;n=s.lieus[r],o=i?"Resoudre probleme : ".concat(i," -- ").concat(n):s.state.motif,console.log("motif",o),s.setState({motif:o,selectedNumProblemeTechType:e.target.value||"",selectedNumLieu:r})},s.createIntervention=function(){var e=s.state,t=e.selectedNumInterventionType,n=e.dateProgramme,o=e.selectedNumLieu,i=e.selectedNumProblemeTechType,r=e.selectedNumMateriel,a=e.motif,c=e.num_intervention_pere;t&&o&&n?(console.log("create intervention : ",t,"",o,n,a,r,i,c),s.props.socket.emit("create intervention",t,"",o,n,a,r,i,c),s.setState({message:"intervention Creer lance"})):s.setState({message:"selectionner un type d'intervention, un lieu et une date programm\xe9e"})};var o=(new Date).getHours()+1;return s.state={interventionTypeList:[],selectedNumInterventionType:"",dateProgramme:new Date((new Date).setHours(o,0,0)).toISOString(),dateProgrammeDisplay:new Date((new Date).setHours(o+3,0,0,0)).toISOString().replace("Z",""),lieuList:[],selectedNumLieu:"",materielList:[],selectedNumMateriel:"",materielTypes:[],selectedMaterielType:"",motif:"ND",problemeList:[],selectedNumProblemeTechType:"",message:"",num_intervention_pere:""},s.materiels=null,s.lieus=null,s.problemeTechTypes=null,s}return Object(d.a)(n,[{key:"componentDidMount",value:function(){var e=this;console.log("createIntervention did mount"),this.props.socket.emit("get intervention definition"),this.props.socket.on("intervention_type list",(function(t){console.log(" intervention_types ",t);var n=t.map((function(e){return{key:e.num_intervention_type,value:e.num_intervention_type,libelle:e.libelle_intervention_type}})),s=n[0].key;e.props.location.state&&e.props.location.state.num_intervention_type&&(s=e.props.location.state.num_intervention_type),e.setState({interventionTypeList:n,selectedNumInterventionType:s})})),this.props.socket.on("lieu list",(function(t){console.log("lieus",t);var n,s=Object(F.a)(t);try{for(s.s();!(n=s.n()).done;){var o=n.value;e.lieus=Object(a.a)(Object(a.a)({},e.lieus),{},Object(z.a)({},o.num_lieu,[o.libelle]))}}catch(r){s.e(r)}finally{s.f()}var i=t.map((function(e){return{key:e.num_lieu,value:e.num_lieu,libelle:e.libelle}}));e.setState({lieuList:i,selectedNumLieu:i[0].value})})),this.props.socket.on("materiel list",(function(t,n){var s;console.log("materiels",t);var o,i=Object(F.a)(n);try{var r=function(){var e=o.value;s=Object(a.a)(Object(a.a)({},s),{},Object(z.a)({},e.libelle_materiel_type,t.filter((function(t){return t.num_materiel_type===e.num_materiel_type})).map((function(e){return{key:e.num_materiel,value:e.num_materiel,libelle:e.libelle_materiel}}))))};for(i.s();!(o=i.n()).done;)r()}catch(c){i.e(c)}finally{i.f()}n=n.map((function(e){return e.libelle_materiel_type})),console.log("materielsList",s,n),e.materiels=s,e.setState({materielTypes:n,selectedMaterielType:n[0],materielList:s[n[0]]})})),this.props.socket.on("probleme_tech_type list",(function(t){console.log("probleme_tech_types",t);var n,s=Object(F.a)(t);try{for(s.s();!(n=s.n()).done;){var o=n.value;e.problemeTechTypes=Object(a.a)(Object(a.a)({},e.problemeTechTypes),{},Object(z.a)({},o.num_probleme_tech_type,o.libelle_probleme_tech_type))}}catch(r){s.e(r)}finally{s.f()}var i=t.map((function(e){return{key:e.num_probleme_tech_type,value:e.num_probleme_tech_type,libelle:e.libelle_probleme_tech_type}}));e.setState({problemeList:i})})),this.props.socket.on("new intervention",(function(t){var n=t.num_intervention;console.log("new intervention createIntervention"),e.setState({message:"Intervention ".concat(n," cr\xe9\xe9e.")})})),this.props.location.state&&this.setState({num_intervention_pere:this.props.location.state.num_intervention_pere,selectedNumInterventionType:this.props.location.state.num_intervention_type})}},{key:"componentWillUnmount",value:function(){this.props.socket.off("intervention_type list"),this.props.socket.off("lieu list"),this.props.socket.off("materiel list"),this.props.socket.off("probleme_tech_type list")}},{key:"render",value:function(){var e=this,t=this.state,n=t.interventionTypeList,s=t.selectedNumInterventionType,o=t.lieuList,i=t.selectedNumLieu,r=t.materielList,a=t.selectedNumMateriel,c=t.materielTypes,l=t.selectedMaterielType,u=t.motif,p=t.selectedNumProblemeTechType,d=t.problemeList,m=t.message,h=t.num_intervention_pere;return Object(L.jsxs)("div",{className:"createIntervention",children:[Object(L.jsx)("p",{children:" Cr\xe9er une intervention :"}),h&&Object(L.jsxs)("p",{children:[" Suite de l'intervention : ",h," "]}),Object(L.jsxs)("div",{className:"scroll-option",children:[Object(L.jsxs)(H,{title:"Intervention",folded:!1,children:[Object(L.jsxs)("div",{className:"sub-category-option",children:[Object(L.jsx)("label",{children:" Type Intervention :"}),Object(L.jsx)(J,{value:s,objArray:n,onChange:this.updateTypeIntervention})]}),Object(L.jsxs)("div",{className:"sub-category-option",children:[Object(L.jsx)("label",{children:" Date programm\xe9e :"}),Object(L.jsx)("input",{type:"datetime-local",value:this.state.dateProgrammeDisplay,onChange:this.updateDateProgramme})]}),Object(L.jsxs)("div",{className:"sub-category-option",children:[Object(L.jsx)("label",{children:" Lieu :"}),Object(L.jsx)(J,{value:i,objArray:o,onChange:function(t){e.updateProbleme({target:{value:p}},t.target.value)}})]})]}),Object(L.jsxs)(H,{title:"Materiel",folded:!0,children:[Object(L.jsxs)("div",{className:"sub-category-option",children:[Object(L.jsx)("label",{children:" Type materiel:"}),Object(L.jsx)(J,{value:l,array:c,onChange:this.updateMaterielType})]}),Object(L.jsxs)("div",{className:"sub-category-option",children:[Object(L.jsx)("label",{children:" Materiel:"}),Object(L.jsx)(J,{value:a,objArray:r,onChange:this.updateMateriel})]})]}),Object(L.jsxs)(H,{title:"Motif",folded:!0,children:[Object(L.jsxs)("div",{className:"sub-category-option",children:[Object(L.jsx)("label",{children:" Motif :"}),Object(L.jsx)("textarea",{value:u,onChange:this.updateMotif})]}),Object(L.jsxs)(H,{title:"Probleme",folded:!0,children:[Object(L.jsxs)("div",{className:"sub-category-option",children:[Object(L.jsx)("label",{children:" Type du probleme:"}),Object(L.jsx)(J,{value:p,objArray:d,onChange:this.updateProbleme})]}),Object(L.jsxs)("div",{className:"sub-category-option",children:[Object(L.jsx)("label",{children:" Lieu :"}),Object(L.jsx)(J,{value:i,objArray:o,onChange:function(t){e.updateProbleme({target:{value:p}},t.target.value)}})]})]})]})]}),Object(L.jsx)("button",{onClick:this.createIntervention,children:" Planifier "}),Object(L.jsxs)("p",{children:[" ",m," "]})]})}}]),n}(s.Component),ne=function(e){Object(m.a)(n,e);var t=Object(h.a)(n);function n(e){var s;return Object(p.a)(this,n),(s=t.call(this,e)).nbInterventionUndonePlus=function(e){console.log("nbInterventionUndonePlus",e);var t=e;t=parseInt(t),s.setState({nbInterventionUndone:t})},s.nbNewNotificationPlus=function(e){console.log("nbNewNotificationPlus",e);var t=e;t=parseInt(t),s.setState({nbNewNotification:t})},s.componentDidMount=function(){console.log("DASHBOARD did mount"),s.props.socket.emit("get nb intervention undone"),s.props.socket.on("nb intervention undone",(function(e){console.log("nb intervention undone"),s.setState({nbInterventionUndone:e})})),s.props.socket.on("new intervention",(function(){console.log("new intervention dashboard"),s.props.socket.emit("get nb intervention undone")})),s.props.socket.on("ended intervention",(function(){console.log(" ended intervention dashboard"),s.props.socket.emit("get nb intervention undone")}))},s.componentWillUnmount=function(){s.props.socket.off("nb intervention undone"),s.props.socket.off("new intervention "),s.props.socket.off("ended intervention"),s.props.socket.off("materiel list")},s.state={nbInterventionUndone:0,nbNewNotification:0},s}return Object(d.a)(n,[{key:"render",value:function(){var e=this,t=this.props.match,n=t.path,s=t.url;return Object(L.jsx)("div",{className:"dashboard",children:Object(L.jsxs)("div",{className:"main-dashboard",style:undefined,children:[Object(L.jsxs)("nav",{id:"nav_dashboard",children:[Object(L.jsxs)(M.c,{activeClassName:"active_navLink_dashboard",to:"".concat(s,"/toDo"),children:[" Interventions a faire ",this.state.nbInterventionUndone>0?"(".concat(this.state.nbInterventionUndone,")"):""," "]}),Object(L.jsxs)(M.c,{activeClassName:"active_navLink_dashboard",to:"".concat(s,"/notifs"),children:[" Notifications ",this.state.nbNewNotification>0?"(".concat(this.state.nbNewNotification,")"):""]}),Object(L.jsx)(M.c,{activeClassName:"active_navLink_dashboard",to:"".concat(s,"/creer"),children:" Creer "})]}),Object(L.jsx)("div",{id:"display_dashboard",children:Object(L.jsxs)(U.d,{children:[Object(L.jsx)(U.a,{exact:!0,from:n,to:"".concat(n,"/toDo")}),Object(L.jsx)(U.b,{path:"".concat(n,"/toDo"),render:function(t){return Object(L.jsx)(W,Object(a.a)(Object(a.a)({setNbInterventionUndone:e.nbInterventionUndonePlus},t),e.props))}}),Object(L.jsx)(U.b,{path:"".concat(n,"/notifs"),render:function(t){return Object(L.jsx)(Y,Object(a.a)(Object(a.a)(Object(a.a)({},t),e.props),{},{setNbNewNotif:e.nbNewNotificationPlus}))}}),Object(L.jsx)(U.b,{path:"".concat(n,"/creer"),render:function(t){return Object(L.jsx)(te,Object(a.a)(Object(a.a)({},t),e.props))}})]})})]})})}}]),n}(o.a.Component),se=(n(361),n(362),function(e){Object(m.a)(n,e);var t=Object(h.a)(n);function n(e){var s;return Object(p.a)(this,n),(s=t.call(this,e)).showDetails=function(){s.setState({detailsAreShown:!s.state.detailsAreShown})},s.state={detailsAreShown:!1},s}return Object(d.a)(n,[{key:"render",value:function(){var e,t,n,s;switch(this.props.notif.statut_code){case E.code:e={borderLeft:"3px solid red"},n={color:"red",fontWeight:"bold"};break;case V.code:e={borderLeft:"3px solid yellow"},n={color:"yellow",fontWeight:"bold"};break;case Z.code:e={borderLeft:"3px solid blue"},n={color:"blue"}}return this.state.detailsAreShown&&(s={height:"80%"},t={height:"15%"},e=Object(a.a)(Object(a.a)({},e),{},{height:"300px"})),this.props.notif.num_app_user_tech_main&&this.props.notif.date_reponse&&(e=Object(a.a)(Object(a.a)({},e),{},{background:"#a9c8f7"})),Object(L.jsxs)("div",{className:"notif_history",style:e,children:[Object(L.jsxs)("div",{className:"notif_history-sum",style:t,children:[Object(L.jsxs)("div",{className:"probleme_type",children:[Object(L.jsxs)("p",{children:[" ",this.props.notif.probleme_type," "]}),Object(L.jsxs)("p",{children:[" ",this.props.notif.code," "]})]}),Object(L.jsxs)("div",{className:"probleme_statut",style:n,children:[Object(L.jsxs)("p",{children:[" ",this.props.notif.statut_libelle," "]}),Object(L.jsxs)("p",{children:[" ",this.props.notif.lieu," "]})]}),Object(L.jsx)("div",{className:"user_sender_username",children:Object(L.jsxs)("p",{children:[" par : ",this.props.notif.user_sender_username," "]})}),Object(L.jsxs)("div",{className:"date_envoie",children:[Object(L.jsx)("p",{children:" Date d'envoie : "}),Object(L.jsxs)("p",{children:[" ",this.props.notif.date_envoie," "]})]}),Object(L.jsx)("button",{onClick:this.showDetails,children:" Details "})]}),this.state.detailsAreShown&&Object(L.jsxs)("div",{className:"notif-details",style:s,children:[Object(L.jsxs)("p",{children:[" remarque: ",this.props.notif.remarque," "]}),Object(L.jsxs)("p",{children:[" envoyee par : ",this.props.notif.user_sender_username," "]}),Object(L.jsxs)("p",{children:[" pris en charge par : ",this.props.notif.tech_main_username,"  "]}),Object(L.jsxs)("p",{children:[" repondue le : ",this.props.notif.date_reponse," "]}),Object(L.jsxs)("p",{children:[" ID notification : ",this.props.notif.num_notification," "]}),Object(L.jsx)("p",{children:" Details 1 "})]})]})}}]),n}(o.a.Component)),oe=function(e){Object(m.a)(n,e);var t=Object(h.a)(n);function n(e){var s;return Object(p.a)(this,n),(s=t.call(this,e)).componentDidMount=Object(u.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log(" NOTIFSHISTORY did mount "),s.props.socket.emit("get notifs history"),s.props.socket.on("notifs history",(function(e){console.log("notification history for tech_main",e);var t=e.map((function(e){return Object(a.a)(Object(a.a)({},e),{},{statut_code:e.statut,statut_libelle:e.statut_libelle,remarque:e.remarque||"-",date_envoie:new Date(e.date_envoie).toLocaleString("fr-FR"),tech_main_username:e.tech_main_username||"-",date_reponse:e.date_reponse?new Date(e.date_reponse).toLocaleString("fr-FR"):"-"})}));console.log("newNotifsTab",t),s.setState({notifsTab:t})})),s.props.socket.emit("get users list"),s.props.socket.on("users list",(function(e){console.log("users list",e),e.push({num_user:0,username:"all"}),s.setState({usersList:e})}));case 5:case"end":return e.stop()}}),e)}))),s.componentDidUpdate=function(){console.log("NOTIFSHISTORY update")},s.updateSelectedUser=function(e){"all"!==e.target.value?s.props.socket.emit("get notifs history",e.target.value):s.props.socket.emit("get notifs history"),s.setState({selectedUser:e.target.value})},s.componentWillUnmount=function(){s.props.socket.off("notifs history"),s.props.socket.off("users list")},s.showNotifs=function(e){return e.map((function(e){return Object(L.jsx)(se,{notif:e},e.num_notification)}))},s.state={notifsTab:[],usersList:[],selectedUser:"all"},s}return Object(d.a)(n,[{key:"render",value:function(){var e=this.state.usersList.map((function(e){return{key:e.num_user,value:e.num_user,libelle:e.username}}));return Object(L.jsxs)("div",{className:"notifsHistory",children:[Object(L.jsxs)("div",{className:"notifsHistory-select",children:[Object(L.jsx)("p",{children:" Historiques des notifications envoyer par :"}),Object(L.jsx)(J,{objArray:e,value:this.state.selectedUser,onChange:this.updateSelectedUser})]}),Object(L.jsx)("div",{className:"notifsHistory-list",children:this.showNotifs(this.state.notifsTab)})]})}}]),n}(o.a.Component),ie=(n(363),n(364),function(e){Object(m.a)(n,e);var t=Object(h.a)(n);function n(e){var s;return Object(p.a)(this,n),(s=t.call(this,e)).state={problemeTechTypeArray:[],lieuArray:[]},s}return Object(d.a)(n,[{key:"componentDidMount",value:function(){var e=this;console.log("probleme constate mounted"),this.props.socket.emit("get probleme_tech_type list"),this.props.socket.emit("get lieu list"),this.props.socket.on("probleme_tech_type list -problemeTechConstate",(function(t){console.log("probleme_tech_types list",t);var n=t.map((function(e){return{key:e.num_probleme_tech_type,value:e.num_probleme_tech_type,libelle:e.libelle_probleme_tech_type}}));n.unshift({key:"nd",value:"nd",libelle:"nd"}),e.setState({problemeTechTypeArray:n})})),this.props.socket.on("lieu list -problemeTechConstate",(function(t){console.log("lieus",t);var n=t.map((function(e){return{key:e.num_lieu,value:e.num_lieu,libelle:e.libelle}}));n.unshift({key:"nd",value:"nd",libelle:"nd"}),e.setState({lieuArray:n})}))}},{key:"componentWillUnmount",value:function(){console.log("ProblemeTechConstate unmount"),this.props.socket.off("probleme_tech_type list -problemeTechConstate"),this.props.socket.off("lieu list -problemeTechConstate")}},{key:"render",value:function(){var e=this.props,t=e.numProblemeTechType,n=e.numLieu,s=e.remarque,o=e.onChangeProblemeTechType,i=e.onChangeLieu,r=e.onChangeRemarque,a=this.state,c=a.problemeTechTypeArray,l=a.lieuArray;return Object(L.jsx)("div",{className:"problemeTechConstate",children:Object(L.jsxs)(H,{title:"Probleme constat\xe9",folded:!0,children:[Object(L.jsx)(K,{objArray:c,value:t,onChange:o}),Object(L.jsx)(K,{objArray:l,value:n,onChange:i}),Object(L.jsx)("textarea",{placeholder:"Remarque",value:s,onChange:r})]})})}}]),n}(s.Component));n(365);function re(e){var t=e.log?e.log.split(";"):[""];function n(n,s){if(n.preventDefault(),s>t.length)for(var o=0,i=s-t.length;o<i;o++)t.push("");else s<t.length&&(t.length=s);e.updateLog(t.join(";"))}console.log("etapes before render",t);var s=t.map((function(n,s){return Object(L.jsx)("input",{value:n,placeholder:"etape #".concat(s+1),onChange:function(n){return function(n,s){console.log("change Etapes",s);var o=t.slice();o[s]=n,e.updateLog(o.join(";"))}(n.target.value,s)}},s)}));return Object(L.jsx)("div",{className:"interventionLog",children:Object(L.jsx)(H,{title:"Log",folded:!0,children:Object(L.jsxs)("form",{onSubmit:function(e){return n(e,t.length+1)},children:[s,Object(L.jsx)("button",{onClick:function(e){return n(e,t.length+1)},children:" + "}),Object(L.jsx)("button",{onClick:function(e){return n(e,t.length-1)},children:" - "})]})})})}var ae=function(e){Object(m.a)(n,e);var t=Object(h.a)(n);function n(e){var s;return Object(p.a)(this,n),(s=t.call(this,e)).updateMateriel=function(e){s.setState({materiels:e})},s.updateProblemeTechType=function(e){var t=e.target.value;s.setState({selectedNumProblemeTechType:t})},s.updateLieu=function(e){var t=e.target.value;s.setState({selectedNumLieu:t})},s.updateRemarque=function(e){var t=e.target.value;s.setState({remarque:t})},s.updateLog=function(e){s.setState({log:e})},s.updatePwd=function(e){var t=e.target.value;s.setState({pwd:t})},s.authenticate=function(e){e.preventDefault();var t=s.state.pwd;t&&s.props.socket.emit("authenticate intervention tech_main",s.state.num_intervention,t)},s.startIntervention=function(){var e=s.state.intervention.num_intervention;console.log("start intervention"),s.state.techMainIsAuth&&s.props.socket.emit("start intervention",e)},s.endIntervention=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=s.state.intervention,n=t.num_intervention,o=t.date_debut;o||console.log("pas de date de debut mais problem OK"),console.log("resolu",e),console.log("end intervention"),s.state.techMainIsAuth&&s.props.socket.emit("end intervention",n,e,o)},s.updateIntervention=function(){var e=s.state.intervention.num_intervention,t=s.state,n=t.log,o=t.selectedNumProblemeTechType,i=t.selectedNumLieu,r=t.remarque,a=t.num_decharge,c=t.materiels;console.log("updateIntervention",e,n,o,i);if(e){if(n&&(console.log("emit udpdate intervention info log"),s.props.socket.emit("update intervention info log",e,n)),"nd"!==o&&"nd"!==i){console.log("emit update intervention info probleme_tech");var l={num_probleme_tech_type:o,num_lieu:i,remarque:r};s.props.socket.emit("update intervention info probleme_tech",e,l)}a&&(console.log("emit update decharge intervention"),s.props.socket.emit("update decharge intervention",a,e)),c.length>0&&!(c.filter((function(e){return"nd"===e.num})).length>0)&&(console.log("emit update intervention info num_materiel"),s.props.socket.emit("update intervention info num_materiel",e,c[0].num))}},s.openCreateIntervention=function(){s.props.closeSub();var e={num_intervention_pere:s.state.num_intervention,num_intervention_type:"a768355e-3cd2-497c-b579-d4e184b61298"};s.props.history.push("/acim/dashboard/creer",e)},s.getDecharge=function(e){var t=new URL(document.location.href),n="/pdf/acim/decharge/".concat(e);t.port=3500,t.pathname=n,console.log("s_URL",t),window.open(t,"_blank")},s.state={techMainIsAuth:!1,num_intervention:s.props.num_intervention,intervention:{},pwd:"",selectedNumProblemeTechType:"nd",selectedNumLieu:"nd",remarque:"",log:"etape1 ; etape2; etape3;",num_decharge:"",materiels:[{num:"nd",type:"nd"}]},s}return Object(d.a)(n,[{key:"componentDidMount",value:function(){var e=this;console.log("intervention page mounted"),console.log(this.props.socket),this.props.socket.emit("get intervention data",this.props.num_intervention),this.props.socket.on("intervention data",(function(t){console.log("intervention data",t),e.setState({intervention:t,log:t.log,num_decharge:t.num_decharge})})),this.props.socket.on("tech_main is authenticated",(function(t){t===e.state.num_intervention&&(console.log("tech is auth to true"),e.setState({techMainIsAuth:!0,pwd:""}))})),this.props.socket.on("started intervention",(function(t){console.log("intervention started ",t.num_intervention,t.date_debut),e.state.num_intervention===t.num_intervention&&e.setState({intervention:t})})),this.props.socket.on("ended intervention interventionPage",(function(t){console.log("intervention ended ",t.num_intervention,t.date_debut),e.state.num_intervention===t.num_intervention&&e.setState({intervention:t})})),this.props.socket.on("new decharge",(function(t){var n=t.num_decharge;e.setState({num_decharge:n})}))}},{key:"componentDidUpdate",value:function(){var e;(console.log("intervention page updated",this.props.num_intervention),this.props.num_intervention!==this.state.num_intervention)&&(this.props.socket.emit("get intervention data",this.props.num_intervention),e=this.props.num_intervention?this.state.intervention:{},this.setState({num_intervention:this.props.num_intervention,techMainIsAuth:!1,intervention:e,num_decharge:""}))}},{key:"componentWillUnmount",value:function(){console.log("interventionPage unmount"),this.props.socket.off("intervention data"),this.props.socket.off("tech_main is authenticated"),this.props.socket.off("started intervention"),this.props.socket.off("new decharge")}},{key:"render",value:function(){var e,t,n=this,s=this.state.intervention,o=s.tech_main_username,i=s.libelle_intervention_type,r=s.motif,a=s.libelle_lieu,c=s.date_programme,l=s.date_debut,u=s.date_fin,p=s.done,d=s.probleme_resolu,m=s.libelle_probleme_tech_type,h=s.log,b=s.lieu_probleme_tech,j=s.num_decharge,f=s.num_materiel,v=s.libelle_materiel,g=s.libelle_materiel_type,_=s.children,O=s.num_intervention_pere;h&&(t=(e=h.split(";")).map((function(e,t){return Object(L.jsx)("li",{children:e},t)})));var y=this.state,x=y.selectedNumProblemeTechType,k=y.selectedNumLieu,N=y.remarque,w=y.log,S=y.num_decharge,D=y.materiels,T=this.props,C=T.style,M=T.closeSub;l&&(l=new Date(l).toLocaleString("fr-FR")),c&&(c=new Date(c).toLocaleString("fr-FR")),u&&(u=new Date(u).toLocaleString("fr-FR"));var I,U,P,A=this.props.num_intervention,R=Object(L.jsxs)(L.Fragment,{children:[!l&&Object(L.jsx)("button",{onClick:this.startIntervention,children:" Commencer "}),!p&&Object(L.jsx)("button",{onClick:function(){return n.endIntervention()},children:" Terminer "}),!d&&Object(L.jsx)("button",{onClick:function(){return n.endIntervention(!0)},children:" Termin\xe9 & R\xe9solu "}),!d&&p&&"/acim"===this.props.match.path&&Object(L.jsx)("button",{onClick:this.openCreateIntervention,children:" Creer une intervention suite "})]});(console.log("children",_),_&&(U=_.map((function(e){return Object(L.jsxs)("li",{children:["Intervention #",Object(L.jsxs)("button",{onClick:function(){return n.props.showSub(e.num_intervention)},children:[" ",e.num_intervention," "]})]},e.num_intervention)}))),this.state.techMainIsAuth)?(P=Object(L.jsxs)(L.Fragment,{children:[O&&Object(L.jsxs)("p",{children:[" ","Suite de l'intervention : ",Object(L.jsxs)("button",{onClick:function(){return n.props.showSub(O)},children:[" ",O," "]})]}),Object(L.jsxs)("p",{children:[" Type : ",i," "]}),Object(L.jsxs)("p",{children:[" Motif : ",r," "]}),Object(L.jsxs)("p",{children:[" Lieu : ",a," "]}),Object(L.jsxs)("p",{children:[" Faite par : ",o," "]}),Object(L.jsxs)("p",{children:[" Programme le : ",c," "]}),Object(L.jsxs)("p",{children:[" Debutee le : ",l," "]}),Object(L.jsxs)("p",{children:[" Terminee le : ",u," "]}),m&&Object(L.jsxs)("p",{children:[" Probleme constat\xe9 : ",m," -- ",b," "]}),h&&Object(L.jsxs)("p",{children:["".concat(e.length>1?"Etapes suivies":"Etape suivie")," :",t]}),j&&Object(L.jsxs)("p",{children:["ID decharge : ",Object(L.jsxs)("button",{onClick:function(){return n.getDecharge(j)},children:[" ",j," "]})]}),f&&Object(L.jsxs)("p",{children:["Intervention sur : ",g," -- ",v]}),Object(L.jsxs)("p",{children:[" Probleme resolue : ",d?"OUI":"NON"," "]}),_.length>0&&Object(L.jsxs)("p",{children:["Suite : ",U]})]}),I=Object(L.jsxs)(L.Fragment,{children:[Object(L.jsxs)("div",{className:"intervention-form",children:[Object(L.jsx)(H,{title:"INFO",children:P}),Object(L.jsx)("div",{className:"intervention-modifier",children:Object(L.jsxs)(H,{title:"Modifier",folded:!0,children:[Object(L.jsx)(ie,{numProblemeTechType:x,numLieu:k,remarque:N,onChangeProblemeTechType:this.updateProblemeTechType,onChangeLieu:this.updateLieu,onChangeRemarque:this.updateRemarque,socket:this.props.socket}),Object(L.jsx)(re,{log:w,updateLog:this.updateLog}),Object(L.jsx)(Q,{socket:this.props.socket,listMateriel:D,setListMateriel:this.updateMateriel,maxListMaterielLength:1,title:"Objet de l'intervention",folded:!0}),Object(L.jsx)($,{socket:this.props.socket,num_intervention:A,num_decharge:S,downloadDecharge:this.getDecharge}),Object(L.jsx)("button",{onClick:this.updateIntervention,children:" Sauvergarder "})]})})]}),Object(L.jsx)("div",{className:"intervention-control",children:R})]})):I=Object(L.jsxs)("form",{onSubmit:this.authenticate,children:[Object(L.jsx)("input",{type:"password",placeholder:"mot de passe de ".concat(o),value:this.state.pwd,onChange:this.updatePwd}),Object(L.jsx)("button",{onClick:this.authenticate,children:" Valider "})]});return Object(L.jsxs)("div",{className:"interventionPage",style:C,children:[Object(L.jsxs)("div",{className:"interventionPage-title",children:[Object(L.jsxs)("button",{onClick:M,children:[" ","x"," "]}),Object(L.jsx)("p",{children:" Intervention "})]}),Object(L.jsxs)("p",{children:[" ID intervention  : ",A," "]}),Object(L.jsx)("div",{className:"intervention-display",children:I})]})}}]),n}(o.a.Component);n(366),n(367);function ce(e){var t="".concat(e.getDate()),n="".concat(e.getMonth()+1),s=e.getFullYear();return n=n.length<2?"0"+n:n,t=t.length<2?"0"+t:t,"".concat(s,"-").concat(n,"-").concat(t)}var le=function(e){Object(m.a)(n,e);var t=Object(h.a)(n);function n(e){var s;return Object(p.a)(this,n),(s=t.call(this,e)).updateTechMain=function(e){console.log("updateTechMain",e.target.value),console.log(s.techMains[e.target.value]);var t=s.techMains[e.target.value];s.props.setTechMain({num:e.target.value,username:t})},s.updateDateDebut=function(e){console.log("updateDateDebut",new Date(e.target.value));var t=new Date(new Date(e.target.value).setHours(0,0,0));s.props.setDateDebut(t)},s.updateDateFin=function(e){console.log("updateDateFin",new Date(e.target.value));var t=new Date(new Date(e.target.value).setHours(23,59,59));s.props.setDateFin(t)},s.updateStatut=function(e){console.log("updateStatut",e.target.value);var t=s.statuts[e.target.value];s.props.setStatut(t)},s.updateNumIntervention=function(e){console.log("updateNumIntervention",e.target.value),s.props.setNumIntervention(e.target.value)},s.updateNumInterventionType=function(e){console.log("updateNumInterventionType",e.target.value),s.props.setNumInterventionType(e.target.value)},s.state={tech_mainList:[],statutList:[{key:0,value:0,libelle:"nd"},{key:1,value:1,libelle:"non-effectu\xe9e"},{key:2,value:2,libelle:"effectu\xe9e-r\xe9solue"},{key:3,value:3,libelle:"effectu\xe9e-non-r\xe9solue"}],interventionTypes:[]},s.techMains={},s.statuts={0:{done:"nd",probleme_resolu:"nd"},1:{done:!1,probleme_resolu:!1},2:{done:!0,probleme_resolu:!0},3:{done:!0,probleme_resolu:!1}},s}return Object(d.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.props.socket.emit("get tech_mains list"),this.props.socket.on("tech_mains list",(function(t){console.log("tech_mains list");var n,s=t.map((function(e){return{key:e.num_user,libelle:e.username,value:e.num_user}})),o=Object(F.a)(s);try{for(o.s();!(n=o.n()).done;){var i=n.value;e.techMains=Object(a.a)(Object(a.a)({},e.techMains),{},Object(z.a)({},i.key,i.libelle))}}catch(r){o.e(r)}finally{o.f()}e.techMains=Object(a.a)(Object(a.a)({},e.techMains),{},{nd:"nd"}),s.unshift({key:"nd",libelle:"nd",value:"nd"}),console.log("newTech_mainList",s),e.setState({tech_mainList:s})})),this.props.socket.emit("get intervention type"),this.props.socket.on("intervention_type list -interventionHistoryControl",(function(t){var n=t.map((function(e){return{key:e.num_intervention_type,libelle:e.libelle_intervention_type,value:e.num_intervention_type}}));n.unshift({key:"nd",libelle:"nd",value:"nd"}),e.setState({interventionTypes:n})}))}},{key:"componentWillUnmount",value:function(){console.log("interventionHistoryControl unmount"),this.props.socket.off("tech_mains list"),this.props.socket.off("intervention_type list -interventionHistoryControl")}},{key:"render",value:function(){var e=this.props,t=e.tech_main,n=e.date_debut,s=e.date_fin,o=e.statut,i=e.num_intervention,r=e.num_intervention_type,a=this.state,c=a.tech_mainList,l=a.statutList,u=a.interventionTypes,p=1;return o.done&&(p="nd"===o.done?0:o.probleme_resolu?2:3),Object(L.jsxs)("div",{className:"interventionHistoryControl",children:[Object(L.jsxs)("div",{className:"sub-control",children:[Object(L.jsx)("p",{children:" Technicien : "}),Object(L.jsx)(K,{value:t.num,onChange:this.updateTechMain,objArray:c})]}),Object(L.jsxs)("div",{className:"sub-control",children:[Object(L.jsx)("p",{children:" Programm\xe9 du: "}),Object(L.jsx)("input",{type:"date",value:ce(n),onChange:this.updateDateDebut})]}),Object(L.jsxs)("div",{className:"sub-control",children:[Object(L.jsx)("p",{children:" au: "}),Object(L.jsx)("input",{type:"date",value:ce(s),onChange:this.updateDateFin})]}),Object(L.jsxs)("div",{className:"sub-control",children:[Object(L.jsx)("p",{children:" status : "}),Object(L.jsx)(K,{value:p,onChange:this.updateStatut,objArray:l})]}),Object(L.jsxs)("div",{className:"sub-control",children:[Object(L.jsxs)("p",{children:[" ","Type d'intervention :"," "]}),Object(L.jsx)(K,{value:r,onChange:this.updateNumInterventionType,objArray:u})]}),Object(L.jsxs)("div",{className:"sub-control",children:[Object(L.jsx)("p",{children:" ID : "}),Object(L.jsx)("input",{placeholder:"Recherche par ID",value:i,onChange:this.updateNumIntervention})]})]})}}]),n}(s.Component),ue=(n(368),function(e){Object(m.a)(n,e);var t=Object(h.a)(n);function n(e){var s;return Object(p.a)(this,n),(s=t.call(this,e)).displayInterventions=function(e){return e.map((function(e){return Object(L.jsx)(q,{intervention:e,showSub:s.props.showSub},e.num_intervention)}))},s.state={interventions:[]},s}return Object(d.a)(n,[{key:"render",value:function(){var e,t,n,s=this.props,o=s.tech_main_username,i=s.statut,r=s.date_debut,a=s.date_fin,c=s.interventions;return e=i.done?"nd"===i.done?"":"Effectu\xe9e -- ".concat(i.probleme_resolu?"R\xe9solu":"Non-r\xe9solu"):"Non-effectu\xe9",t=a===r?a:"".concat(r," - ").concat(a),n="nd"!==o?"par ".concat(o):"",Object(L.jsxs)("div",{className:"interventionHistoryAffichage",children:[Object(L.jsxs)("div",{className:"interventionHistoryAffichage-text",children:[Object(L.jsxs)("p",{children:[" Intervention ",e,"  ",n]}),Object(L.jsxs)("p",{children:[" du ",t]}),Object(L.jsxs)("p",{children:[" Nombre : ",c.length," "]})]}),Object(L.jsx)("div",{className:"scroll_list",children:this.displayInterventions(c)})]})}}]),n}(s.Component)),pe=function(e){Object(m.a)(n,e);var t=Object(h.a)(n);function n(e){var s;return Object(p.a)(this,n),(s=t.call(this,e)).setTechMain=function(e){console.log("setTechMain",e),s.setState({tech_main:e})},s.setDateDebut=function(e){console.log("setDateDebut",e),e.getTime()>s.state.date_fin.getTime()&&(e=s.state.date_fin),s.setState({date_debut:e})},s.setDateFin=function(e){console.log("setDateFin",e),e.getTime()<s.state.date_debut.getTime()&&(e=s.state.date_debut),s.setState({date_fin:e})},s.setStatut=function(e){console.log("setStatut",e),s.setState({statut:e})},s.setNumIntervention=function(e){s.setState({num_intervention:e})},s.setNumInterventionType=function(e){s.setState({num_intervention_type:e})},s.state={tech_main:{num:"nd",username:"nd"},date_debut:new Date((new Date).setFullYear(2020,0,1)),date_fin:new Date((new Date).setHours(23,59,59)),statut:{done:"nd",probleme_resolu:"nd"},interventionList:[],num_intervention:"",num_intervention_type:"nd"},s}return Object(d.a)(n,[{key:"componentDidUpdate",value:function(e,t){var n;t.date_debut.getTime()===this.state.date_debut.getTime()&&t.date_fin.getTime()===this.state.date_fin.getTime()&&t.tech_main.num===this.state.tech_main.num&&t.statut.done===this.state.statut.done&&t.statut.probleme_resolu===this.state.statut.probleme_resolu&&t.num_intervention===this.state.num_intervention&&t.num_intervention_type===this.state.num_intervention_type||(console.log("emit again"),"nd"!==this.state.num_interevnetion&&(n="%".concat(this.state.num_intervention,"%")),this.props.socket.emit("get intervention history",this.state.tech_main.num,this.state.date_debut,this.state.date_fin,this.state.statut,this.state.num_intervention_type,n))}},{key:"componentDidMount",value:function(){var e=this;console.log("intervention History Mounted");var t=this.state,n=t.tech_main,s=t.date_fin,o=t.statut;this.props.socket.emit("get intervention history",n.num,null,s,o,null,null),this.props.socket.emit("get oldest intervention date"),this.props.socket.on("oldest intervention date",(function(t){e.setState({date_debut:new Date(t)})})),this.props.socket.on("intervention history",(function(t){console.log("intervention history",t);var n=t.map((function(e,t){return{num_intervention:e.num_intervention,num_intervention_pere:e.num_intervention_pere,date_programme:e.date_programme,libelle_lieu:e.libelle_lieu,libelle_intervention_type:e.libelle_intervention_type,tech_main_username:e.tech_main_username,motif:e.motif,numero:t+1,done:e.done,probleme_resolu:e.probleme_resolu,libelle_probleme_tech_type:e.libelle_probleme_tech_type,code_intervention_type:e.code_intervention_type,children:e.children}}));console.log("newInterventionList",n),e.setState({interventionList:n})}))}},{key:"componentWillUnmount",value:function(){this.props.socket.off("intervention history"),this.props.socket.off("oldest intervention date")}},{key:"render",value:function(){var e=this.state,t=e.tech_main,n=e.statut,s=e.date_debut,o=e.date_fin,i=e.interventionList,r=(e.num_intervention,e.num_intervention_type);return Object(L.jsxs)("div",{className:"interventionHistory",children:[Object(L.jsx)("div",{className:"side-InterventionHistory",children:Object(L.jsx)(le,{socket:this.props.socket,tech_main:t,setTechMain:this.setTechMain,date_debut:s,date_fin:o,setDateDebut:this.setDateDebut,setDateFin:this.setDateFin,statut:n,setStatut:this.setStatut,num_intervention:this.state.num_intervention,setNumIntervention:this.setNumIntervention,num_intervention_type:r,setNumInterventionType:this.setNumInterventionType})}),Object(L.jsx)(ue,{tech_main_username:t.username,date_debut:s.toLocaleDateString(),date_fin:o.toLocaleDateString(),interventions:i,statut:n,showSub:this.props.showSub})]})}}]),n}(s.Component),de=(n(369),n(370),function(e){Object(m.a)(n,e);var t=Object(h.a)(n);function n(e){var s;return Object(p.a)(this,n),(s=t.call(this,e)).updateSelectedNumUser=function(e){console.log("updateSelectedNumUser",e),s.props.setSelectedUser(e)},s.state={connectedList:[],allUserList:[]},s}return Object(d.a)(n,[{key:"componentDidMount",value:function(){var e=this;console.log("ActiveUsers mounted"),this.props.socket.emit("get tech_mains list"),this.props.socket.emit("get list tech_main connected"),this.props.socket.on("tech_mains list -activeUsers",(function(t){console.log("tech_mains list -activeUsers",t),t.sort((function(t,n){if(t.num_user===e.props.session.num_user)return-1})),e.setState({allUserList:t})})),this.props.socket.on("tech_main connected list -activeUsers",(function(t){console.log("tech_main connected list -activeUsers",t),e.setState({connectedList:t});var n=Object(a.a)({},e.props.selectedUser);n.active=t.includes(e.props.selectedUser.num_user),e.updateSelectedNumUser(n)})),this.props.socket.on("new message -activeUsers",(function(t){console.log("new message -activeUsers"),e.props.socket.emit("get tech_mains list")}))}},{key:"componentWillUnmount",value:function(){console.log("ActiveUsers unmounted"),this.props.socket.off("tech_mains list -activeUsers"),this.props.socket.off("tech_main connected list -activeUsers")}},{key:"render",value:function(){var e=this,t=this.state,n=t.allUserList,s=t.connectedList,o=this.props,i=o.session,r=o.selectedUser,a=n.map((function(t){var n=s.includes(t.num_user),o=t.num_user===r.num_user;return t.active=n,console.log(t.username,n),Object(L.jsx)(me,{isSelf:i.num_user===t.num_user,username:t.username,nbNewMessage:t.nbNewMessage,active:t.active,selected:o,onClick:function(){return e.updateSelectedNumUser(t)}},t.num_user)}));return Object(L.jsx)("div",{className:"activeUsers",children:Object(L.jsx)("div",{className:"scroll_list",children:a})})}}]),n}(s.Component));function me(e){var t,n,s=e.username,o=e.active,i=e.selected,r=e.isSelf,a=e.nbNewMessage;return t=i?{borderBottom:"1px solid red",background:"white"}:{},n=o?{borderRight:"5px solid green"}:{borderRight:"5px solid red"},Object(L.jsx)("div",{className:"userListItem",style:t,children:Object(L.jsxs)("p",{onClick:e.onClick,style:n,children:[s," ",a>0?"(".concat(a,")"):"",r?"(moi)":""," ",Object(L.jsx)("span",{className:"statut-userListItem",children:o?"connect\xe9":"non-connect\xe9"})]})})}n(371);var he=n(380),be=function(e){Object(m.a)(n,e);var t=Object(h.a)(n);function n(e){var s;return Object(p.a)(this,n),(s=t.call(this,e)).updateContenu=function(e){s.setState({newContenu:e.target.value})},s.sendMessage=function(e){console.log("send message"),e.preventDefault();var t=s.props,n=t.session,o=t.selectedUser,i=s.state,r=i.newContenu,a=i.messages;if(s.state.newContenu&&s.props.session&&s.props.selectedUser.num_user){var c=Object(he.a)();console.log("id",c);var l={id:c,sent:!1,time_sent:"",contenu:r,to:o.username,from:n.username},u={id:l.id,contenu:r,num_sender:n.num_user,receivers:[o.num_user]};console.log("emit(send message)",u),s.props.socket.emit("send message",u);var p=a.slice();p.push(l),s.setState({messages:p})}},s.scrollDown=function(){var e=s.myScroll.current;e.scrollTop=e.scrollHeight},s.clickOnMessageRoom=function(){console.log("clickOnMessageRoom"),console.log("clickOnMessageRoom state.message",s.state.messages);var e=s.state.messages.filter((function(e){return!e.seen&&!e.time_seen&&e.to===s.props.session.username}));console.log("unseenMessagesByMe",e),e.length>0&&s.props.socket.emit("tech_main saw messages",e)},s.state={messages:[{id:"abab",sent:!0,time_sent:(new Date).toLocaleString(),contenu:"contenu",to:"destinataire",from:"envoyeur"}],newContenu:"",active:s.props.selectedUser.active},s.myScroll=o.a.createRef(),s}return Object(d.a)(n,[{key:"componentDidUpdate",value:function(e,t){e.selectedUser.num_user!==this.props.selectedUser.num_user&&(console.log("emit again"),this.props.socket.emit("get messages",this.props.session.num_user,this.props.selectedUser.num_user))}},{key:"componentDidMount",value:function(){var e=this;console.log("MessageRoom mounted"),this.props.selectedUser.num_user&&this.props.socket.emit("get messages",this.props.session.num_user,this.props.selectedUser.num_user),this.props.socket.on("message sent -messageRoom",(function(t){console.log("message sent -messageRoom",t),e.props.socket.emit("get tech_mains list");var n=e.state.messages.map((function(e){return e.id===t.num_message?Object(a.a)(Object(a.a)({},e),{},{sent:!0,time_sent:new Date(t.date_envoie).toLocaleString()}):e}));e.state.messages.find((function(e){return e.id===t.num_message}))||n.push({id:t.num_message,sent:!0,time_sent:new Date(t.date_envoie).toLocaleString(),contenu:t.contenu_message,from:t.envoyeur_username,to:t.recepteur_username}),e.setState({messages:n,newContenu:""}),e.scrollDown()})),this.props.socket.on("messages -messageRoom",(function(t){if(console.log("messages -messageRoom",t),t){var n=t.map((function(e){var t=!1;return e.date_reception&&(e.date_reception=new Date(e.date_reception).toLocaleString("FR-fr"),t=!0),{id:e.num_message,sent:!0,time_sent:new Date(e.date_envoie).toLocaleString(),time_seen:e.date_reception,seen:t,contenu:e.contenu_message,to:e.recepteur_username,from:e.envoyeur_username}}));console.log("newMessages +",n),e.setState({messages:n}),e.scrollDown(),e.clickOnMessageRoom()}})),this.props.socket.on("new message -messageRoom",(function(t){console.log("new message -messageRoom",t);var n=e.props;n.selectedUser,n.session;if(e.props.socket.emit("get tech_mains list"),e.props.selectedUser.num_user===t.num_app_user_envoyeur){var s={id:t.num_message,time_sent:new Date(t.date_envoie).toLocaleString(),contenu:t.contenu_message,sent:!0,tim_seen:t.date_reception,seen:!1,from:t.envoyeur_username,to:t.recepteur_username};console.log(s);var o=e.state.messages.slice();o.push(s),e.setState({messages:o}),e.scrollDown()}})),this.props.socket.on("updateMessages -messageRoom",(function(t){console.log("updateMessage -messageRoom",t);var n=e.state.messages.slice(),s=t.map((function(e){return e.num_message}));console.log("updatedMessagesId",s),n=n.map((function(e){var n=s.findIndex((function(t){return t===e.id}));if(console.log("indexInUpdateMessage",n),-1!==n){var o=!!t[n].date_reception;return Object(a.a)(Object(a.a)({},e),{},{time_seen:new Date(t[n].date_reception).toLocaleString("fr-FR"),seen:o})}return e})),console.log("newMessages",n),e.props.socket.emit("get nb new message",e.props.session.num_user),e.props.socket.emit("get tech_mains list"),e.setState({messages:n})}))}},{key:"componentWillUnmount",value:function(){console.log("MessageRoom unmount"),this.props.socket.off("message sent -messageRoom"),this.props.socket.off("messages -messageRoom"),this.props.socket.off("new message -messageRoom"),this.props.socket.off("updateMessages -messageRoom")}},{key:"render",value:function(){var e,t=this.state,n=t.messages,s=t.newContenu,o=this.props,i=o.selectedUser,r=o.session,a=n.map((function(e){return Object(L.jsx)(je,{message:e,session:r},e.id)}));return e=i.num_user?Object(L.jsxs)(L.Fragment,{children:[Object(L.jsx)("div",{className:"header-messageRoom",children:Object(L.jsxs)("p",{children:[" ",i.username," ",i.active?"[connect\xe9]":"[non-connect\xe9]"," "]})}),Object(L.jsxs)("div",{className:"main-messageRoom",children:[Object(L.jsx)("div",{className:"scroll_list",ref:this.myScroll,children:a}),Object(L.jsx)("div",{className:"input-messageRoom",children:Object(L.jsxs)("form",{onSubmit:this.sendMessage,children:[Object(L.jsx)("input",{value:s,type:"text",placeholder:"Ecrire ici",onChange:this.updateContenu}),Object(L.jsx)("button",{onClick:this.sendMessage,children:" envoyer "})]})})]})]}):Object(L.jsx)("div",{className:"header-messageRoom",children:Object(L.jsx)("p",{children:" aucun technicien selectionn\xe9 "})}),Object(L.jsx)("div",{className:"messageRoom",onClick:this.clickOnMessageRoom,children:e})}}]),n}(s.Component);function je(e){var t,n,s,o=e.message,i=e.session.username===o.from,r=Object(L.jsxs)("p",{className:"from-message",children:[" ",o.from," : "]}),a=Object(L.jsxs)("div",{className:"indication-message",children:[Object(L.jsxs)("p",{children:[" ",o.sent?"envoy\xe9 le ".concat(o.time_sent):""," "]}),Object(L.jsxs)("p",{children:[" ",o.seen?"re\xe7ue le ".concat(o.time_seen):"non-re\xe7ue"," "]})]}),c=function(e){return Object(L.jsxs)("div",{className:"contenu-message",style:n,children:[r,Object(L.jsxs)("p",{children:[" ",o.contenu,"  "]})]})};return i?(t={color:"red",justifyContent:"flex-end"},n={margin:"5px 0 5px 5px",borderLeft:"1px solid grey"},s=Object(L.jsxs)(L.Fragment,{children:[a,c()]})):(t={color:"black",justifyContent:"flex-start"},n={margin:"5px 5px 5px 0",borderRight:"1px solid grey"},s=Object(L.jsxs)(L.Fragment,{children:[c(),a]})),Object(L.jsx)("div",{className:"messageElement",style:t,children:s})}function fe(e){var t;t=e.location.state&&e.location.state.num_user&&e.location.state.username?Object(a.a)(Object(a.a)({},e.location.state),{},{active:!0}):{};var n=Object(s.useState)(t),o=Object(X.a)(n,2),i=o[0],r=o[1];return Object(L.jsxs)("div",{className:"messagePage",children:[Object(L.jsx)("div",{className:"side-messagePage",children:Object(L.jsx)(de,{socket:e.socket,session:e.session,setSelectedUser:r,selectedUser:i})}),Object(L.jsx)("div",{className:"main-messagePage",children:Object(L.jsx)(be,{socket:e.socket,selectedUser:i,session:e.session,setNbNewMessageToZero:e.setNbNewMessageToZero})})]})}var ve=function(e){Object(m.a)(n,e);var t=Object(h.a)(n);function n(e){var s;return Object(p.a)(this,n),(s=t.call(this,e)).showSub=function(e){var t;s.state.numSelectedIntervention===e?(t=!s.state.showSub,e=null):t=!0,s.setState({showSub:t,numSelectedIntervention:e})},s.closeSub=function(){s.setState({showSub:!1})},s.nbNewNotificationPlus=function(e){var t=e||s.state.nbNewNotification+1;t=parseInt(t),s.setState({nbNewNotification:t})},s.setNbNewMessage=function(e){var t=parseInt(e);s.setState({nbNewMessage:t})},s.showPopUp=function(e){e.current.style.top="10px",setTimeout((function(){e.current.style.top="-1000px"}),1e4)},s.onClickNotif=function(){var e=s.props.match.url;s.popUp.current.style.top="-1000px",s.props.history.push("".concat(e,"/dashboard/notifs"))},s.logOut=function(){s.props.logOut()},s.componentDidMount=function(){console.log(" MAIN component did mount"),R.connect(s.props.session.username,s.props.session.type_user,s.props.session.num_user),s.socket.on("new notif",(function(e){console.log("new notif received on main",e);var t=s.state.newNotifs.slice();t.length>4&&t.pop(),t.unshift(e),console.log("newNewNotifs",t),t=t.filter((function(e){var t=(new Date).getTime()-6e5,n=new Date(e.date_envoie).getTime();return console.log("now_2",t),console.log("date_notif",n),console.log(" date_notif is more than 10 minutes old ",n<t),!(n<t)})),console.log("newNewNotifs",t),s.showPopUp(s.popUp);var n=s.state.nbNewNotification+1;s.setState({newNotifs:t,nbNewNotification:n})})),s.socket.on("new message -main",(function(e){console.log("new message -main",e),s.socket.emit("get nb new message",s.props.session.num_user);var t=s.state.newMessageNotifs.slice();"/acim/message"!==s.props.location.pathname&&(t.unshift(e),console.log("newNewMessageNotifs",t),t=t.filter((function(e){var t=(new Date).getTime()-6e5,n=new Date(e.date_envoie).getTime();return console.log("now_2",t),console.log("date_notif",n),console.log(" date_notif is more than 10 minutes old ",n<t),!(n<t)})),console.log("newNewMessageNotifs",t),s.showPopUp(s.popUpMessage)),s.socket.emit("get nb new message",s.props.session.num_user),s.setState({newMessageNotifs:t})})),s.socket.emit("get notifs list unanswered"),s.socket.on("unanswered notifs nb",(function(e){console.log("unanswered notifs nb",e),s.nbNewNotificationPlus(e)})),s.socket.emit("get nb new message",s.props.session.num_user),s.socket.on("nb new message -main",(function(e){console.log("nb new message -main",e),s.setState({nbNewMessage:e})}))},s.componentWillUnmount=function(){console.log("UNMOUNT main"),s.socket.off("new notif"),s.socket.off("nb tache undone"),s.socket.off("unanswered notifs nb"),s.socket.off("new message -main"),s.socket.off("nb new message -main"),s.socket.offAny(),R.socket.disconnect()},s.showNewNotifs=function(){return s.state.newNotifs.map((function(e){var t;switch(e.probleme_statut_code){case"MAX":t={color:"red"};break;case"MID":t={color:"yellow"};break;case"MIN":t={color:"blue"}}return Object(L.jsxs)("div",{className:"notif_pop_notif",onClick:s.onClickNotif,children:[Object(L.jsx)("p",{id:"notif_time",children:new Date(e.date_envoie).toLocaleTimeString("fr-FR")}),Object(L.jsxs)("p",{style:t,children:[" ",e.probleme_statut," "]}),Object(L.jsxs)("p",{children:[" ",e.probleme_type," "]}),Object(L.jsxs)("p",{children:[" ",e.lieu," "]})]},e.num_notification)}))},s.onClickMessageNotif=function(e){console.log("open message",e);var t=s.props.match.url;s.popUpMessage.current.style.top="-1000px",s.props.history.push("".concat(t,"/message"),e)},s.showNewMessageNotifs=function(){return s.state.newMessageNotifs.map((function(e){var t={num_user:e.num_app_user_envoyeur,username:e.envoyeur_username};return Object(L.jsx)("div",{className:"notif_pop_notif",onClick:function(){return s.onClickMessageNotif(t)},children:Object(L.jsxs)("p",{children:[" Nouveau message de ",t.username," "]})},e.num_message)}))},s.state={newNotifs:[],nbNewNotification:0,nbNewMessage:0,showSub:!1,numSelectedIntervention:null,newMessageNotifs:[]},s.socket=R.socket,s.popUp=o.a.createRef(),s.popUpMessage=o.a.createRef(),s}return Object(d.a)(n,[{key:"render",value:function(){var e,t,n,s=this,o=this.props.match,i=o.path,r=o.url,c=this.props.session,l=this.state,u=l.showSub,p=l.numSelectedIntervention,d=l.nbNewMessage;return u?(e=Object(a.a)(Object(a.a)({},e),{},{display:"none"}),t=Object(a.a)(Object(a.a)({},t),{},{width:"100%"})):(t=Object(a.a)(Object(a.a)({},t),{},{width:"0px"}),n=Object(a.a)(Object(a.a)({},n),{},{display:"none"})),Object(L.jsxs)("div",{className:"main_layout",children:[Object(L.jsx)("div",{className:"notif_pop",ref:this.popUp,children:this.showNewNotifs()}),Object(L.jsx)("div",{className:"notif_pop",ref:this.popUpMessage,children:this.showNewMessageNotifs()}),Object(L.jsxs)("div",{className:"header",children:[Object(L.jsx)("h1",{children:"mptdn_acim"}),Object(L.jsxs)("p",{children:[" ",this.props.session.username," "]}),Object(L.jsx)("button",{onClick:function(){return s.showPopUp(s.popUp)},children:" show pop "}),Object(L.jsx)("button",{onClick:function(){return s.showPopUp(s.popUpMessage)},children:" show pop message "}),Object(L.jsx)("button",{onClick:this.logOut,children:" se deconnecter "})]}),Object(L.jsxs)("div",{className:"main_display",children:[Object(L.jsxs)("nav",{className:"side_nav",children:[Object(L.jsx)(M.c,{activeClassName:"active_navLink",to:"".concat(r,"/dashboard"),onClick:this.closeSub,children:"tableau de bord"}),Object(L.jsx)(M.c,{activeClassName:"active_navLink",to:"".concat(r,"/mytask"),onClick:this.closeSub,children:"Mes taches"}),Object(L.jsxs)(M.c,{activeClassName:"active_navLink",to:"".concat(r,"/message"),onClick:this.closeSub,children:["Messages ",d>0?"(".concat(d,")"):""]}),Object(L.jsx)(M.c,{activeClassName:"active_navLink",to:"".concat(r,"/notifsHistory"),onClick:this.closeSub,children:"Historiques des notifications"}),Object(L.jsx)(M.c,{activeClassName:"active_navLink",to:"".concat(r,"/interventionHistory"),onClick:this.closeSub,children:"Historiques des interventions"})]}),Object(L.jsxs)("div",{className:"main-tabDisplay",children:[Object(L.jsx)("div",{className:"display",style:e,children:Object(L.jsxs)(U.d,{children:[Object(L.jsx)(U.b,{exact:!0,path:i,children:Object(L.jsx)(U.a,{to:"".concat(i,"/dashboard")})}),Object(L.jsx)(U.b,{path:"".concat(i,"/dashboard"),render:function(e){return Object(L.jsx)(ne,Object(a.a)(Object(a.a)({},e),{},{socket:s.socket,session:s.props.session,nbNewNotification:s.state.nbNewNotification,nbNewNotificationToZero:function(){return s.nbNewNotificationPlus("0")},showSub:s.showSub,closeSub:function(){return s.showSub(p)}}))}}),Object(L.jsx)(U.b,{path:"".concat(i,"/mytask"),render:function(e){return Object(L.jsx)(W,Object(a.a)(Object(a.a)(Object(a.a)({},e),s.props),{},{showSub:s.showSub,socket:s.socket,num_tech_main:c.num_user,topText:"Listes des taches a faire par ".concat(c.username," :"),closeSub:function(){return s.showSub(p)}}))}}),Object(L.jsx)(U.b,{path:"".concat(i,"/notifsHistory"),render:function(e){return Object(L.jsx)(oe,Object(a.a)(Object(a.a)({},e),{},{session:s.props.session,socket:s.socket,closeSub:function(){return s.showSub(p)}}))}}),Object(L.jsx)(U.b,{path:"".concat(i,"/interventionHistory"),render:function(e){return Object(L.jsx)(pe,Object(a.a)(Object(a.a)({},e),{},{session:s.props.session,socket:s.socket,showSub:s.showSub,closeSub:function(){return s.showSub(p)}}))}}),Object(L.jsx)(U.b,{path:"".concat(i,"/message"),render:function(e){return Object(L.jsx)(fe,Object(a.a)(Object(a.a)({session:s.props.session,socket:s.socket},e),{},{setNbNewMessageToZero:function(){return s.setNbNewMessage(0)}}))}})]})}),Object(L.jsx)("div",{className:"sub-display",style:t,children:Object(L.jsx)(ae,Object(a.a)(Object(a.a)({num_intervention:this.state.numSelectedIntervention},this.props),{},{style:n,closeSub:function(){return s.showSub(p)},showSub:this.showSub,socket:this.socket}))})]})]})]})}}]),n}(o.a.Component),ge=(n(372),n(373),function(e){Object(m.a)(n,e);var t=Object(h.a)(n);function n(){return Object(p.a)(this,n),t.apply(this,arguments)}return Object(d.a)(n,[{key:"render",value:function(){return Object(L.jsxs)("div",{className:"notify_header header",children:[Object(L.jsx)("h1",{children:"mptdn_acim"}),Object(L.jsxs)("p",{children:[" ",this.props.session.username," "]}),Object(L.jsx)("button",{onClick:this.props.showNotif,children:" showNotif "}),Object(L.jsx)("button",{onClick:this.props.logOut,children:" se deconnecter "})]})}}]),n}(o.a.Component)),_e=(n(374),function(e){Object(m.a)(n,e);var t=Object(h.a)(n);function n(e){var s;return Object(p.a)(this,n),(s=t.call(this,e)).updateProblem=function(e){s.setState({problem:e.target.value})},s.updateProblemType=function(e){s.setState({num_probleme_type:e.target.value})},s.updateProblemStatut=function(e){s.setState({num_probleme_statut:e.target.value})},s.updateLieu=function(e){s.setState({num_lieu:e.target.value})},s.updateRemarque=function(e){s.setState({remarque:e.target.value})},s.componentDidMount=function(){console.log("ask mount"),s.props.socket?(s.props.socket.on("list problem",(function(e){console.log("list problem in ask",e);var t=e.map((function(e){return{key:e.num_probleme_type,value:e.num_probleme_type,libelle:e.libelle,code:e.code}}));s.setState({listProblem:t,num_probleme_type:t[0].value})})),s.props.socket.on("list problem_statut",(function(e){console.log(" getting list problem_statut");var t=e.map((function(e){return{key:e.num_probleme_statut,value:e.num_probleme_statut,libelle:e.libelle}}));s.setState({listProblemStatut:t,num_probleme_statut:t[0].value})})),s.props.socket.on("list lieu",(function(e){console.log(" getting list lieu");var t=e.map((function(e){return{key:e.num_lieu,value:e.num_lieu,libelle:e.libelle}}));s.setState({listLieu:t,num_lieu:t[0].value})})),s.props.socket.on("I sent a notif",(function(e){e.date_envoie=new Date(e.date_envoie).toLocaleString("fr-FR"),console.log("new notif in history"),s.props.nbNewNotifsPlus(),s.setState({indication:"Demande envoyee #".concat(e.date_envoie)})})),s.props.socket.emit("get problem definition")):console.log(" no socket in ask")},s.componentDidupdate=function(){console.log("componentDidUpdate ask")},s.componentWillUnmount=function(){console.log("unmount ask"),s.props.socket.off("list problem"),s.props.socket.off("list problem_statut"),s.props.socket.off("list lieu"),s.props.socket.off("I sent a notif")},s.sendNotifs=function(){var e;if(console.log("listProblem",s.state.listProblem),0!==s.state.listProblem.length&&(e=s.state.listProblem.find((function(e){return e.key===s.state.num_probleme_type})).code),console.log(" selected problem type is "+e),"OTH"!==e||s.state.remarque){if(s.props.session&&s.state.num_lieu&&s.state.num_probleme_type&&s.state.num_probleme_statut){var t={num_probleme_type:s.state.num_probleme_type,num_probleme_statut:s.state.num_probleme_statut,num_lieu:s.state.num_lieu,remarque:s.state.remarque},n={num_app_user_user:s.state.session.num_user,newProblem:t};console.log("send notif ",n),s.props.socket.emit("notif",n)}}else s.setState({indication:"Vous devez ecrire une remarque"})},s.state={listProblem:[],listProblemStatut:[],listLieu:[],session:s.props.session,problem:"",num_probleme_type:"",num_probleme_statut:"",num_lieu:"",remarque:"",indication:""},s}return Object(d.a)(n,[{key:"render",value:function(){var e;return this.state.indication&&(e={opacity:1,right:0}),Object(L.jsxs)("div",{className:"ask",children:[Object(L.jsx)("p",{children:"Demande d'assistance"}),Object(L.jsxs)("div",{className:"dropdown-zone",children:[Object(L.jsx)("p",{children:" Probleme  : "}),Object(L.jsx)(J,{value:this.state.num_probleme_type,onChange:this.updateProblemType,objArray:this.state.listProblem})]}),Object(L.jsxs)("div",{className:"remarque-problem",children:[Object(L.jsx)("p",{children:" remarque : "}),Object(L.jsx)("textarea",{value:this.state.remarque,onChange:this.updateRemarque,placeholder:"remarque ici"})]}),Object(L.jsxs)("div",{className:"double-dropdown",children:[Object(L.jsxs)("div",{className:"dropdown-zone",children:[Object(L.jsx)("p",{children:" Urgence : "}),Object(L.jsx)(J,{defaultValue:"xx",value:this.state.num_probleme_statut,objArray:this.state.listProblemStatut,onChange:this.updateProblemStatut})]}),Object(L.jsxs)("div",{className:"dropdown-zone",children:[Object(L.jsx)("p",{children:" Lieu : "}),Object(L.jsx)(J,{value:this.state.num_lieu,objArray:this.state.listLieu,onChange:this.updateLieu})]})]}),Object(L.jsx)("button",{className:"my-button",onClick:this.sendNotifs,children:" Envoyer "}),Object(L.jsxs)("div",{className:"indication",style:e,children:[" ",this.state.indication," "]})]})}}]),n}(o.a.Component)),Oe=(n(375),n(376),function(e){Object(m.a)(n,e);var t=Object(h.a)(n);function n(e){var s;return Object(p.a)(this,n),(s=t.call(this,e)).showDetails=function(){s.setState({detailsAreShown:!s.state.detailsAreShown})},s.showInfoOf=function(e){s.props.showSub(e)},s.state={detailsAreShown:!1},s}return Object(d.a)(n,[{key:"render",value:function(){var e,t,n,s,o=this;switch(this.props.notif.statut_code){case E.code:e={borderLeft:"3px solid red"},n={color:"red",fontWeight:"bold"};break;case V.code:e={borderLeft:"3px solid yellow"},n={color:"yellow",fontWeight:"bold"};break;case Z.code:e={borderLeft:"3px solid blue"},n={color:"blue"}}this.state.detailsAreShown&&(s={height:"80%"},t={height:"15%"},e=Object(a.a)(Object(a.a)({},e),{},{height:"300px"})),this.props.notif.num_app_user_tech_main&&this.props.notif.date_reponse&&(e=Object(a.a)(Object(a.a)({},e),{},{background:"#a9c8f7"}));var i=this.props.notif,r=i.probleme_type,c=i.code,l=i.statut_libelle,u=i.lieu,p=i.date_envoie,d=i.remarque,m=i.tech_main_username,h=i.date_reponse,b=i.num_notification,j=i.num_intervention;return Object(L.jsxs)("div",{className:"notif_history",style:e,children:[Object(L.jsxs)("div",{className:"notif_history-sum",style:t,children:[Object(L.jsxs)("div",{className:"date_envoie",children:[Object(L.jsx)("p",{children:" Date d'envoie : "}),Object(L.jsxs)("p",{children:[" ",p," "]})]}),Object(L.jsxs)("div",{className:"probleme_type",children:[Object(L.jsxs)("p",{children:[" ",r," "]}),Object(L.jsxs)("p",{children:[" ",c," "]})]}),Object(L.jsxs)("div",{className:"probleme_statut",style:n,children:[Object(L.jsxs)("p",{children:[" ",l," "]}),Object(L.jsxs)("p",{children:[" ",u," "]})]}),Object(L.jsx)("button",{onClick:this.showDetails,children:" Details "})]}),this.state.detailsAreShown&&Object(L.jsxs)("div",{className:"notif-details",style:s,children:[Object(L.jsxs)("p",{children:[" remarque: ",d," "]}),Object(L.jsxs)("p",{children:[" prise en charge par : ",m,"  "]}),Object(L.jsxs)("p",{children:[" repondue le : ",h," "]}),Object(L.jsxs)("p",{children:[" ID notification : ",b," "]}),Object(L.jsxs)("p",{children:[" ID intervention :","nd"!==j&&Object(L.jsxs)("button",{href:"#",onClick:function(){return o.showInfoOf(j)},children:[" ",j," "]})]}),Object(L.jsx)("p",{children:" Details 1 "})]})]})}}]),n}(o.a.Component)),ye=function(e){Object(m.a)(n,e);var t=Object(h.a)(n);function n(e){var s;return Object(p.a)(this,n),(s=t.call(this,e)).componentDidMount=function(){s.props.socket.emit("get notifs history",s.props.session.num_user),s.props.socket.on("notifs history",(function(e){console.log("notification history",e);var t=e.map((function(e){return{num_notification:e.num_notification,probleme_type:e.probleme_type,probleme_code:e.code,statut_code:e.statut,statut_libelle:e.statut_libelle,lieu:e.lieu,remarque:e.remarque||"-",date_envoie:new Date(e.date_envoie).toLocaleString("fr-FR"),num_app_user_tech_main:e.num_app_user_tech_main,tech_main_username:e.tech_main_username||"-",date_reponse:e.date_reponse?new Date(e.date_reponse).toLocaleString("fr-FR"):"-",num_intervention:e.num_intervention||"nd"}}));s.setState({notifsTab:t})})),s.props.socket.on("notif from tech_main",(function(){console.log("notif from tech_main in history js"),setTimeout((function(){console.log("notif from tech_main"),s.props.socket.emit("get notifs history",s.props.session.num_user)}),5e3)})),s.props.nbNewNotifsToZero()},s.displayNotif=function(e){return e.map((function(e){return Object(L.jsx)(Oe,{showSub:s.props.showSub,notif:e},e.num_notification)}))},s.componentWillUnmount=function(){s.props.socket.off("notifs history")},s.state={notifsTab:[]},s}return Object(d.a)(n,[{key:"render",value:function(){return Object(L.jsxs)("div",{id:"notifsList",children:[Object(L.jsxs)("p",{children:[" Historiques des notifications envoyees par ",this.props.session.username,":  "]}),Object(L.jsx)("div",{id:"scroll_list-notifsList",children:this.displayNotif(this.state.notifsTab)})]})}}]),n}(o.a.Component),xe=(n(377),function(e){Object(m.a)(n,e);var t=Object(h.a)(n);function n(e){var o;return Object(p.a)(this,n),(o=t.call(this,e)).componentDidMount=function(){console.log("component did mount intervention_notification"),o.props.socket.emit("get list intervention_notification",o.props.session.num_user),o.props.socket.on("list intervention_notification",(function(e){console.log("list intervention",e);var t=e.map((function(e,t){return{num_intervention:e.num_intervention,code_intervention_type:e.code_intervention_type,date_programme:e.date_programme,lieu_libelle:e.lieu,intervention_type:e.libelle_intervention_type,tech_main_username:e.tech_main_username,motif:e.motif,numero:t+1,done:e.done,children:e.children,probleme_resolu:e.probleme_resolu}}));o.setState({interventionTab:t})})),o.props.socket.on("ended intervention",(function(){o.props.socket.emit("get list intervention_notification",o.props.session.num_user)}))},o.componentWillUnmount=function(){console.log("intervention_notification will unmount"),o.props.socket.off("list intervention_notification")},o.displayListInterevention=function(e){return e.map((function(e){return e.num_intervention===o.props.numSelectedIntervention?Object(s.createElement)(q,Object(a.a)(Object(a.a)({},o.props),{},{intervention:e,key:e.num_intervention,selected:!0})):Object(s.createElement)(q,Object(a.a)(Object(a.a)({},o.props),{},{intervention:e,key:e.num_intervention,selected:!1}))}))},o.state={interventionTab:[]},o}return Object(d.a)(n,[{key:"render",value:function(){return Object(L.jsxs)("div",{className:"intervention_notification",children:[Object(L.jsxs)("p",{children:[" Interventions provenant des notifactions de ",this.props.session.username," "]}),Object(L.jsx)("div",{className:"scroll_list",children:this.displayListInterevention(this.state.interventionTab)})]})}}]),n}(o.a.Component)),ke=function(e){Object(m.a)(n,e);var t=Object(h.a)(n);function n(e){var s;return Object(p.a)(this,n),(s=t.call(this,e)).nbNewNotifsPlus=function(e){console.log("new notifs ++");var t=e||s.state.nbNewNotifs+1;t=parseInt(t),console.log("new notifs ",t),s.setState({nbNewNotifs:t})},s.logOut=function(){s.props.logOut()},s.showNotif=function(){console.log("show Notif"),s.notify_notif_pop.current.style.top="157px",setTimeout((function(){s.notify_notif_pop.current.style.top="-1000px"}),1e4)},s.hideNotif=function(){s.notify_notif_pop.current.style.top="-1000px"},s.showSubWithInfo=function(e){var t;s.state.numSelectedIntervention===e?(t=!s.state.showSub,e=null):t=!0,s.setState({showSub:t,numSelectedIntervention:e})},s.formatNotifsList=function(e){return e.map((function(e){return Object(L.jsxs)("div",{className:"notify_notif",onClick:s.hideNotif,children:[Object(L.jsxs)("p",{children:[" ",e.tech_main_username," arrive "]}),Object(L.jsxs)("p",{children:[" probleme : ",e.probleme_type," -- ",e.lieu," "]}),Object(L.jsxs)("p",{children:[" notifiee le : ",e.date_envoie_formatted," "]}),Object(L.jsxs)("p",{children:[" delai : ",e.delai," "]})]},e.key)}))},s.state={nbNewNotifs:0,notifsList:[],showSub:!1,numSelectedIntervention:null},s.socket=R.socket,s.notify_notif_pop=o.a.createRef(),s}return Object(d.a)(n,[{key:"componentDidMount",value:function(){var e=this;R.connect(this.props.session.username,this.props.session.type_user,this.props.session.num_user),this.socket.on("notif from tech_main",(function(t){var n=t.tech_main_username,s=t.probleme_type,o=t.date_envoie,i=t.delai,r=t.lieu,a=t.num_notification;console.log("notif from tech_main",n,s,o,i);var c=new Date(o).toLocaleString("fr-FR"),l={tech_main_username:n,probleme_type:s,lieu:r,date_envoie_formatted:c,date_envoie:o,delai:i,text:"".concat(n,' arrive pour le probleme : " ').concat(s,' " lieu : ').concat(r," - notifie le ").concat(c," -- \n                delai : ").concat(i),key:a},u=e.state.notifsList.slice();u.length>4&&u.pop(),u.unshift(l),u=u.filter((function(e){var t=(new Date).getTime()-6e5;return!(new Date(e.date_envoie).getTime()<t)})),console.log("newNotifsList",u),e.showNotif(),e.setState({notifsList:u})}))}},{key:"componentWillUnmount",value:function(){console.log("unmount notify"),this.socket.off("list problem"),this.socket.off("list problem_statut"),this.socket.off("list lieu"),this.socket.off("notif from tech_main"),this.socket.offAny(),R.disconnect()}},{key:"render",value:function(){var e,t,n=this,s=this.state.numSelectedIntervention;return this.state.showSub?e={width:"45%"}:(e={background:"black",width:"0px"},t={display:"none"}),Object(L.jsxs)("div",{className:"notify_layout",children:[Object(L.jsx)(ge,Object(a.a)(Object(a.a)({},this.props),{},{showNotif:this.showNotif})),Object(L.jsxs)("div",{className:"notify_display",children:[Object(L.jsx)(Ne,Object(a.a)(Object(a.a)(Object(a.a)({},this.state),this.props),{},{socket:this.socket,nbNewNotifsPlus:this.nbNewNotifsPlus,showSub:this.showSubWithInfo,numSelectedIntervention:this.state.numSelectedIntervention})),Object(L.jsx)("div",{className:"sub-display",style:e,children:Object(L.jsx)(ae,Object(a.a)(Object(a.a)({num_intervention:this.state.numSelectedIntervention},this.props),{},{socket:this.socket,style:t,closeSub:function(){return n.showSubWithInfo(s)}}))}),Object(L.jsx)("div",{className:"notify_notif_pop",ref:this.notify_notif_pop,children:this.formatNotifsList(this.state.notifsList)})]})]})}}]),n}(o.a.Component);function Ne(e){var t=e.match,n=t.path,s=t.url;return Object(L.jsxs)("div",{className:"tab-display",children:[Object(L.jsxs)("nav",{className:"notify_nav",children:[Object(L.jsx)(M.c,{activeClassName:"active_navLink_notify",to:"".concat(s,"/ask"),children:"Demande d'assistance"}),Object(L.jsxs)(M.c,{activeClassName:"active_navLink_notify",to:"".concat(s,"/history"),children:["Historiques des demandes",e.nbNewNotifs>0?"(".concat(e.nbNewNotifs,")"):""]}),Object(L.jsx)(M.c,{activeClassName:"active_navLink_notify",to:"".concat(s,"/intervention"),children:"Interventions"})]}),Object(L.jsxs)("div",{className:"display",children:[e.children,Object(L.jsxs)(U.d,{children:[Object(L.jsx)(U.b,{path:"".concat(n,"/ask"),render:function(t){return Object(L.jsx)(_e,Object(a.a)(Object(a.a)({},t),{},{session:e.session,socket:e.socket,nbNewNotifsPlus:e.nbNewNotifsPlus}))}}),Object(L.jsx)(U.b,{path:"".concat(n,"/history"),render:function(t){return Object(L.jsx)(ye,Object(a.a)(Object(a.a)({},t),{},{session:e.session,socket:e.socket,nbNewNotifsToZero:function(){return e.nbNewNotifsPlus("0")},showSub:e.showSub,numSelectedIntervention:e.numSelectedIntervention}))}}),Object(L.jsx)(U.b,{path:"".concat(n,"/intervention"),render:function(t){return Object(L.jsx)(xe,Object(a.a)(Object(a.a)(Object(a.a)({},t),e),{},{socket:e.socket,showSub:e.showSub,numSelectedIntervention:e.numSelectedIntervention}))}}),Object(L.jsx)(U.a,{exact:!0,from:n,to:"".concat(n,"/ask")})]})]})]})}var we=function(e){Object(m.a)(n,e);var t=Object(h.a)(n);function n(){var e;Object(p.a)(this,n);for(var s=arguments.length,o=new Array(s),i=0;i<s;i++)o[i]=arguments[i];return(e=t.call.apply(t,[this].concat(o))).determineRender=function(){return e.props.conditionIn()?e.props.render:e.props.redirectRender},e}return Object(d.a)(n,[{key:"render",value:function(){return Object(L.jsx)(U.b,{path:this.props.path,render:this.determineRender()})}}]),n}(o.a.Component),Se=function(e){Object(m.a)(n,e);var t=Object(h.a)(n);function n(e){var s;return Object(p.a)(this,n),(s=t.call(this,e)).setCredentials=function(e){s.computedHash_TECH_MAIN=null,s.computedHash_USER=null,s.setState({logged:e.logged,num_user:e.num_user,username:e.username,type_user:e.type_user})},s.logOut=function(){s.setCredentials({logged:!1,num_user:"",username:"",type_user:null})},s.componentDidMount=Object(u.a)(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("======= APP component did mount , state ",s.state),!("true"===localStorage.getItem("logged"))){e.next=12;break}return console.log("compute hmac for user , tech_main"),e.next=6,g(v.code,s.state.username);case 6:return t=e.sent,e.next=9,g(f.code,s.state.username);case 9:n=e.sent,console.log(" after compute ",t,n),s.setState({t_u:t,t_t:n});case 12:case"end":return e.stop()}}),e)}))),console.log("======== APP constructor"),s.state={logged:"true"===localStorage.getItem("logged")||!1,num_user:localStorage.getItem("num_user")||"",username:localStorage.getItem("username")||"",type_user:localStorage.getItem("type_user")||null,t_u:null,t_t:null},s.computedHash_USER=null,s.computedHash_TECH_MAIN=null,console.log("constructor",s.state),s}return Object(d.a)(n,[{key:"shouldComponentUpdate",value:function(){var e=Object(u.a)(l.a.mark((function e(t,n){var s,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("==== APP shouldComponentUpdate  state",n),this.state.logged===n.logged){e.next=18;break}if(console.log("compute hmac for user , tech_main"),n.logged){e.next=8;break}s=null,o=null,e.next=14;break;case 8:return e.next=10,g(v.code,n.username);case 10:return s=e.sent,e.next=13,g(f.code,n.username);case 13:o=e.sent;case 14:console.log(" after compute ",s,o),this.setState({t_u:s,t_t:o}),e.next=19;break;case 18:return e.abrupt("return",!0);case 19:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(){console.log("==== APP componentDidUpdate "),localStorage.setItem("logged",this.state.logged),localStorage.setItem("num_user",this.state.num_user),localStorage.setItem("username",this.state.username),localStorage.setItem("type_user",this.state.type_user)}},{key:"render",value:function(){var e=this;console.log("===== APP render"),console.log("state ",this.state);var t,n=function(){if(console.log("==== determineRootRedirect function "),console.log("state in determineRootRedirect ",e.state),console.log(" computedhash ",e.state.t_u,e.state.t_t),e.state.logged){if(console.log(" logged"),e.state.type_user===e.state.t_u)return"/notify";if(e.state.type_user===e.state.t_t)return"/acim"}return console.log("no logged"),console.log("==== end determineRootRedirect "),"/login"}();return console.log("redirectTo ",n),this.state.logged&&(t={num_user:this.state.num_user,username:this.state.username,type_user:this.state.type_user}),console.log("=== end of render appp"),Object(L.jsx)(I,{children:Object(L.jsx)("div",{className:"App",children:Object(L.jsxs)(U.d,{children:[Object(L.jsx)(we,{path:"/login",conditionIn:function(){return!e.state.logged},render:function(t){return Object(L.jsx)(C,Object(a.a)(Object(a.a)({},t),{},{setCredentials:e.setCredentials}))},redirectRender:function(e){return Object(L.jsx)(U.a,{to:n})}}),Object(L.jsx)(we,{path:"/acim",conditionIn:function(){return!(!e.state.logged||e.state.type_user!==e.state.t_t)},render:function(n){return Object(L.jsx)(ve,Object(a.a)(Object(a.a)({},n),{},{session:t,logOut:e.logOut}))},redirectRender:function(e){return Object(L.jsx)(U.a,{to:n})}}),Object(L.jsx)(we,{path:"/notify",conditionIn:function(){return!(!e.state.logged||e.state.type_user!==e.state.t_u)},render:function(n){return Object(L.jsx)(ke,Object(a.a)(Object(a.a)({},n),{},{session:t,logOut:e.logOut}))},redirectRender:function(e){return Object(L.jsx)(U.a,{to:n})}}),Object(L.jsx)(U.b,{path:"/info",children:Object(L.jsxs)("dl",{children:[Object(L.jsx)("dt",{children:" a.c.i.m "}),Object(L.jsx)("dd",{children:" Application de Coordination des Interventions de Maintenance "})]})}),Object(L.jsx)(U.a,{from:"/",to:"/login"})]})})})}}]),n}(o.a.Component),De=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,381)).then((function(t){var n=t.getCLS,s=t.getFID,o=t.getFCP,i=t.getLCP,r=t.getTTFB;n(e),s(e),o(e),i(e),r(e)}))};r.a.render(Object(L.jsx)(o.a.StrictMode,{children:Object(L.jsx)(M.a,{children:Object(L.jsx)(Se,{})})}),document.getElementById("root")),De()}},[[378,1,2]]]);
//# sourceMappingURL=main.65e1020c.chunk.js.map