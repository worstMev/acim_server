(this.webpackJsonpacim_client=this.webpackJsonpacim_client||[]).push([[0],{180:function(e,t,n){},182:function(e,t,n){},183:function(e,t,n){},188:function(e,t){},190:function(e,t){},201:function(e,t){},203:function(e,t){},230:function(e,t){},232:function(e,t){},233:function(e,t){},238:function(e,t){},240:function(e,t){},259:function(e,t){},271:function(e,t){},274:function(e,t){},318:function(e,t,n){},323:function(e,t,n){},349:function(e,t,n){},350:function(e,t,n){},351:function(e,t,n){},352:function(e,t,n){},353:function(e,t,n){},354:function(e,t,n){},355:function(e,t,n){},356:function(e,t,n){},357:function(e,t,n){},358:function(e,t,n){},359:function(e,t,n){},360:function(e,t,n){},361:function(e,t,n){},362:function(e,t,n){},363:function(e,t,n){},364:function(e,t,n){},365:function(e,t,n){},366:function(e,t,n){},367:function(e,t,n){},368:function(e,t,n){},369:function(e,t,n){},370:function(e,t,n){},371:function(e,t,n){},372:function(e,t,n){},373:function(e,t,n){},374:function(e,t,n){},375:function(e,t,n){"use strict";n.r(t);var o=n(1),s=n.n(o),i=n(171),r=n.n(i),a=(n(180),n(2)),c=n(12),l=n.n(c),u=n(19),d=n(3),p=n(4),h=n(6),b=n(5),m=(n(182),n(183),n(172)),j=n.n(m),f={text:"technicien de maintenance",code:"TECH_MAIN"},v={text:"utilisateur",code:"USER"};function O(e,t){return _.apply(this,arguments)}function _(){return(_=Object(u.a)(l.a.mark((function e(t,n){var o,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,j.a.HmacMD5(t,n);case 2:return o=e.sent,s="\\x"+o,e.abrupt("return",s);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var g=n(173),y=n.n(g),x="http://localhost:3500/ajax/acim";function k(e,t){return N.apply(this,arguments)}function N(){return(N=Object(u.a)(l.a.mark((function e(t,n){var o,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=y.a.create({baseURL:x}),e.prev=1,e.next=4,o.post(t,n);case 4:return s=e.sent,e.abrupt("return",s);case 8:e.prev=8,e.t0=e.catch(1),console.log("error to fetch data from ".concat(x).concat(t)),console.log(e.t0);case 12:case"end":return e.stop()}}),e,null,[[1,8]])})))).apply(this,arguments)}function w(e){return S.apply(this,arguments)}function S(){return(S=Object(u.a)(l.a.mark((function e(t){var n,o;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"/authenticate/username",n={username:t},e.prev=2,e.next=5,k("/authenticate/username",n);case 5:return o=e.sent,console.log(" username  :"+t+" is valid "+o.data.usernameIsValid),e.abrupt("return",{usernameIsValid:o.data.usernameIsValid});case 10:e.prev=10,e.t0=e.catch(2),console.log("error in authenticateUsername"),console.log(e.t0);case 14:case"end":return e.stop()}}),e,null,[[2,10]])})))).apply(this,arguments)}function D(e,t){return T.apply(this,arguments)}function T(){return(T=Object(u.a)(l.a.mark((function e(t,n){var o,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return"/authenticate",o={username:t,password:n},e.prev=2,e.next=5,k("/authenticate",o);case 5:return s=e.sent,console.log(" authentication success for "+t+" "+s.data.found),e.abrupt("return",{isAuthenticated:s.data.found,username:s.data.row.username,num_user:s.data.row.num_user,type_user:s.data.row.type_user});case 10:e.prev=10,e.t0=e.catch(2),console.log("error in authenticate"),console.log(e.t0);case 14:case"end":return e.stop()}}),e,null,[[2,10]])})))).apply(this,arguments)}var L=n(0),C=function(e){Object(h.a)(n,e);var t=Object(b.a)(n);function n(e){var o;return Object(d.a)(this,n),(o=t.call(this,e)).changeSubmittedUsername=function(e){o.setState({submittedUsername:e.target.value})},o.changeSubmittedPassword=function(e){o.setState({submittedPassword:e.target.value})},o.checkCredentials=function(){var e=Object(u.a)(l.a.mark((function e(t){var n,s,i,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),o.state.usernameIsValid){e.next=9;break}return e.next=4,w(o.state.submittedUsername);case 4:n=e.sent,console.log(n),o.setState({usernameIsValid:n.usernameIsValid}),e.next=30;break;case 9:return console.log("authenticate username/password"),e.prev=10,e.next=13,D(o.state.submittedUsername,o.state.submittedPassword);case 13:if(s=e.sent,console.log(s),!s.isAuthenticated){e.next=25;break}return o.props.setCredentials({logged:!0,num_user:s.num_user,username:s.username,type_user:s.type_user}),e.next=19,O(v.code,s.username);case 19:return i=e.sent,e.next=22,O(f.code,s.username);case 22:r=e.sent,s.type_user===i&&o.props.history.push("/notify"),s.type_user===r&&o.props.history.push("/acim");case 25:e.next=30;break;case 27:e.prev=27,e.t0=e.catch(10),console.log("error in checkCrendentials",e.t0);case 30:case"end":return e.stop()}}),e,null,[[10,27]])})));return function(t){return e.apply(this,arguments)}}(),o.state={usernameIsValid:!1,submittedUsername:"",submittedPassword:""},o}return Object(p.a)(n,[{key:"render",value:function(){return Object(L.jsxs)("div",{className:"login",children:[Object(L.jsx)("div",{children:Object(L.jsx)("img",{src:"./base_logo_sans_texte.png",alt:"mptdn|acim",id:"logo"})}),Object(L.jsxs)("form",{className:"login_form",onSubmit:this.checkCredentials,children:[this.state.usernameIsValid?Object(L.jsx)("input",{type:"password",placeholder:"mot de passe",value:this.state.submittedPassword,onChange:this.changeSubmittedPassword,autoFocus:!0}):Object(L.jsx)("input",{type:"text",placeholder:"utilisateur",value:this.state.submittedUsername,onChange:this.changeSubmittedUsername,autoFocus:!0}),Object(L.jsxs)("button",{className:"my-button login-button",onClick:this.checkCredentials,children:[" ",">"," "]})]})]})}}]),n}(s.a.Component),I=n(10),M=(n(318),function(e){Object(h.a)(n,e);var t=Object(b.a)(n);function n(){return Object(d.a)(this,n),t.apply(this,arguments)}return Object(p.a)(n,[{key:"render",value:function(){return Object(L.jsxs)("div",{id:"layout",children:[Object(L.jsx)("main",{children:this.props.children}),Object(L.jsxs)("footer",{children:[Object(L.jsx)(I.b,{to:"/",children:"home"}),Object(L.jsx)(I.b,{to:"/info",children:"info"}),Object(L.jsx)(I.b,{to:"/acim",children:"acim"}),Object(L.jsx)(I.b,{to:"/notify",children:"notify"})]})]})}}]),n}(s.a.Component)),P=(n(323),n(11)),U=n(175),A=Object(U.io)("http://localhost:3500",{autoConnect:!1});A.onAny((function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];console.log("-- ".concat(e," "),n)}));var R={socket:A,connect:function(e,t,n){console.log(e,t,n),console.log(A),A.auth={username:e,type_user:t,num_user:n},A.connect()},disconnect:function(){console.log("my socket disconnect "),A.offAny(),A.disconnect()}},F=(n(349),n(350),n(351),function(e){Object(h.a)(n,e);var t=Object(b.a)(n);function n(e){var o;return Object(d.a)(this,n),(o=t.call(this,e)).showDetails=function(){o.setState({detailsAreShown:!o.state.detailsAreShown})},o.goToIntervention=function(e){o.props.showSub(e)},o.state={detailsAreShown:!1},o}return Object(p.a)(n,[{key:"render",value:function(){var e,t,n=this,o=this.props.intervention,s=o.date_programme,i=o.num_intervention,r=o.lieu_libelle,c=o.motif,l=o.intervention_type,u=o.tech_main_username,d=o.numero,p=o.done,h=o.probleme_resolu,b=o.libelle_probleme_tech_type,m=o.code_intervention_type,j={display:"none"};return this.state.detailsAreShown&&(j={height:"80%"},e={height:"15%"},t={height:"300px"}),this.props.selected&&(t=Object(a.a)(Object(a.a)({},t),{},{background:"rgb(169, 200, 247)"})),t=p?Object(a.a)(Object(a.a)({},t),{},{borderLeft:"5px solid green",borderTop:"1px solid green",borderBottom:"1px solid green",borderRight:"1px solid green"}):Object(a.a)(Object(a.a)({},t),{},{borderLeft:"5px solid red"}),t=Object(a.a)(Object(a.a)({},t),{},{borderRadius:"0 5px 5px 0"}),Object(L.jsxs)("div",{className:"toDo",style:t,children:[Object(L.jsxs)("div",{className:"toDo-sum",style:e,children:[Object(L.jsxs)("p",{children:[" #",d," ",Object(L.jsx)("br",{})," ",m]}),Object(L.jsxs)("p",{children:[" ",new Date(s).toLocaleString("fr-FR")," "]}),Object(L.jsxs)("p",{children:[" ",r," "]}),Object(L.jsxs)("p",{id:"tache_description",children:[" ",l," "]}),Object(L.jsxs)("p",{id:"tech_main_username",children:[" ",u," "]}),Object(L.jsxs)("p",{children:[" Effectue : ",p?"OUI":"NON"," et ",h?"RESOLU":"NON-RESOLU"," "]}),Object(L.jsx)("button",{onClick:this.showDetails,children:" Details "})]}),Object(L.jsxs)("div",{className:"toDo-details",style:j,children:[Object(L.jsxs)("p",{children:[" Type : ",l,"  "]}),Object(L.jsxs)("p",{children:[" Motif : ",c," "]}),Object(L.jsxs)("p",{children:[" Lieu : ",r," "]}),Object(L.jsxs)("p",{children:[" Cr\xe8\xe8e par : ",u," "]}),Object(L.jsxs)("p",{children:[" ID intervention : ",i," "]}),Object(L.jsxs)("p",{children:[" Probleme constat\xe9 : ",b," "]}),Object(L.jsx)("button",{onClick:function(){return n.goToIntervention(i)},children:this.props.selected?"Fermer":"Ouvrir"})]})]})}}]),n}(s.a.Component)),q=(n(352),function(e){Object(h.a)(n,e);var t=Object(b.a)(n);function n(e){var o;return Object(d.a)(this,n),(o=t.call(this,e)).flipFold=function(){var e=!o.state.folded;o.setState({folded:e})},o.state={folded:o.props.folded},o}return Object(p.a)(n,[{key:"render",value:function(){var e,t=this.props,n=t.children,o=t.title,s=t.titleStyle,i=this.state.folded;return e=i?Object(a.a)(Object(a.a)({},e),{},{maxHeight:"50px",minHeight:"50px"}):Object(a.a)(Object(a.a)({},e),{},{maxHeight:"500px"}),Object(L.jsxs)("div",{className:"foldableDiv",style:e,children:[Object(L.jsxs)("div",{className:"foldableDiv-title",style:s,onClick:this.flipFold,children:[Object(L.jsxs)("p",{children:[" ",o," "]}),Object(L.jsxs)("button",{onClick:this.flipFold,children:[i?"v":"^"," "]})]}),Object(L.jsx)("div",{className:"foldableDiv-children",children:n})]})}}]),n}(o.Component)),H=function(e){Object(h.a)(n,e);var t=Object(b.a)(n);function n(e){var o;return Object(d.a)(this,n),(o=t.call(this,e)).componentDidMount=function(){console.log("ToDoList did mount"),o.props.socket.emit("get undone intervention",o.props.num_tech_main),o.props.socket.on("list undone intervention",(function(e){console.log("list undone intervention",e);var t=e.map((function(e,t){return{num_intervention:e.num_intervention,date_programme:e.date_programme,lieu_libelle:e.libelle,intervention_type:e.libelle_intervention_type,tech_main_username:e.username,motif:e.motif,numero:t+1,done:e.done,libelle_probleme_tech_type:e.libelle_probleme_tech_type,code_intervention_type:e.code_intervention_type}}));console.log("new list intervention undone",t),o.props.setNbInterventionUndone&&o.props.setNbInterventionUndone(t.length);var n=t.filter((function(e){return new Date(e.date_programme).getTime()<=(new Date).getTime()})),s=t.filter((function(e){var t=new Date(e.date_programme).getTime(),n=new Date((new Date).setHours(0,0,0)).getTime(),o=new Date((new Date).setHours(23,59,59)).getTime();return t>n&&t<=o}));console.log("newListToday",s),o.setState({interventionListUndone:t,interventionListUndoneLate:n,interventionListUndoneToday:s})})),o.props.socket.on("new intervention",(function(){console.log("new intervention todolist"),o.props.socket.emit("get undone intervention")})),o.props.socket.on("ended intervention",(function(){console.log("ended intervention todolist"),o.props.socket.emit("get undone intervention")}))},o.clickOnToDoList=function(){},o.componentWillUnmount=function(){console.log("ToDoList will unmount"),o.props.socket.off("list undone intervention")},o.displayToDo=function(e){return e.map((function(e){return Object(L.jsx)(F,{showSub:o.props.showSub,intervention:e},e.num_intervention)}))},o.state={interventionListUndone:[],interventionListUndoneLate:[],interventionListUndoneToday:[]},o}return Object(p.a)(n,[{key:"componentDidUpdate",value:function(){console.log("update toDoList")}},{key:"render",value:function(){var e=this.state,t=e.interventionListUndoneLate,n=e.interventionListUndoneToday,o=e.interventionListUndone,s="En retard : ".concat(t.length),i="Aujourd'hui : ".concat(n.length),r="Toutes : ".concat(o.length);return Object(L.jsxs)("div",{id:"toDoList",onClick:this.clickOnToDoList,children:[Object(L.jsxs)("p",{children:[" ",this.props.topText||"Liste des taches a faire :"," "]}),Object(L.jsxs)("div",{className:"scroll_list",children:[Object(L.jsx)(q,{title:s,titleStyle:{color:"red"},folded:!0,children:Object(L.jsx)("div",{className:"scroll_list",children:this.displayToDo(this.state.interventionListUndoneLate)})}),Object(L.jsx)(q,{title:i,children:Object(L.jsx)("div",{className:"scroll_list",children:this.displayToDo(this.state.interventionListUndoneToday)})}),Object(L.jsx)(q,{title:r,folded:!0,children:Object(L.jsx)("div",{className:"scroll_list",children:this.displayToDo(this.state.interventionListUndone)})})]})]})}}]),n}(s.a.Component),W=(n(353),n(354),{code:"MAX",libelle:"tres urgent"}),E={code:"MID",libelle:"moyennement urgent"},V={code:"MIN",libelle:"pas urgent"},Z=function(e){Object(h.a)(n,e);var t=Object(b.a)(n);function n(e){var o;return Object(d.a)(this,n),(o=t.call(this,e)).showDetails=function(){o.state.commandAreShown||o.setState({detailsAreShown:!o.state.detailsAreShown})},o.showCommand=function(){o.setState({commandAreShown:!o.state.commandAreShown,detailsAreShown:!o.state.commandAreShown})},o.do=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=o.props.notif.num_notification,n=o.props.num_user;console.log("do the notif #".concat(t," ").concat(e," by ").concat(n)),o.props.socket.emit("tech_main do",{num_notification:t,num_app_user_tech_main:n,delai:e})},o.state={detailsAreShown:!1,commandAreShown:!1},o}return Object(p.a)(n,[{key:"render",value:function(){var e,t,n,o,s=this;switch(this.props.notif.statut_code){case W.code:e={borderLeft:"3px solid red"},n={color:"red",fontWeight:"bold"};break;case E.code:e={borderLeft:"3px solid yellow"},n={color:"yellow",fontWeight:"bold"};break;case V.code:e={borderLeft:"3px solid blue"},n={color:"blue"}}return(this.state.detailsAreShown||this.state.commandAreShown)&&(o={height:"80%"},t={height:"15%"},e=Object(a.a)(Object(a.a)({},e),{},{height:"300px"})),Object(L.jsxs)("div",{className:"notif",style:e,children:[Object(L.jsxs)("div",{className:"notif-sum",style:t,children:[Object(L.jsxs)("div",{className:"probleme_type",children:[Object(L.jsxs)("p",{children:[" ",this.props.notif.probleme_type," "]}),Object(L.jsxs)("p",{children:[" ",this.props.notif.code," "]})]}),Object(L.jsxs)("div",{className:"probleme_statut",style:n,children:[Object(L.jsxs)("p",{children:[" ",this.props.notif.statut_libelle," "]}),Object(L.jsxs)("p",{children:[" ",this.props.notif.lieu," "]})]}),Object(L.jsxs)("div",{className:"date_envoie",children:[Object(L.jsx)("p",{children:" Date d'envoie : "}),Object(L.jsxs)("p",{children:[" ",this.props.notif.date_envoie," "]})]}),Object(L.jsx)("button",{onClick:this.showDetails,children:" Details "}),Object(L.jsx)("button",{onClick:this.showCommand,children:" repondre "})]}),this.state.detailsAreShown&&Object(L.jsxs)("div",{className:"notif-details",style:o,children:[Object(L.jsxs)("p",{children:[" Remarque : ",this.props.notif.remarque||"-"," "]}),Object(L.jsxs)("p",{children:[" Envoyee par : ",this.props.notif.sender_username||"-"," "]}),Object(L.jsx)("p",{children:" Details 1 "})]}),this.state.commandAreShown&&Object(L.jsxs)("div",{className:"notif-command",children:[Object(L.jsx)("button",{onClick:function(){return s.do()},children:"prendre en charge"}),Object(L.jsx)("button",{children:"faire patienter"}),Object(L.jsx)("button",{children:"ouvrir message"})]})]})}}]),n}(s.a.Component),Y=function(e){Object(h.a)(n,e);var t=Object(b.a)(n);function n(e){var o;return Object(d.a)(this,n),(o=t.call(this,e)).displayNotif=function(e){return e.map((function(e){return Object(L.jsx)(Z,{notif:e,num_user:o.props.session.num_user,socket:o.props.socket},e.num_notification)}))},o.onClickOnNotifsList=function(){o.props.nbNewNotificationToZero()},o.componentDidMount=function(){o.props.nbNewNotificationToZero(),o.props.socket.emit("get notifs list unanswered"),o.props.socket.on("unanswered notifs list",(function(e){var t=e.map((function(e){return{num_notification:e.num_notification,sender_username:e.user_sender_username,probleme_type:e.probleme_type,probleme_code:e.code,statut_code:e.statut,statut_libelle:e.statut_libelle,lieu:e.lieu,remarque:e.remarque,date_envoie:new Date(e.date_envoie).toLocaleString("fr-FR")}}));o.props.setNbNewNotif&&o.props.setNbNewNotif(t.length),o.setState({unansweredNotifsList:t})})),o.props.socket.on("new notif",(function(e){o.props.socket.emit("get notifs list unanswered")})),o.props.socket.on("update notifs list unanswered",(function(){console.log("update notifs list unanswerd"),setTimeout((function(){o.props.socket.emit("get notifs list unanswered")}),2e3)}))},o.componentWillUnmount=function(){console.log("UNMOUNT notifsList"),o.props.socket.off("unanswered notifs list"),o.props.socket.off("update notifs list unanswered")},o.state={unansweredNotifsList:[]},o}return Object(p.a)(n,[{key:"render",value:function(){return Object(L.jsxs)("div",{id:"notifsList",onClick:this.onClickOnNotifsList,children:[Object(L.jsxs)("p",{children:[" Notifications recues ",this.props.session.username," "]}),Object(L.jsx)("div",{id:"scroll_list-notifsList",children:this.displayNotif(this.state.unansweredNotifsList)})]})}}]),n}(s.a.Component),z=n(31),B=n(34),J=(n(355),n(356),function(e){Object(h.a)(n,e);var t=Object(b.a)(n);function n(){return Object(d.a)(this,n),t.apply(this,arguments)}return Object(p.a)(n,[{key:"render",value:function(){var e=this,t=(this.props.array||[]).map((function(e){return Object(L.jsx)("option",{value:e,children:e},e)}));return this.props.objArray&&(t=this.props.objArray.map((function(e){return Object(L.jsx)("option",{value:e.value,children:e.libelle},e.key)}))),Object(L.jsx)("div",{className:"dropDown",children:Object(L.jsx)("select",{defaultValue:this.props.selectedValue,value:this.props.value,onChange:function(t){return e.props.onChange(t)},children:t})})}}]),n}(s.a.Component)),K=function(e){Object(h.a)(n,e);var t=Object(b.a)(n);function n(e){var o;return Object(d.a)(this,n),(o=t.call(this,e)).updateTypeIntervention=function(e){console.log("update type intervention",e.target.value);var t=e.target.value;o.setState({selectedNumInterventionType:t})},o.updateDateProgramme=function(e){console.log("updateDateProgramme ",new Date(e.target.value));var t=new Date(e.target.value);o.setState({dateProgramme:t,dateProgrammeDisplay:e.target.value})},o.updateLieu=function(e,t){console.log("update lieu",e.target.value),console.log(t);var n=e.target.value;o.setState({selectedNumLieu:n})},o.updateMaterielType=function(e){console.log("updateMaterielType",e.target.value),console.log("this.materiel",o.materiels),o.setState({selectedMaterielType:e.target.value,materielList:o.materiels[e.target.value]})},o.updateMateriel=function(e){console.log("updateMateriel",e.target.value),o.setState({selectedNumMateriel:e.target.value})},o.updateMotif=function(e){console.log("update motif",e.target.value),o.setState({motif:e.target.value})},o.updateProbleme=function(e,t){console.log("update probleme",e.target.value),console.log(o.problemeTechTypes);var n,s,i=o.problemeTechTypes[e.target.value],r=t||o.state.selectedNumLieu;n=o.lieus[r],s=i?"Resoudre probleme : ".concat(i," -- ").concat(n):o.state.motif,console.log("motif",s),o.setState({motif:s,selectedNumProblemeTechType:e.target.value||"",selectedNumLieu:r})},o.createDecharge=function(){alert("Creer un decharge pour le materiel :"+o.state.selectedNumMateriel)},o.createIntervention=function(){var e=o.state,t=e.selectedNumInterventionType,n=e.dateProgramme,s=e.selectedNumLieu,i=e.selectedNumProblemeTechType,r=e.selectedNumMateriel,a=e.motif;t&&s&&n?(console.log("create intervention : ",t,"",s,n,a,r,i),o.props.socket.emit("create intervention",t,"",s,n,a,r,i)):o.setState({message:"selectionner un type d'intervention, un lieu et une date programm\xe9e"})},o.state={interventionTypeList:[],selectedNumInterventionType:"",dateProgramme:new Date,dateProgrammeDisplay:new Date((new Date).setHours(11,0,0,0)).toISOString().replace("Z",""),lieuList:[],selectedNumLieu:"",materielList:[],selectedNumMateriel:"",materielTypes:[],selectedMaterielType:"",motif:"ND",problemeList:[],selectedNumProblemeTechType:"",message:""},o.materiels=null,o.lieus=null,o.problemeTechTypes=null,o}return Object(p.a)(n,[{key:"componentDidMount",value:function(){var e=this;console.log("createIntervention did mount"),this.props.socket.emit("get intervention definition"),this.props.socket.on("intervention_type list",(function(t){console.log(" intervention_types ",t);var n=t.map((function(e){return{key:e.num_intervention_type,value:e.num_intervention_type,libelle:e.libelle_intervention_type}}));e.setState({interventionTypeList:n,selectedNumInterventionType:n[0].key})})),this.props.socket.on("lieu list",(function(t){console.log("lieus",t);var n,o=Object(B.a)(t);try{for(o.s();!(n=o.n()).done;){var s=n.value;e.lieus=Object(a.a)(Object(a.a)({},e.lieus),{},Object(z.a)({},s.num_lieu,[s.libelle]))}}catch(r){o.e(r)}finally{o.f()}var i=t.map((function(e){return{key:e.num_lieu,value:e.num_lieu,libelle:e.libelle}}));e.setState({lieuList:i,selectedNumLieu:i[0].value})})),this.props.socket.on("materiel list",(function(t,n){var o;console.log("materiels",t);var s,i=Object(B.a)(n);try{var r=function(){var e=s.value;o=Object(a.a)(Object(a.a)({},o),{},Object(z.a)({},e.libelle_materiel_type,t.filter((function(t){return t.num_materiel_type===e.num_materiel_type})).map((function(e){return{key:e.num_materiel,value:e.num_materiel,libelle:e.libelle_materiel}}))))};for(i.s();!(s=i.n()).done;)r()}catch(c){i.e(c)}finally{i.f()}n=n.map((function(e){return e.libelle_materiel_type})),console.log("materielsList",o,n),e.materiels=o,e.setState({materielTypes:n,selectedMaterielType:n[0],materielList:o[n[0]]})})),this.props.socket.on("probleme_tech_type list",(function(t){console.log("probleme_tech_types",t);var n,o=Object(B.a)(t);try{for(o.s();!(n=o.n()).done;){var s=n.value;e.problemeTechTypes=Object(a.a)(Object(a.a)({},e.problemeTechTypes),{},Object(z.a)({},s.num_probleme_tech_type,s.libelle_probleme_tech_type))}}catch(r){o.e(r)}finally{o.f()}var i=t.map((function(e){return{key:e.num_probleme_tech_type,value:e.num_probleme_tech_type,libelle:e.libelle_probleme_tech_type}}));e.setState({problemeList:i})}))}},{key:"componentWillUnmount",value:function(){this.props.socket.off("intervention_type list"),this.props.socket.off("lieu list"),this.props.socket.off("materiel list"),this.props.socket.off("probleme_tech_type list")}},{key:"render",value:function(){var e=this,t=this.state,n=t.interventionTypeList,o=t.selectedNumInterventionType,s=t.lieuList,i=t.selectedNumLieu,r=t.materielList,a=t.selectedNumMateriel,c=t.materielTypes,l=t.selectedMaterielType,u=t.motif,d=t.selectedNumProblemeTechType,p=t.problemeList,h=t.message;return Object(L.jsxs)("div",{className:"createIntervention",children:[Object(L.jsx)("p",{children:" Cr\xe9er une intervention :"}),Object(L.jsxs)("div",{className:"scroll-option",children:[Object(L.jsxs)(q,{title:"Intervention",folded:!1,children:[Object(L.jsxs)("div",{className:"sub-category-option",children:[Object(L.jsx)("label",{children:" Type Intervention :"}),Object(L.jsx)(J,{value:o,objArray:n,onChange:this.updateTypeIntervention})]}),Object(L.jsxs)("div",{className:"sub-category-option",children:[Object(L.jsx)("label",{children:" Date programm\xe9e :"}),Object(L.jsx)("input",{type:"datetime-local",value:this.state.dateProgrammeDisplay,onChange:this.updateDateProgramme})]}),Object(L.jsxs)("div",{className:"sub-category-option",children:[Object(L.jsx)("label",{children:" Lieu :"}),Object(L.jsx)(J,{value:i,objArray:s,onChange:function(t){e.updateProbleme({target:{value:d}},t.target.value)}})]})]}),Object(L.jsxs)(q,{title:"Materiel",folded:!0,children:[Object(L.jsxs)("div",{className:"sub-category-option",children:[Object(L.jsx)("label",{children:" Type materiel:"}),Object(L.jsx)(J,{value:l,array:c,onChange:this.updateMaterielType})]}),Object(L.jsxs)("div",{className:"sub-category-option",children:[Object(L.jsx)("label",{children:" Materiel:"}),Object(L.jsx)(J,{value:a,objArray:r,onChange:this.updateMateriel})]}),Object(L.jsx)("div",{className:"sub-category-option",children:Object(L.jsx)("button",{onClick:this.createDecharge,children:" creer une decharge "})})]}),Object(L.jsxs)(q,{title:"Motif",folded:!0,children:[Object(L.jsxs)("div",{className:"sub-category-option",children:[Object(L.jsx)("label",{children:" Motif :"}),Object(L.jsx)("textarea",{value:u,onChange:this.updateMotif})]}),Object(L.jsxs)(q,{title:"Probleme",folded:!0,children:[Object(L.jsxs)("div",{className:"sub-category-option",children:[Object(L.jsx)("label",{children:" Type du probleme:"}),Object(L.jsx)(J,{value:d,objArray:p,onChange:this.updateProbleme})]}),Object(L.jsxs)("div",{className:"sub-category-option",children:[Object(L.jsx)("label",{children:" Lieu :"}),Object(L.jsx)(J,{value:i,objArray:s,onChange:function(t){e.updateProbleme({target:{value:d}},t.target.value)}})]})]})]})]}),Object(L.jsx)("button",{onClick:this.createIntervention,children:" Planifier "}),Object(L.jsxs)("p",{children:[" ",h," "]})]})}}]),n}(o.Component),X=function(e){Object(h.a)(n,e);var t=Object(b.a)(n);function n(e){var o;return Object(d.a)(this,n),(o=t.call(this,e)).nbInterventionUndonePlus=function(e){console.log("nbInterventionUndonePlus",e);var t=e;t=parseInt(t),o.setState({nbInterventionUndone:t})},o.nbNewNotificationPlus=function(e){console.log("nbNewNotificationPlus",e);var t=e;t=parseInt(t),o.setState({nbNewNotification:t})},o.componentDidMount=function(){console.log("DASHBOARD did mount"),o.props.socket.emit("get nb intervention undone"),o.props.socket.on("nb intervention undone",(function(e){console.log("nb intervention undone"),o.setState({nbInterventionUndone:e})})),o.props.socket.on("new intervention",(function(){console.log("new intervention dashboard"),o.props.socket.emit("get nb intervention undone")})),o.props.socket.on("ended intervention",(function(){console.log(" ended intervention dashboard"),o.props.socket.emit("get nb intervention undone")}))},o.componentWillUnmount=function(){o.props.socket.off("nb intervention undone"),o.props.socket.off("new intervention "),o.props.socket.off("ended intervention"),o.props.socket.off("materiel list")},o.state={nbInterventionUndone:0,nbNewNotification:0},o}return Object(p.a)(n,[{key:"render",value:function(){var e=this,t=this.props.match,n=t.path,o=t.url;return Object(L.jsx)("div",{className:"dashboard",children:Object(L.jsxs)("div",{className:"main-dashboard",style:undefined,children:[Object(L.jsxs)("nav",{id:"nav_dashboard",children:[Object(L.jsxs)(I.c,{activeClassName:"active_navLink_dashboard",to:"".concat(o,"/toDo"),children:[" Interventions a faire ",this.state.nbInterventionUndone>0?"(".concat(this.state.nbInterventionUndone,")"):""," "]}),Object(L.jsxs)(I.c,{activeClassName:"active_navLink_dashboard",to:"".concat(o,"/notifs"),children:[" Notifications ",this.state.nbNewNotification>0?"(".concat(this.state.nbNewNotification,")"):""]}),Object(L.jsx)(I.c,{activeClassName:"active_navLink_dashboard",to:"".concat(o,"/creer"),children:" Creer "})]}),Object(L.jsx)("div",{id:"display_dashboard",children:Object(L.jsxs)(P.d,{children:[Object(L.jsx)(P.a,{exact:!0,from:n,to:"".concat(n,"/toDo")}),Object(L.jsx)(P.b,{path:"".concat(n,"/toDo"),render:function(t){return Object(L.jsx)(H,Object(a.a)(Object(a.a)({setNbInterventionUndone:e.nbInterventionUndonePlus},t),e.props))}}),Object(L.jsx)(P.b,{path:"".concat(n,"/notifs"),render:function(t){return Object(L.jsx)(Y,Object(a.a)(Object(a.a)(Object(a.a)({},t),e.props),{},{setNbNewNotif:e.nbNewNotificationPlus}))}}),Object(L.jsx)(P.b,{path:"".concat(n,"/creer"),render:function(t){return Object(L.jsx)(K,Object(a.a)(Object(a.a)({},t),e.props))}})]})})]})})}}]),n}(s.a.Component),G=(n(357),n(358),function(e){Object(h.a)(n,e);var t=Object(b.a)(n);function n(e){var o;return Object(d.a)(this,n),(o=t.call(this,e)).showDetails=function(){o.setState({detailsAreShown:!o.state.detailsAreShown})},o.state={detailsAreShown:!1},o}return Object(p.a)(n,[{key:"render",value:function(){var e,t,n,o;switch(this.props.notif.statut_code){case W.code:e={borderLeft:"3px solid red"},n={color:"red",fontWeight:"bold"};break;case E.code:e={borderLeft:"3px solid yellow"},n={color:"yellow",fontWeight:"bold"};break;case V.code:e={borderLeft:"3px solid blue"},n={color:"blue"}}return this.state.detailsAreShown&&(o={height:"80%"},t={height:"15%"},e=Object(a.a)(Object(a.a)({},e),{},{height:"300px"})),this.props.notif.num_app_user_tech_main&&this.props.notif.date_reponse&&(e=Object(a.a)(Object(a.a)({},e),{},{background:"#a9c8f7"})),Object(L.jsxs)("div",{className:"notif_history",style:e,children:[Object(L.jsxs)("div",{className:"notif_history-sum",style:t,children:[Object(L.jsxs)("div",{className:"probleme_type",children:[Object(L.jsxs)("p",{children:[" ",this.props.notif.probleme_type," "]}),Object(L.jsxs)("p",{children:[" ",this.props.notif.code," "]})]}),Object(L.jsxs)("div",{className:"probleme_statut",style:n,children:[Object(L.jsxs)("p",{children:[" ",this.props.notif.statut_libelle," "]}),Object(L.jsxs)("p",{children:[" ",this.props.notif.lieu," "]})]}),Object(L.jsx)("div",{className:"user_sender_username",children:Object(L.jsxs)("p",{children:[" par : ",this.props.notif.user_sender_username," "]})}),Object(L.jsxs)("div",{className:"date_envoie",children:[Object(L.jsx)("p",{children:" Date d'envoie : "}),Object(L.jsxs)("p",{children:[" ",this.props.notif.date_envoie," "]})]}),Object(L.jsx)("button",{onClick:this.showDetails,children:" Details "})]}),this.state.detailsAreShown&&Object(L.jsxs)("div",{className:"notif-details",style:o,children:[Object(L.jsxs)("p",{children:[" remarque: ",this.props.notif.remarque," "]}),Object(L.jsxs)("p",{children:[" envoyee par : ",this.props.notif.user_sender_username," "]}),Object(L.jsxs)("p",{children:[" pris en charge par : ",this.props.notif.tech_main_username,"  "]}),Object(L.jsxs)("p",{children:[" repondue le : ",this.props.notif.date_reponse," "]}),Object(L.jsxs)("p",{children:[" ID notification : ",this.props.notif.num_notification," "]}),Object(L.jsx)("p",{children:" Details 1 "})]})]})}}]),n}(s.a.Component)),Q=function(e){Object(h.a)(n,e);var t=Object(b.a)(n);function n(e){var o;return Object(d.a)(this,n),(o=t.call(this,e)).componentDidMount=Object(u.a)(l.a.mark((function e(){return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log(" NOTIFSHISTORY did mount "),o.props.socket.emit("get notifs history"),o.props.socket.on("notifs history",(function(e){console.log("notification history for tech_main",e);var t=e.map((function(e){return Object(a.a)(Object(a.a)({},e),{},{statut_code:e.statut,statut_libelle:e.statut_libelle,remarque:e.remarque||"-",date_envoie:new Date(e.date_envoie).toLocaleString("fr-FR"),tech_main_username:e.tech_main_username||"-",date_reponse:e.date_reponse?new Date(e.date_reponse).toLocaleString("fr-FR"):"-"})}));console.log("newNotifsTab",t),o.setState({notifsTab:t})})),o.props.socket.emit("get users list"),o.props.socket.on("users list",(function(e){console.log("users list",e),e.push({num_user:0,username:"all"}),o.setState({usersList:e})}));case 5:case"end":return e.stop()}}),e)}))),o.componentDidUpdate=function(){console.log("NOTIFSHISTORY update")},o.updateSelectedUser=function(e){"all"!==e.target.value?o.props.socket.emit("get notifs history",e.target.value):o.props.socket.emit("get notifs history"),o.setState({selectedUser:e.target.value})},o.componentWillUnmount=function(){o.props.socket.off("notifs history"),o.props.socket.off("users list")},o.showNotifs=function(e){return e.map((function(e){return Object(L.jsx)(G,{notif:e},e.num_notification)}))},o.state={notifsTab:[],usersList:[],selectedUser:"all"},o}return Object(p.a)(n,[{key:"render",value:function(){var e=this.state.usersList.map((function(e){return{key:e.num_user,value:e.num_user,libelle:e.username}}));return Object(L.jsxs)("div",{className:"notifsHistory",children:[Object(L.jsxs)("div",{className:"notifsHistory-select",children:[Object(L.jsx)("p",{children:" Historiques des notifications envoyer par :"}),Object(L.jsx)(J,{objArray:e,value:this.state.selectedUser,onChange:this.updateSelectedUser})]}),Object(L.jsx)("div",{className:"notifsHistory-list",children:this.showNotifs(this.state.notifsTab)})]})}}]),n}(s.a.Component),$=(n(359),n(360),n(361),function(e){Object(h.a)(n,e);var t=Object(b.a)(n);function n(){return Object(d.a)(this,n),t.apply(this,arguments)}return Object(p.a)(n,[{key:"render",value:function(){var e=this,t=(this.props.array||[]).map((function(e){return Object(L.jsx)("option",{value:e,children:e},e)}));return this.props.objArray&&(t=this.props.objArray.map((function(e){return Object(L.jsx)("option",{value:e.value,children:e.libelle},e.key)}))),Object(L.jsx)("div",{className:"dropDown",children:Object(L.jsx)("select",{defaultValue:this.props.selectedValue,value:this.props.value,onChange:function(t){return e.props.onChange(t)},children:t})})}}]),n}(s.a.Component)),ee=function(e){Object(h.a)(n,e);var t=Object(b.a)(n);function n(e){var o;return Object(d.a)(this,n),(o=t.call(this,e)).state={problemeTechTypeArray:[],lieuArray:[]},o}return Object(p.a)(n,[{key:"componentDidMount",value:function(){var e=this;console.log("probleme constate mounted"),this.props.socket.emit("get probleme_tech_type list"),this.props.socket.emit("get lieu list"),this.props.socket.on("probleme_tech_type list",(function(t){console.log("probleme_tech_types list",t);var n=t.map((function(e){return{key:e.num_probleme_tech_type,value:e.num_probleme_tech_type,libelle:e.libelle_probleme_tech_type}}));n.unshift({key:"nd",value:"nd",libelle:"nd"}),e.setState({problemeTechTypeArray:n})})),this.props.socket.on("lieu list",(function(t){console.log("lieus",t);var n=t.map((function(e){return{key:e.num_lieu,value:e.num_lieu,libelle:e.libelle}}));n.unshift({key:"nd",value:"nd",libelle:"nd"}),e.setState({lieuArray:n})}))}},{key:"componentWillUnmount",value:function(){this.props.socket.off("probleme_tech_type list"),this.props.socket.off("lieu list")}},{key:"render",value:function(){var e=this.props,t=e.numProblemeTechType,n=e.numLieu,o=e.remarque,s=e.onChangeProblemeTechType,i=e.onChangeLieu,r=e.onChangeRemarque,a=this.state,c=a.problemeTechTypeArray,l=a.lieuArray;return Object(L.jsx)("div",{className:"problemeTechConstate",children:Object(L.jsxs)(q,{title:"Probleme constat\xe9",folded:!0,children:[Object(L.jsx)($,{objArray:c,value:t,onChange:s}),Object(L.jsx)($,{objArray:l,value:n,onChange:i}),Object(L.jsx)("textarea",{placeholder:"Remarque",value:o,onChange:r})]})})}}]),n}(o.Component);n(362);function te(e){var t=e.log?e.log.split(";"):[""];function n(n,o){if(n.preventDefault(),o>t.length)for(var s=0,i=o-t.length;s<i;s++)t.push("");else o<t.length&&(t.length=o);e.updateLog(t.join(";"))}console.log("etapes before render",t);var o=t.map((function(n,o){return Object(L.jsx)("input",{value:n,placeholder:"etape #".concat(o+1),onChange:function(n){return function(n,o){console.log("change Etapes",o);var s=t.slice();s[o]=n,e.updateLog(s.join(";"))}(n.target.value,o)}},o)}));return Object(L.jsx)("div",{className:"interventionLog",children:Object(L.jsx)(q,{title:"Log",folded:!0,children:Object(L.jsxs)("form",{onSubmit:function(e){return n(e,t.length+1)},children:[o,Object(L.jsx)("button",{onClick:function(e){return n(e,t.length+1)},children:" + "}),Object(L.jsx)("button",{onClick:function(e){return n(e,t.length-1)},children:" - "})]})})})}var ne=n(65),oe=(n(363),n(364),n(365),function(e){Object(h.a)(n,e);var t=Object(b.a)(n);function n(e){var o;return Object(d.a)(this,n),(o=t.call(this,e)).updateMaterielType=function(e){console.log("updateMaterielType",e.target.value),console.log("this.materiel",o.materiels);var t={num:o.materiels[e.target.value][0].value,type:e.target.value,config:o.state.config};o.props.changeList(t),o.setState({selectedMaterielType:e.target.value,materielList:o.materiels[e.target.value]})},o.updateMateriel=function(e){console.log("updateMateriel",e.target.value);var t={num:e.target.value,type:o.state.selectedMaterielType,config:o.state.config};o.props.changeList(t)},o.updateConfig=function(e){var t={num:o.props.selectedNumMateriel,type:o.state.selectedMaterielType,config:e.target.value};o.props.changeList(t),o.setState({config:e.target.value})},o.state={materielTypes:[],selectedMaterielType:o.props.selectedMaterielType||"",materielList:[],config:""},o.materiels=null,o}return Object(p.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.props.socket.emit("get materiel list"),this.props.socket.on("materiel list",(function(t,n){var o;console.log("materiels",t);var s,i=Object(B.a)(n);try{var r=function(){var e=s.value;o=Object(a.a)(Object(a.a)({},o),{},Object(z.a)({},e.libelle_materiel_type,t.filter((function(t){return t.num_materiel_type===e.num_materiel_type})).map((function(e){return{key:e.num_materiel,value:e.num_materiel,libelle:e.libelle_materiel}}))))};for(i.s();!(s=i.n()).done;)r()}catch(l){i.e(l)}finally{i.f()}(n=n.map((function(e){return e.libelle_materiel_type}))).unshift("nd"),console.log("materielsList",o,n),e.materiels=o;var c=e.state.selectedMaterielType;e.setState({materielTypes:n,materielList:o[c]})}))}},{key:"componentWillUnmount",value:function(){this.props.socket.off("materiel list")}},{key:"render",value:function(){var e=this.state,t=e.materielTypes,n=e.materielList,o=e.config,s=this.props,i=s.selectedNumMateriel,r=s.selectedMaterielType,a=this.props.title;return Object(L.jsx)("div",{className:"materielSelector",children:Object(L.jsxs)(q,{title:a||"Materiel",children:[Object(L.jsxs)("div",{className:"sub-category-option",children:[Object(L.jsx)("label",{children:" Type materiel:"}),Object(L.jsx)($,{value:r,array:t,onChange:this.updateMaterielType})]}),Object(L.jsxs)("div",{className:"sub-category-option",children:[Object(L.jsx)("label",{children:" Materiel:"}),Object(L.jsx)($,{value:i,objArray:n,onChange:this.updateMateriel})]}),Object(L.jsx)("div",{className:"sub-category-option",children:Object(L.jsxs)("label",{children:[" Note:",Object(L.jsx)("textarea",{value:o,onChange:this.updateConfig,children:" "})]})})]})})}}]),n}(o.Component));function se(e){var t=e.listMateriel,n=e.maxListMaterielLength?e.maxListMaterielLength:77,o=e.title?e.title:"Selectionner le(s) materiel(s)",s=!!e.folded&&e.folded;function i(o){console.log("changeListMaterielLength",o),o=(o=o<0?0:o)>n?n:o;var s=t.slice();if(o>s.length){var i=o-s.length;console.log("dLength",i);for(var r=0;r<i;r++)s.push({num:"nd",type:"nd"})}else o<s.length&&(s.length=o);e.setListMateriel(s)}console.log("listMateriel before render",t);var r=t.map((function(n,o){return Object(L.jsx)(oe,{title:"Materiel #".concat(o+1),socket:e.socket,changeList:function(n){return function(n,o){console.log("changeListMateriel");var s=t.slice();s[o]=n,e.setListMateriel(s)}(n,o)},selectedNumMateriel:n.num,selectedMaterielType:n.type},o)}));return Object(L.jsx)("div",{className:"multiMaterielSelector",children:Object(L.jsxs)(q,{title:o,folded:s,children:[Object(L.jsxs)("p",{children:[" Nombres : ",t.length]}),Object(L.jsx)("div",{className:"scroll_list",children:r}),n>1&&Object(L.jsxs)(L.Fragment,{children:[Object(L.jsx)("button",{onClick:function(){return i(t.length+1)},children:" + "}),Object(L.jsx)("button",{onClick:function(){return i(t.length-1)},children:" - "})]})]})})}function ie(e){var t,n,s,i=new Date((new Date).setDate((new Date).getDate()+1)),r=Object(o.useState)([{num:"nd",type:"nd"}]),c=Object(ne.a)(r,2),l=c[0],u=c[1],d=Object(o.useState)(new Date),p=Object(ne.a)(d,2),h=p[0],b=p[1],m=Object(o.useState)(i),j=Object(ne.a)(m,2),f=j[0],v=j[1],O=e.num_decharge,_="Effectuer un decharge";return O?(_="ID decharge : ".concat(O),t=Object(a.a)(Object(a.a)({},t),{},{background:"#53d35342"}),n=Object(L.jsx)("button",{onClick:function(){return e.downloadDecharge(O)},children:" Telecharger "}),s=!0):n=Object(L.jsx)("button",{onClick:function(){var t=l.filter((function(e){return"nd"!==e.num&&"nd"!==e.type}));if(console.log("materielsValide",t),t.length&&h.getTime()<=f.getTime()){console.log("createDecharge",h,f,t);var n={debut:h,fin:f};e.socket.emit("create decharge",n,t)}else console.log("pas de materiels valide OU date invalide, InterventionDecharge")},children:" Creer "}),console.log("render InterventionDecharge"),Object(L.jsx)("div",{className:"interventionDecharge",style:t,children:Object(L.jsx)(q,{title:_,folded:!0,children:Object(L.jsxs)("div",{className:"decharge-form",children:[Object(L.jsxs)("label",{children:[" Debut :",Object(L.jsx)("input",{type:"date",value:re(h),onChange:function(e){console.log("updateDateDebut",e.target.value),b(new Date(e.target.value))},disabled:s})]}),Object(L.jsxs)("label",{children:[" Fin :",Object(L.jsx)("input",{type:"date",value:re(f),onChange:function(e){return v(new Date(e.target.value))},disabled:s})]}),Object(L.jsx)(se,{socket:e.socket,listMateriel:l,setListMateriel:u}),n]})})})}function re(e){var t="".concat(e.getDate()),n="".concat(e.getMonth()+1),o=e.getFullYear();return n=n.length<2?"0"+n:n,t=t.length<2?"0"+t:t,"".concat(o,"-").concat(n,"-").concat(t)}var ae=function(e){Object(h.a)(n,e);var t=Object(b.a)(n);function n(e){var o;return Object(d.a)(this,n),(o=t.call(this,e)).updateMateriel=function(e){o.setState({materiels:e})},o.updateProblemeTechType=function(e){var t=e.target.value;o.setState({selectedNumProblemeTechType:t})},o.updateLieu=function(e){var t=e.target.value;o.setState({selectedNumLieu:t})},o.updateRemarque=function(e){var t=e.target.value;o.setState({remarque:t})},o.updateLog=function(e){o.setState({log:e})},o.updatePwd=function(e){var t=e.target.value;o.setState({pwd:t})},o.authenticate=function(e){e.preventDefault();var t=o.state.pwd;t&&o.props.socket.emit("authenticate intervention tech_main",o.state.num_intervention,t)},o.startIntervention=function(){var e=o.state.intervention.num_intervention;console.log("start intervention"),o.state.techMainIsAuth&&o.props.socket.emit("start intervention",e)},o.endIntervention=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=o.state.intervention,n=t.num_intervention,s=t.date_debut;s||console.log("pas de date de debut mais problem OK"),console.log("resolu",e),console.log("end intervention"),o.state.techMainIsAuth&&o.props.socket.emit("end intervention",n,e,s)},o.updateIntervention=function(){var e=o.state.intervention.num_intervention,t=o.state,n=t.log,s=t.selectedNumProblemeTechType,i=t.selectedNumLieu,r=t.remarque,a=t.num_decharge,c=t.materiels;console.log("updateIntervention",e,n,s,i);if(e){if(n&&(console.log("emit udpdate intervention info log"),o.props.socket.emit("update intervention info log",e,n)),"nd"!==s&&"nd"!==i){console.log("emit update intervention info probleme_tech");var l={num_probleme_tech_type:s,num_lieu:i,remarque:r};o.props.socket.emit("update intervention info probleme_tech",e,l)}a&&(console.log("emit update decharge intervention"),o.props.socket.emit("update decharge intervention",a,e)),c&&(console.log("emit update intervention info num_materiel"),o.props.socket.emit("update intervention info num_materiel",e,c[0].num))}},o.getDecharge=function(e){var t=new URL(document.location.href),n="/pdf/acim/decharge/".concat(e);t.port=3500,t.pathname=n,console.log("s_URL",t),window.open(t,"_blank")},o.state={techMainIsAuth:!1,num_intervention:o.props.num_intervention,intervention:{},pwd:"",selectedNumProblemeTechType:"nd",selectedNumLieu:"nd",remarque:"",log:"etape1 ; etape2; etape3;",num_decharge:"",materiels:[{num:"nd",type:"nd"}]},o}return Object(p.a)(n,[{key:"componentDidMount",value:function(){var e=this;console.log("intervention page mounted"),console.log(this.props.socket),this.props.socket.emit("get intervention data",this.props.num_intervention),this.props.socket.on("intervention data",(function(t){console.log("intervention data",t),e.setState({intervention:t,log:t.log,num_decharge:t.num_decharge})})),this.props.socket.on("tech_main is authenticated",(function(t){t===e.state.num_intervention&&(console.log("tech is auth to true"),e.setState({techMainIsAuth:!0,pwd:""}))})),this.props.socket.on("started intervention",(function(t){console.log("intervention started ",t.num_intervention,t.date_debut),e.state.num_intervention===t.num_intervention&&e.setState({intervention:t})})),this.props.socket.on("ended intervention interventionPage",(function(t){console.log("intervention ended ",t.num_intervention,t.date_debut),e.state.num_intervention===t.num_intervention&&e.setState({intervention:t})})),this.props.socket.on("new decharge",(function(t){var n=t.num_decharge;e.setState({num_decharge:n})}))}},{key:"componentDidUpdate",value:function(){var e;(console.log("intervention page updated",this.props.num_intervention),this.props.num_intervention!==this.state.num_intervention)&&(this.props.socket.emit("get intervention data",this.props.num_intervention),e=this.props.num_intervention?this.state.intervention:{},this.setState({num_intervention:this.props.num_intervention,techMainIsAuth:!1,intervention:e,num_decharge:""}))}},{key:"componentWillUnmount",value:function(){this.props.socket.off("intervention data"),this.props.socket.off("tech_main is authenticated"),this.props.socket.off("started intervention"),this.props.socket.off("probleme_tech_type list"),this.props.socket.off("lieu list"),this.props.socket.off("new decharge")}},{key:"render",value:function(){var e,t,n=this,o=this.state.intervention,s=o.tech_main_username,i=o.libelle_intervention_type,r=o.motif,a=o.libelle_lieu,c=o.date_programme,l=o.date_debut,u=o.date_fin,d=o.done,p=o.probleme_resolu,h=o.libelle_probleme_tech_type,b=o.log,m=o.lieu_probleme_tech,j=o.num_decharge,f=o.num_materiel,v=o.libelle_materiel,O=o.libelle_materiel_type;b&&(t=(e=b.split(";")).map((function(e,t){return Object(L.jsx)("li",{children:e},t)})));var _=this.state,g=_.selectedNumProblemeTechType,y=_.selectedNumLieu,x=_.remarque,k=_.log,N=_.num_decharge,w=_.materiels,S=this.props,D=S.style,T=S.closeSub;l&&(l=new Date(l).toLocaleString("fr-FR")),c&&(c=new Date(c).toLocaleString("fr-FR")),u&&(u=new Date(u).toLocaleString("fr-FR"));var C,I,M=this.props.num_intervention,P=Object(L.jsxs)(L.Fragment,{children:[!l&&Object(L.jsx)("button",{onClick:this.startIntervention,children:" Commencer "}),!d&&Object(L.jsx)("button",{onClick:function(){return n.endIntervention()},children:" Terminer "}),!p&&Object(L.jsx)("button",{onClick:function(){return n.endIntervention(!0)},children:" OK "})]});this.state.techMainIsAuth?(I=Object(L.jsxs)(L.Fragment,{children:[Object(L.jsxs)("p",{children:[" Type : ",i," "]}),Object(L.jsxs)("p",{children:[" Motif : ",r," "]}),Object(L.jsxs)("p",{children:[" Lieu : ",a," "]}),Object(L.jsxs)("p",{children:[" Faite par : ",s," "]}),Object(L.jsxs)("p",{children:[" Programme le : ",c," "]}),Object(L.jsxs)("p",{children:[" Debutee le : ",l," "]}),Object(L.jsxs)("p",{children:[" Terminee le : ",u," "]}),h&&Object(L.jsxs)("p",{children:[" Probleme constat\xe9 : ",h," -- ",m," "]}),b&&Object(L.jsxs)("p",{children:["".concat(e.length>1?"Etapes suivies":"Etape suivie")," :",t]}),j&&Object(L.jsxs)("p",{children:["ID decharge : ",Object(L.jsxs)("button",{onClick:function(){return n.getDecharge(j)},children:[" ",j," "]})]}),f&&Object(L.jsxs)("p",{children:["Intervention sur : ",O," -- ",v]}),Object(L.jsxs)("p",{children:[" Probleme resolue : ",p?"OUI":"NON"," "]})]}),C=Object(L.jsxs)(L.Fragment,{children:[Object(L.jsxs)("div",{className:"intervention-form",children:[Object(L.jsx)(q,{title:"INFO",children:I}),Object(L.jsx)("div",{className:"intervention-modifier",children:Object(L.jsxs)(q,{title:"Modifier",folded:!0,children:[Object(L.jsx)(ee,{numProblemeTechType:g,numLieu:y,remarque:x,onChangeProblemeTechType:this.updateProblemeTechType,onChangeLieu:this.updateLieu,onChangeRemarque:this.updateRemarque,socket:this.props.socket}),Object(L.jsx)(te,{log:k,updateLog:this.updateLog}),Object(L.jsx)(se,{socket:this.props.socket,listMateriel:w,setListMateriel:this.updateMateriel,maxListMaterielLength:1,title:"Objet de l'intervention",folded:!0}),Object(L.jsx)(ie,{socket:this.props.socket,num_intervention:M,num_decharge:N,downloadDecharge:this.getDecharge}),Object(L.jsx)("button",{onClick:this.updateIntervention,children:" Sauvergarder "})]})})]}),Object(L.jsx)("div",{className:"intervention-control",children:P})]})):C=Object(L.jsxs)("form",{onSubmit:this.authenticate,children:[Object(L.jsx)("input",{type:"password",placeholder:"mot de passe de ".concat(s),value:this.state.pwd,onChange:this.updatePwd}),Object(L.jsx)("button",{onClick:this.authenticate,children:" Valider "})]});return Object(L.jsxs)("div",{className:"interventionPage",style:D,children:[Object(L.jsxs)("div",{className:"interventionPage-title",children:[Object(L.jsxs)("button",{onClick:T,children:[" ","x"," "]}),Object(L.jsx)("p",{children:" Intervention "})]}),Object(L.jsxs)("p",{children:[" ID intervention  : ",M," "]}),Object(L.jsx)("div",{className:"intervention-display",children:C})]})}}]),n}(s.a.Component);n(366),n(367);function ce(e){var t="".concat(e.getDate()),n="".concat(e.getMonth()+1),o=e.getFullYear();return n=n.length<2?"0"+n:n,t=t.length<2?"0"+t:t,"".concat(o,"-").concat(n,"-").concat(t)}var le=function(e){Object(h.a)(n,e);var t=Object(b.a)(n);function n(e){var o;return Object(d.a)(this,n),(o=t.call(this,e)).updateTechMain=function(e){console.log("updateTechMain",e.target.value),console.log(o.techMains[e.target.value]);var t=o.techMains[e.target.value];o.props.setTechMain({num:e.target.value,username:t})},o.updateDateDebut=function(e){console.log("updateDateDebut",new Date(e.target.value));var t=new Date(new Date(e.target.value).setHours(0,0,0));o.props.setDateDebut(t)},o.updateDateFin=function(e){console.log("updateDateFin",new Date(e.target.value));var t=new Date(new Date(e.target.value).setHours(23,59,59));o.props.setDateFin(t)},o.updateStatut=function(e){console.log("updateStatut",e.target.value);var t=o.statuts[e.target.value];o.props.setStatut(t)},o.state={tech_mainList:[],statutList:[{key:0,value:0,libelle:"nd"},{key:1,value:1,libelle:"non-effectu\xe9e"},{key:2,value:2,libelle:"effectu\xe9e-r\xe9solue"},{key:3,value:3,libelle:"effectu\xe9e-non-r\xe9solue"}]},o.techMains={},o.statuts={0:{done:"nd",probleme_resolu:"nd"},1:{done:!1,probleme_resolu:!1},2:{done:!0,probleme_resolu:!0},3:{done:!0,probleme_resolu:!1}},o}return Object(p.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.props.socket.emit("get tech_mains list"),this.props.socket.on("tech_mains list",(function(t){console.log("tech_mains list");var n,o=t.map((function(e){return{key:e.num_user,libelle:e.username,value:e.num_user}})),s=Object(B.a)(o);try{for(s.s();!(n=s.n()).done;){var i=n.value;e.techMains=Object(a.a)(Object(a.a)({},e.techMains),{},Object(z.a)({},i.key,i.libelle))}}catch(r){s.e(r)}finally{s.f()}e.techMains=Object(a.a)(Object(a.a)({},e.techMains),{},{nd:"nd"}),o.unshift({key:"nd",libelle:"nd",value:"nd"}),console.log("newTech_mainList",o),e.setState({tech_mainList:o})}))}},{key:"componentWillUnmount",value:function(){this.props.socket.off("tech_mains list")}},{key:"render",value:function(){var e=this.props,t=e.tech_main,n=e.date_debut,o=e.date_fin,s=e.statut,i=this.state,r=i.tech_mainList,a=i.statutList,c=1;return s.done&&(c="nd"===s.done?0:s.probleme_resolu?2:3),Object(L.jsxs)("div",{className:"interventionHistoryControl",children:[Object(L.jsxs)("div",{className:"sub-control",children:[Object(L.jsx)("p",{children:" Technicien : "}),Object(L.jsx)($,{value:t.num,onChange:this.updateTechMain,objArray:r})]}),Object(L.jsxs)("div",{className:"sub-control",children:[Object(L.jsx)("p",{children:" Programm\xe9 du: "}),Object(L.jsx)("input",{type:"date",value:ce(n),onChange:this.updateDateDebut})]}),Object(L.jsxs)("div",{className:"sub-control",children:[Object(L.jsx)("p",{children:" au: "}),Object(L.jsx)("input",{type:"date",value:ce(o),onChange:this.updateDateFin})]}),Object(L.jsxs)("div",{className:"sub-control",children:[Object(L.jsx)("p",{children:" status : "}),Object(L.jsx)($,{value:c,onChange:this.updateStatut,objArray:a})]})]})}}]),n}(o.Component),ue=(n(368),function(e){Object(h.a)(n,e);var t=Object(b.a)(n);function n(e){var o;return Object(d.a)(this,n),(o=t.call(this,e)).displayInterventions=function(e){return e.map((function(e){return Object(L.jsx)(F,{intervention:e,showSub:o.props.showSub},e.num_intervention)}))},o.state={interventions:[]},o}return Object(p.a)(n,[{key:"render",value:function(){var e,t,n,o=this.props,s=o.tech_main_username,i=o.statut,r=o.date_debut,a=o.date_fin,c=o.interventions;return e=i.done?"nd"===i.done?"":"Effectu\xe9e -- ".concat(i.probleme_resolu?"R\xe9solu":"Non-r\xe9solu"):"Non-effectu\xe9",t=a===r?a:"".concat(r," - ").concat(a),n="nd"!==s?"par ".concat(s):"",Object(L.jsxs)("div",{className:"interventionHistoryAffichage",children:[Object(L.jsxs)("div",{className:"interventionHistoryAffichage-text",children:[Object(L.jsxs)("p",{children:[" Intervention ",e,"  ",n]}),Object(L.jsxs)("p",{children:[" du ",t]}),Object(L.jsxs)("p",{children:[" Nombre : ",c.length," "]})]}),Object(L.jsx)("div",{className:"scroll_list",children:this.displayInterventions(c)})]})}}]),n}(o.Component)),de=function(e){Object(h.a)(n,e);var t=Object(b.a)(n);function n(e){var o;return Object(d.a)(this,n),(o=t.call(this,e)).setTechMain=function(e){console.log("setTechMain",e),o.setState({tech_main:e})},o.setDateDebut=function(e){console.log("setDateDebut",e),e.getTime()>o.state.date_fin.getTime()&&(e=o.state.date_fin),o.setState({date_debut:e})},o.setDateFin=function(e){console.log("setDateFin",e),e.getTime()<o.state.date_debut.getTime()&&(e=o.state.date_debut),o.setState({date_fin:e})},o.setStatut=function(e){console.log("setStatut",e),o.setState({statut:e})},o.state={tech_main:{num:"nd",username:"nd"},date_debut:new Date((new Date).setFullYear(2020,0,1)),date_fin:new Date((new Date).setHours(23,59,59)),statut:{done:"nd",probleme_resolu:"nd"},interventionList:[]},o}return Object(p.a)(n,[{key:"componentDidUpdate",value:function(e,t){t.date_debut.getTime()===this.state.date_debut.getTime()&&t.date_fin.getTime()===this.state.date_fin.getTime()&&t.tech_main.num===this.state.tech_main.num&&t.statut.done===this.state.statut.done&&t.statut.probleme_resolu===this.state.statut.probleme_resolu||(console.log("emit again"),this.props.socket.emit("get intervention history",this.state.tech_main.num,this.state.date_debut,this.state.date_fin,this.state.statut))}},{key:"componentDidMount",value:function(){var e=this;console.log("intervention History Mounted");var t=this.state,n=t.tech_main,o=t.date_fin,s=t.statut;this.props.socket.emit("get intervention history",n.num,null,o,s),this.props.socket.emit("get oldest intervention date"),this.props.socket.on("oldest intervention date",(function(t){e.setState({date_debut:new Date(t)})})),this.props.socket.on("intervention history",(function(t){console.log("intervention history",t);var n=t.map((function(e,t){return{num_intervention:e.num_intervention,date_programme:e.date_programme,lieu_libelle:e.libelle_lieu,intervention_type:e.libelle_intervention_type,tech_main_username:e.tech_main_username,motif:e.motif,numero:t+1,done:e.done,probleme_resolu:e.probleme_resolu,libelle_probleme_tech_type:e.libelle_probleme_tech_type,code_intervention_type:e.code_intervention_type}}));e.setState({interventionList:n})}))}},{key:"componentWillUnmount",value:function(){this.props.socket.off("intervention history"),this.props.socket.off("oldest intervention date")}},{key:"render",value:function(){var e=this.state,t=e.tech_main,n=e.statut,o=e.date_debut,s=e.date_fin,i=e.interventionList;return Object(L.jsxs)("div",{className:"interventionHistory",children:[Object(L.jsx)("div",{className:"side-InterventionHistory",children:Object(L.jsx)(le,{socket:this.props.socket,tech_main:t,setTechMain:this.setTechMain,date_debut:o,date_fin:s,setDateDebut:this.setDateDebut,setDateFin:this.setDateFin,statut:n,setStatut:this.setStatut})}),Object(L.jsx)(ue,{tech_main_username:t.username,date_debut:o.toLocaleDateString(),date_fin:s.toLocaleDateString(),interventions:i,statut:n,showSub:this.props.showSub})]})}}]),n}(o.Component),pe=function(e){Object(h.a)(n,e);var t=Object(b.a)(n);function n(e){var o;return Object(d.a)(this,n),(o=t.call(this,e)).showSub=function(e){var t;o.state.numSelectedIntervention===e?(t=!o.state.showSub,e=null):t=!0,o.setState({showSub:t,numSelectedIntervention:e})},o.nbNewNotificationPlus=function(e){var t=e||o.state.nbNewNotification+1;t=parseInt(t),o.setState({nbNewNotification:t})},o.showPopUp=function(){o.popUp.current.style.top="10px",setTimeout((function(){o.popUp.current.style.top="-1000px"}),1e4)},o.onClickNotif=function(){var e=o.props.match.url;o.popUp.current.style.top="-1000px",o.props.history.push("".concat(e,"/dashboard/notifs"))},o.logOut=function(){o.props.logOut()},o.componentDidMount=function(){console.log(" MAIN component did mount"),R.connect(o.props.session.username,o.props.session.type_user,o.props.session.num_user),o.socket.on("new notif",(function(e){console.log("new notif received on main",e);var t=o.state.newNotifs.slice();t.length>4&&t.pop(),t.unshift(e),console.log("newNewNotifs",t),t=t.filter((function(e){var t=(new Date).getTime()-6e5,n=new Date(e.date_envoie).getTime();return console.log("now_2",t),console.log("date_notif",n),console.log(" date_notif is more than 10 minutes old ",n<t),!(n<t)})),console.log("newNewNotifs",t),o.showPopUp();var n=o.state.nbNewNotification+1;o.setState({newNotifs:t,nbNewNotification:n})})),o.socket.emit("get notifs list unanswered"),o.socket.on("unanswered notifs nb",(function(e){console.log("unanswered notifs nb",e),o.nbNewNotificationPlus(e)}))},o.componentWillUnmount=function(){console.log("UNMOUNT main"),o.socket.off("new notif"),o.socket.off("nb tache undone"),o.socket.off("unanswered notifs nb"),o.socket.offAny(),R.socket.disconnect()},o.showNewNotifs=function(){return o.state.newNotifs.map((function(e){var t;switch(e.probleme_statut_code){case"MAX":t={color:"red"};break;case"MID":t={color:"yellow"};break;case"MIN":t={color:"blue"}}return Object(L.jsxs)("div",{className:"notif_pop_notif",onClick:o.onClickNotif,children:[Object(L.jsx)("p",{id:"notif_time",children:new Date(e.date_envoie).toLocaleTimeString("fr-FR")}),Object(L.jsxs)("p",{style:t,children:[" ",e.probleme_statut," "]}),Object(L.jsxs)("p",{children:[" ",e.probleme_type," "]}),Object(L.jsxs)("p",{children:[" ",e.lieu," "]})]},e.num_notification)}))},o.state={newNotifs:[],nbNewNotification:0,showSub:!1,numSelectedIntervention:null},o.socket=R.socket,o.popUp=s.a.createRef(),o}return Object(p.a)(n,[{key:"render",value:function(){var e,t,n,o=this,s=this.props.match,i=s.path,r=s.url,c=this.props.session,l=this.state,u=l.showSub,d=l.numSelectedIntervention;return u?(e=Object(a.a)(Object(a.a)({},e),{},{display:"none"}),t=Object(a.a)(Object(a.a)({},t),{},{width:"100%"})):(t=Object(a.a)(Object(a.a)({},t),{},{width:"0px"}),n=Object(a.a)(Object(a.a)({},n),{},{display:"none"})),Object(L.jsxs)("div",{className:"main_layout",children:[Object(L.jsx)("div",{className:"notif_pop",ref:this.popUp,children:this.showNewNotifs()}),Object(L.jsxs)("div",{className:"header",children:[Object(L.jsx)("h1",{children:"mptdn_acim"}),Object(L.jsxs)("p",{children:[" ",this.props.session.username," "]}),Object(L.jsx)("button",{onClick:this.showPopUp,children:" show pop "}),Object(L.jsx)("button",{onClick:this.logOut,children:" se deconnecter "})]}),Object(L.jsxs)("div",{className:"main_display",children:[Object(L.jsxs)("nav",{className:"side_nav",children:[Object(L.jsx)(I.c,{activeClassName:"active_navLink",to:"".concat(r,"/dashboard"),children:"tableau de bord"}),Object(L.jsx)(I.c,{activeClassName:"active_navLink",to:"".concat(r,"/mytask"),children:"Mes taches"}),Object(L.jsx)(I.c,{activeClassName:"active_navLink",to:"".concat(r,"/notifsHistory"),children:"Historiques des notifications"}),Object(L.jsx)(I.c,{activeClassName:"active_navLink",to:"".concat(r,"/interventionHistory"),children:"Historiques des interventions"})]}),Object(L.jsxs)("div",{className:"main-tabDisplay",children:[Object(L.jsx)("div",{className:"display",style:e,children:Object(L.jsxs)(P.d,{children:[Object(L.jsx)(P.b,{exact:!0,path:i,children:Object(L.jsx)(P.a,{to:"".concat(i,"/dashboard")})}),Object(L.jsx)(P.b,{path:"".concat(i,"/dashboard"),render:function(e){return Object(L.jsx)(X,Object(a.a)(Object(a.a)({},e),{},{socket:o.socket,session:o.props.session,nbNewNotification:o.state.nbNewNotification,nbNewNotificationToZero:function(){return o.nbNewNotificationPlus("0")},showSub:o.showSub}))}}),Object(L.jsx)(P.b,{path:"".concat(i,"/mytask"),render:function(e){return Object(L.jsx)(H,Object(a.a)(Object(a.a)(Object(a.a)({},e),o.props),{},{showSub:o.showSub,socket:o.socket,num_tech_main:c.num_user,topText:"Listes des taches a faire par ".concat(c.username," :")}))}}),Object(L.jsx)(P.b,{path:"".concat(i,"/notifsHistory"),render:function(e){return Object(L.jsx)(Q,Object(a.a)(Object(a.a)({},e),{},{session:o.props.session,socket:o.socket}))}}),Object(L.jsx)(P.b,{path:"".concat(i,"/interventionHistory"),render:function(e){return Object(L.jsx)(de,Object(a.a)(Object(a.a)({},e),{},{session:o.props.session,socket:o.socket,showSub:o.showSub}))}})]})}),Object(L.jsx)("div",{className:"sub-display",style:t,children:Object(L.jsx)(ae,Object(a.a)(Object(a.a)({num_intervention:this.state.numSelectedIntervention},this.props),{},{style:n,closeSub:function(){return o.showSub(d)},socket:this.socket}))})]})]})]})}}]),n}(s.a.Component),he=(n(369),n(370),function(e){Object(h.a)(n,e);var t=Object(b.a)(n);function n(){return Object(d.a)(this,n),t.apply(this,arguments)}return Object(p.a)(n,[{key:"render",value:function(){return Object(L.jsxs)("div",{className:"notify_header header",children:[Object(L.jsx)("h1",{children:"mptdn_acim"}),Object(L.jsxs)("p",{children:[" ",this.props.session.username," "]}),Object(L.jsx)("button",{onClick:this.props.showNotif,children:" showNotif "}),Object(L.jsx)("button",{onClick:this.props.logOut,children:" se deconnecter "})]})}}]),n}(s.a.Component)),be=(n(371),function(e){Object(h.a)(n,e);var t=Object(b.a)(n);function n(e){var o;return Object(d.a)(this,n),(o=t.call(this,e)).updateProblem=function(e){o.setState({problem:e.target.value})},o.updateProblemType=function(e){o.setState({num_probleme_type:e.target.value})},o.updateProblemStatut=function(e){o.setState({num_probleme_statut:e.target.value})},o.updateLieu=function(e){o.setState({num_lieu:e.target.value})},o.updateRemarque=function(e){o.setState({remarque:e.target.value})},o.componentDidMount=function(){console.log("ask mount"),o.props.socket?(o.props.socket.on("list problem",(function(e){console.log("list problem in ask",e);var t=e.map((function(e){return{key:e.num_probleme_type,value:e.num_probleme_type,libelle:e.libelle,code:e.code}}));o.setState({listProblem:t,num_probleme_type:t[0].value})})),o.props.socket.on("list problem_statut",(function(e){console.log(" getting list problem_statut");var t=e.map((function(e){return{key:e.num_probleme_statut,value:e.num_probleme_statut,libelle:e.libelle}}));o.setState({listProblemStatut:t,num_probleme_statut:t[0].value})})),o.props.socket.on("list lieu",(function(e){console.log(" getting list lieu");var t=e.map((function(e){return{key:e.num_lieu,value:e.num_lieu,libelle:e.libelle}}));o.setState({listLieu:t,num_lieu:t[0].value})})),o.props.socket.on("I sent a notif",(function(e){e.date_envoie=new Date(e.date_envoie).toLocaleString("fr-FR"),console.log("new notif in history"),o.props.nbNewNotifsPlus(),o.setState({indication:"Demande envoyee #".concat(e.date_envoie)})})),o.props.socket.emit("get problem definition")):console.log(" no socket in ask")},o.componentDidupdate=function(){console.log("componentDidUpdate ask")},o.componentWillUnmount=function(){console.log("unmount ask"),o.props.socket.off("list problem"),o.props.socket.off("list problem_statut"),o.props.socket.off("list lieu"),o.props.socket.off("I sent a notif")},o.sendNotifs=function(){var e;if(console.log("listProblem",o.state.listProblem),0!==o.state.listProblem.length&&(e=o.state.listProblem.find((function(e){return e.key===o.state.num_probleme_type})).code),console.log(" selected problem type is "+e),"OTH"!==e||o.state.remarque){if(o.props.session&&o.state.num_lieu&&o.state.num_probleme_type&&o.state.num_probleme_statut){var t={num_probleme_type:o.state.num_probleme_type,num_probleme_statut:o.state.num_probleme_statut,num_lieu:o.state.num_lieu,remarque:o.state.remarque},n={num_app_user_user:o.state.session.num_user,newProblem:t};console.log("send notif ",n),o.props.socket.emit("notif",n)}}else o.setState({indication:"Vous devez ecrire une remarque"})},o.state={listProblem:[],listProblemStatut:[],listLieu:[],session:o.props.session,problem:"",num_probleme_type:"",num_probleme_statut:"",num_lieu:"",remarque:"",indication:""},o}return Object(p.a)(n,[{key:"render",value:function(){var e;return this.state.indication&&(e={opacity:1,right:0}),Object(L.jsxs)("div",{className:"ask",children:[Object(L.jsx)("p",{children:"Demande d'assistance"}),Object(L.jsxs)("div",{className:"dropdown-zone",children:[Object(L.jsx)("p",{children:" Probleme  : "}),Object(L.jsx)(J,{value:this.state.num_probleme_type,onChange:this.updateProblemType,objArray:this.state.listProblem})]}),Object(L.jsxs)("div",{className:"remarque-problem",children:[Object(L.jsx)("p",{children:" remarque : "}),Object(L.jsx)("textarea",{value:this.state.remarque,onChange:this.updateRemarque,placeholder:"remarque ici"})]}),Object(L.jsxs)("div",{className:"double-dropdown",children:[Object(L.jsxs)("div",{className:"dropdown-zone",children:[Object(L.jsx)("p",{children:" Urgence : "}),Object(L.jsx)(J,{defaultValue:"xx",value:this.state.num_probleme_statut,objArray:this.state.listProblemStatut,onChange:this.updateProblemStatut})]}),Object(L.jsxs)("div",{className:"dropdown-zone",children:[Object(L.jsx)("p",{children:" Lieu : "}),Object(L.jsx)(J,{value:this.state.num_lieu,objArray:this.state.listLieu,onChange:this.updateLieu})]})]}),Object(L.jsx)("button",{className:"my-button",onClick:this.sendNotifs,children:" Envoyer "}),Object(L.jsxs)("div",{className:"indication",style:e,children:[" ",this.state.indication," "]})]})}}]),n}(s.a.Component)),me=(n(372),n(373),function(e){Object(h.a)(n,e);var t=Object(b.a)(n);function n(e){var o;return Object(d.a)(this,n),(o=t.call(this,e)).showDetails=function(){o.setState({detailsAreShown:!o.state.detailsAreShown})},o.showInfoOf=function(e){o.props.showSub(e)},o.state={detailsAreShown:!1},o}return Object(p.a)(n,[{key:"render",value:function(){var e,t,n,o,s=this;switch(this.props.notif.statut_code){case W.code:e={borderLeft:"3px solid red"},n={color:"red",fontWeight:"bold"};break;case E.code:e={borderLeft:"3px solid yellow"},n={color:"yellow",fontWeight:"bold"};break;case V.code:e={borderLeft:"3px solid blue"},n={color:"blue"}}this.state.detailsAreShown&&(o={height:"80%"},t={height:"15%"},e=Object(a.a)(Object(a.a)({},e),{},{height:"300px"})),this.props.notif.num_app_user_tech_main&&this.props.notif.date_reponse&&(e=Object(a.a)(Object(a.a)({},e),{},{background:"#a9c8f7"}));var i=this.props.notif,r=i.probleme_type,c=i.code,l=i.statut_libelle,u=i.lieu,d=i.date_envoie,p=i.remarque,h=i.tech_main_username,b=i.date_reponse,m=i.num_notification,j=i.num_intervention;return Object(L.jsxs)("div",{className:"notif_history",style:e,children:[Object(L.jsxs)("div",{className:"notif_history-sum",style:t,children:[Object(L.jsxs)("div",{className:"date_envoie",children:[Object(L.jsx)("p",{children:" Date d'envoie : "}),Object(L.jsxs)("p",{children:[" ",d," "]})]}),Object(L.jsxs)("div",{className:"probleme_type",children:[Object(L.jsxs)("p",{children:[" ",r," "]}),Object(L.jsxs)("p",{children:[" ",c," "]})]}),Object(L.jsxs)("div",{className:"probleme_statut",style:n,children:[Object(L.jsxs)("p",{children:[" ",l," "]}),Object(L.jsxs)("p",{children:[" ",u," "]})]}),Object(L.jsx)("button",{onClick:this.showDetails,children:" Details "})]}),this.state.detailsAreShown&&Object(L.jsxs)("div",{className:"notif-details",style:o,children:[Object(L.jsxs)("p",{children:[" remarque: ",p," "]}),Object(L.jsxs)("p",{children:[" prise en charge par : ",h,"  "]}),Object(L.jsxs)("p",{children:[" repondue le : ",b," "]}),Object(L.jsxs)("p",{children:[" ID notification : ",m," "]}),Object(L.jsxs)("p",{children:[" ID intervention :","nd"!==j&&Object(L.jsxs)("button",{href:"#",onClick:function(){return s.showInfoOf(j)},children:[" ",j," "]})]}),Object(L.jsx)("p",{children:" Details 1 "})]})]})}}]),n}(s.a.Component)),je=function(e){Object(h.a)(n,e);var t=Object(b.a)(n);function n(e){var o;return Object(d.a)(this,n),(o=t.call(this,e)).componentDidMount=function(){o.props.socket.emit("get notifs history",o.props.session.num_user),o.props.socket.on("notifs history",(function(e){console.log("notification history",e);var t=e.map((function(e){return{num_notification:e.num_notification,probleme_type:e.probleme_type,probleme_code:e.code,statut_code:e.statut,statut_libelle:e.statut_libelle,lieu:e.lieu,remarque:e.remarque||"-",date_envoie:new Date(e.date_envoie).toLocaleString("fr-FR"),num_app_user_tech_main:e.num_app_user_tech_main,tech_main_username:e.tech_main_username||"-",date_reponse:e.date_reponse?new Date(e.date_reponse).toLocaleString("fr-FR"):"-",num_intervention:e.num_intervention||"nd"}}));o.setState({notifsTab:t})})),o.props.socket.on("notif from tech_main",(function(){console.log("notif from tech_main in history js"),setTimeout((function(){console.log("notif from tech_main"),o.props.socket.emit("get notifs history",o.props.session.num_user)}),5e3)})),o.props.nbNewNotifsToZero()},o.displayNotif=function(e){return e.map((function(e){return Object(L.jsx)(me,{showSub:o.props.showSub,notif:e},e.num_notification)}))},o.componentWillUnmount=function(){o.props.socket.off("notifs history")},o.state={notifsTab:[]},o}return Object(p.a)(n,[{key:"render",value:function(){return Object(L.jsxs)("div",{id:"notifsList",children:[Object(L.jsxs)("p",{children:[" Historiques des notifications envoyees par ",this.props.session.username,":  "]}),Object(L.jsx)("div",{id:"scroll_list-notifsList",children:this.displayNotif(this.state.notifsTab)})]})}}]),n}(s.a.Component),fe=(n(374),function(e){Object(h.a)(n,e);var t=Object(b.a)(n);function n(e){var s;return Object(d.a)(this,n),(s=t.call(this,e)).componentDidMount=function(){console.log("component did mount intervention_notification"),s.props.socket.emit("get list intervention_notification",s.props.session.num_user),s.props.socket.on("list intervention_notification",(function(e){console.log("list intervention",e);var t=e.map((function(e,t){return{num_intervention:e.num_intervention,date_programme:e.date_programme,lieu_libelle:e.lieu,intervention_type:e.libelle_intervention_type,tech_main_username:e.tech_main_username,motif:e.motif,numero:t+1,done:e.done}}));s.setState({interventionTab:t})})),s.props.socket.on("ended intervention",(function(){s.props.socket.emit("get list intervention_notification",s.props.session.num_user)}))},s.componentWillUnmount=function(){console.log("intervention_notification will unmount"),s.props.socket.off("list intervention_notification")},s.displayListInterevention=function(e){return e.map((function(e){return e.num_intervention===s.props.numSelectedIntervention?Object(o.createElement)(F,Object(a.a)(Object(a.a)({},s.props),{},{intervention:e,key:e.num_intervention,selected:!0})):Object(o.createElement)(F,Object(a.a)(Object(a.a)({},s.props),{},{intervention:e,key:e.num_intervention,selected:!1}))}))},s.state={interventionTab:[]},s}return Object(p.a)(n,[{key:"render",value:function(){return Object(L.jsxs)("div",{className:"intervention_notification",children:[Object(L.jsxs)("p",{children:[" Interventions provenant des notifactions de ",this.props.session.username," "]}),Object(L.jsx)("div",{className:"scroll_list",children:this.displayListInterevention(this.state.interventionTab)})]})}}]),n}(s.a.Component)),ve=function(e){Object(h.a)(n,e);var t=Object(b.a)(n);function n(e){var o;return Object(d.a)(this,n),(o=t.call(this,e)).nbNewNotifsPlus=function(e){console.log("new notifs ++");var t=e||o.state.nbNewNotifs+1;t=parseInt(t),console.log("new notifs ",t),o.setState({nbNewNotifs:t})},o.logOut=function(){o.props.logOut()},o.showNotif=function(){console.log("show Notif"),o.notify_notif_pop.current.style.top="157px",setTimeout((function(){o.notify_notif_pop.current.style.top="-1000px"}),1e4)},o.hideNotif=function(){o.notify_notif_pop.current.style.top="-1000px"},o.showSubWithInfo=function(e){var t;o.state.numSelectedIntervention===e?(t=!o.state.showSub,e=null):t=!0,o.setState({showSub:t,numSelectedIntervention:e})},o.formatNotifsList=function(e){return e.map((function(e){return Object(L.jsxs)("div",{className:"notify_notif",onClick:o.hideNotif,children:[Object(L.jsxs)("p",{children:[" ",e.tech_main_username," arrive "]}),Object(L.jsxs)("p",{children:[" probleme : ",e.probleme_type," -- ",e.lieu," "]}),Object(L.jsxs)("p",{children:[" notifiee le : ",e.date_envoie_formatted," "]}),Object(L.jsxs)("p",{children:[" delai : ",e.delai," "]})]},e.key)}))},o.state={nbNewNotifs:0,notifsList:[],showSub:!1,numSelectedIntervention:null},o.socket=R.socket,o.notify_notif_pop=s.a.createRef(),o}return Object(p.a)(n,[{key:"componentDidMount",value:function(){var e=this;R.connect(this.props.session.username,this.props.session.type_user,this.props.session.num_user),this.socket.on("notif from tech_main",(function(t){var n=t.tech_main_username,o=t.probleme_type,s=t.date_envoie,i=t.delai,r=t.lieu,a=t.num_notification;console.log("notif from tech_main",n,o,s,i);var c=new Date(s).toLocaleString("fr-FR"),l={tech_main_username:n,probleme_type:o,lieu:r,date_envoie_formatted:c,date_envoie:s,delai:i,text:"".concat(n,' arrive pour le probleme : " ').concat(o,' " lieu : ').concat(r," - notifie le ").concat(c," -- \n                delai : ").concat(i),key:a},u=e.state.notifsList.slice();u.length>4&&u.pop(),u.unshift(l),u=u.filter((function(e){var t=(new Date).getTime()-6e5;return!(new Date(e.date_envoie).getTime()<t)})),console.log("newNotifsList",u),e.showNotif(),e.setState({notifsList:u})}))}},{key:"componentWillUnmount",value:function(){console.log("unmount notify"),this.socket.off("list problem"),this.socket.off("list problem_statut"),this.socket.off("list lieu"),this.socket.off("notif from tech_main"),this.socket.offAny(),R.disconnect()}},{key:"render",value:function(){var e,t,n=this,o=this.state.numSelectedIntervention;return this.state.showSub?e={width:"45%"}:(e={background:"black",width:"0px"},t={display:"none"}),Object(L.jsxs)("div",{className:"notify_layout",children:[Object(L.jsx)(he,Object(a.a)(Object(a.a)({},this.props),{},{showNotif:this.showNotif})),Object(L.jsxs)("div",{className:"notify_display",children:[Object(L.jsx)(Oe,Object(a.a)(Object(a.a)(Object(a.a)({},this.state),this.props),{},{socket:this.socket,nbNewNotifsPlus:this.nbNewNotifsPlus,showSub:this.showSubWithInfo,numSelectedIntervention:this.state.numSelectedIntervention})),Object(L.jsx)("div",{className:"sub-display",style:e,children:Object(L.jsx)(ae,Object(a.a)(Object(a.a)({num_intervention:this.state.numSelectedIntervention},this.props),{},{socket:this.socket,style:t,closeSub:function(){return n.showSubWithInfo(o)}}))}),Object(L.jsx)("div",{className:"notify_notif_pop",ref:this.notify_notif_pop,children:this.formatNotifsList(this.state.notifsList)})]})]})}}]),n}(s.a.Component);function Oe(e){var t=e.match,n=t.path,o=t.url;return Object(L.jsxs)("div",{className:"tab-display",children:[Object(L.jsxs)("nav",{className:"notify_nav",children:[Object(L.jsx)(I.c,{activeClassName:"active_navLink_notify",to:"".concat(o,"/ask"),children:"Demande d'assistance"}),Object(L.jsxs)(I.c,{activeClassName:"active_navLink_notify",to:"".concat(o,"/history"),children:["Historiques des demandes",e.nbNewNotifs>0?"(".concat(e.nbNewNotifs,")"):""]}),Object(L.jsx)(I.c,{activeClassName:"active_navLink_notify",to:"".concat(o,"/intervention"),children:"Interventions"})]}),Object(L.jsxs)("div",{className:"display",children:[e.children,Object(L.jsxs)(P.d,{children:[Object(L.jsx)(P.b,{path:"".concat(n,"/ask"),render:function(t){return Object(L.jsx)(be,Object(a.a)(Object(a.a)({},t),{},{session:e.session,socket:e.socket,nbNewNotifsPlus:e.nbNewNotifsPlus}))}}),Object(L.jsx)(P.b,{path:"".concat(n,"/history"),render:function(t){return Object(L.jsx)(je,Object(a.a)(Object(a.a)({},t),{},{session:e.session,socket:e.socket,nbNewNotifsToZero:function(){return e.nbNewNotifsPlus("0")},showSub:e.showSub,numSelectedIntervention:e.numSelectedIntervention}))}}),Object(L.jsx)(P.b,{path:"".concat(n,"/intervention"),render:function(t){return Object(L.jsx)(fe,Object(a.a)(Object(a.a)(Object(a.a)({},t),e),{},{socket:e.socket,showSub:e.showSub,numSelectedIntervention:e.numSelectedIntervention}))}}),Object(L.jsx)(P.a,{exact:!0,from:n,to:"".concat(n,"/ask")})]})]})]})}var _e=function(e){Object(h.a)(n,e);var t=Object(b.a)(n);function n(){var e;Object(d.a)(this,n);for(var o=arguments.length,s=new Array(o),i=0;i<o;i++)s[i]=arguments[i];return(e=t.call.apply(t,[this].concat(s))).determineRender=function(){return e.props.conditionIn()?e.props.render:e.props.redirectRender},e}return Object(p.a)(n,[{key:"render",value:function(){return Object(L.jsx)(P.b,{path:this.props.path,render:this.determineRender()})}}]),n}(s.a.Component),ge=function(e){Object(h.a)(n,e);var t=Object(b.a)(n);function n(e){var o;return Object(d.a)(this,n),(o=t.call(this,e)).setCredentials=function(e){o.computedHash_TECH_MAIN=null,o.computedHash_USER=null,o.setState({logged:e.logged,num_user:e.num_user,username:e.username,type_user:e.type_user})},o.logOut=function(){o.setCredentials({logged:!1,num_user:"",username:"",type_user:null})},o.componentDidMount=Object(u.a)(l.a.mark((function e(){var t,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("======= APP component did mount , state ",o.state),!("true"===localStorage.getItem("logged"))){e.next=12;break}return console.log("compute hmac for user , tech_main"),e.next=6,O(v.code,o.state.username);case 6:return t=e.sent,e.next=9,O(f.code,o.state.username);case 9:n=e.sent,console.log(" after compute ",t,n),o.setState({t_u:t,t_t:n});case 12:case"end":return e.stop()}}),e)}))),console.log("======== APP constructor"),o.state={logged:"true"===localStorage.getItem("logged")||!1,num_user:localStorage.getItem("num_user")||"",username:localStorage.getItem("username")||"",type_user:localStorage.getItem("type_user")||null,t_u:null,t_t:null},o.computedHash_USER=null,o.computedHash_TECH_MAIN=null,console.log("constructor",o.state),o}return Object(p.a)(n,[{key:"shouldComponentUpdate",value:function(){var e=Object(u.a)(l.a.mark((function e(t,n){var o,s;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("==== APP shouldComponentUpdate  state",n),this.state.logged===n.logged){e.next=18;break}if(console.log("compute hmac for user , tech_main"),n.logged){e.next=8;break}o=null,s=null,e.next=14;break;case 8:return e.next=10,O(v.code,n.username);case 10:return o=e.sent,e.next=13,O(f.code,n.username);case 13:s=e.sent;case 14:console.log(" after compute ",o,s),this.setState({t_u:o,t_t:s}),e.next=19;break;case 18:return e.abrupt("return",!0);case 19:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(){console.log("==== APP componentDidUpdate "),localStorage.setItem("logged",this.state.logged),localStorage.setItem("num_user",this.state.num_user),localStorage.setItem("username",this.state.username),localStorage.setItem("type_user",this.state.type_user)}},{key:"render",value:function(){var e=this;console.log("===== APP render"),console.log("state ",this.state);var t,n=function(){if(console.log("==== determineRootRedirect function "),console.log("state in determineRootRedirect ",e.state),console.log(" computedhash ",e.state.t_u,e.state.t_t),e.state.logged){if(console.log(" logged"),e.state.type_user===e.state.t_u)return"/notify";if(e.state.type_user===e.state.t_t)return"/acim"}return console.log("no logged"),console.log("==== end determineRootRedirect "),"/login"}();return console.log("redirectTo ",n),this.state.logged&&(t={num_user:this.state.num_user,username:this.state.username,type_user:this.state.type_user}),console.log("=== end of render appp"),Object(L.jsx)(M,{children:Object(L.jsx)("div",{className:"App",children:Object(L.jsxs)(P.d,{children:[Object(L.jsx)(_e,{path:"/login",conditionIn:function(){return!e.state.logged},render:function(t){return Object(L.jsx)(C,Object(a.a)(Object(a.a)({},t),{},{setCredentials:e.setCredentials}))},redirectRender:function(e){return Object(L.jsx)(P.a,{to:n})}}),Object(L.jsx)(_e,{path:"/acim",conditionIn:function(){return!(!e.state.logged||e.state.type_user!==e.state.t_t)},render:function(n){return Object(L.jsx)(pe,Object(a.a)(Object(a.a)({},n),{},{session:t,logOut:e.logOut}))},redirectRender:function(e){return Object(L.jsx)(P.a,{to:n})}}),Object(L.jsx)(_e,{path:"/notify",conditionIn:function(){return!(!e.state.logged||e.state.type_user!==e.state.t_u)},render:function(n){return Object(L.jsx)(ve,Object(a.a)(Object(a.a)({},n),{},{session:t,logOut:e.logOut}))},redirectRender:function(e){return Object(L.jsx)(P.a,{to:n})}}),Object(L.jsx)(P.b,{path:"/info",children:Object(L.jsxs)("dl",{children:[Object(L.jsx)("dt",{children:" a.c.i.m "}),Object(L.jsx)("dd",{children:" Application de Coordination des Interventions de Maintenance "})]})}),Object(L.jsx)(P.a,{from:"/",to:"/login"})]})})})}}]),n}(s.a.Component),ye=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,376)).then((function(t){var n=t.getCLS,o=t.getFID,s=t.getFCP,i=t.getLCP,r=t.getTTFB;n(e),o(e),s(e),i(e),r(e)}))};r.a.render(Object(L.jsx)(s.a.StrictMode,{children:Object(L.jsx)(I.a,{children:Object(L.jsx)(ge,{})})}),document.getElementById("root")),ye()}},[[375,1,2]]]);
//# sourceMappingURL=main.5677cee8.chunk.js.map